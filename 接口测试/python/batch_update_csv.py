#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
æ‰¹é‡æ›´æ–°CSVæ–‡ä»¶ä¸­çš„è¯æœ¯ï¼Œèå…¥ASRè¯†åˆ«å¼‚å¸¸ç‰¹å¾
"""

import csv
import re
import random

# ASRè¯†åˆ«å¼‚å¸¸ç‰¹å¾
ASR_FEATURES = {
    'fillers': ['å—¯...', 'å‘ƒ...', 'é‚£ä¸ª...', 'è¿™ä¸ª...', 'é¢...', 'å—¯å“¼...'],
    'stutters': ['æˆ‘...æˆ‘...', 'ä½ ...ä½ ...', 'ä»–...ä»–...', 'é‚£...é‚£...', 'è¿™...è¿™...'],
    'repetitions': ['å¤©æ°”å¤©æ°”', 'ä»€ä¹ˆä»€ä¹ˆ', 'å¥½å¥½å¥½', 'å¯ä»¥å¯ä»¥', 'çœŸçš„çœŸçš„'],
    'unk': ['<unk>', '<unk>'],
    'sil': ['<sil>', '<sil>'],
    'int': ['[int]', '[int]']
}

# éœ€è¦æ›´æ–°çš„ç”¨ä¾‹æ˜ å°„
UPDATE_MAPPING = {
    'test_user_047': {
        'text': 'å—¯...é‚£ä¸ª...ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·<sil>ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·',
        'asr_emotion': 'å¹³æ·¡'
    },
    'test_user_048': {
        'text': 'å‘ƒ...å‘ƒ...å¸®æˆ‘è®°ä½è¿™ä¸ªä¿¡æ¯<unk>è¿™ä¸ªä¿¡æ¯',
        'asr_emotion': 'å¹³æ·¡'
    },
    'test_user_049': {
        'text': 'å—¯...é‚£ä¸ª...åˆ«å¿˜äº†æˆ‘çš„ç”Ÿæ—¥æ˜¯10æœˆ1æ—¥<sil>10æœˆ1æ—¥',
        'asr_emotion': 'å¹³æ·¡'
    },
    'test_user_050': {
        'text': 'å‘ƒ...å‘ƒ...ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·<unk>æ€ä¹ˆæ ·',
        'asr_emotion': 'å¹³æ·¡'
    },
    'test_user_051': {
        'text': 'å—¯...é‚£ä¸ª...å¸®æˆ‘æŸ¥ä¸€ä¸‹æ·±åœ³æ˜å¤©çš„å¤©æ°”<sil>æ·±åœ³çš„å¤©æ°”',
        'asr_emotion': 'å¹³æ·¡'
    },
    'test_user_052': {
        'text': 'å‘ƒ...å‘ƒ...æœç´¢ä¸€ä¸‹æœ€è¿‘æœ‰ä»€ä¹ˆå¥½çœ‹çš„ç”µå½±<unk>å¥½çœ‹çš„ç”µå½±',
        'asr_emotion': 'å¹³æ·¡'
    },
    'test_user_053': {
        'text': 'å—¯...é‚£ä¸ª...æ¨èå‡ æœ¬å¥½çœ‹çš„ç§‘å¹»å°è¯´<sil>ç§‘å¹»å°è¯´',
        'asr_emotion': 'å¹³æ·¡'
    },
    'test_user_054': {
        'text': 'å‘ƒ...å‘ƒ...æŸ¥ä¸€ä¸‹ä»Šå¤©çš„çƒ­ç‚¹æ–°é—»<unk>çƒ­ç‚¹æ–°é—»',
        'asr_emotion': 'å¹³æ·¡'
    },
    'test_user_055': {
        'text': 'å—¯...é‚£ä¸ª...é™„è¿‘æœ‰æ²¡æœ‰å¥½åƒçš„ç«é”…åº—<sil>ç«é”…åº—',
        'asr_emotion': 'å¹³æ·¡'
    },
    'test_user_056': {
        'text': 'å‘ƒ...å‘ƒ...å¸®æˆ‘æ‰¾ä¸€äº›å¥½å¬çš„éŸ³ä¹<unk>å¥½å¬çš„éŸ³ä¹',
        'asr_emotion': 'å¹³æ·¡'
    },
    'test_user_057': {
        'text': 'å—¯...é‚£ä¸ª...æŸ¥ä¸€ä¸‹è…¾è®¯è‚¡ç¥¨ä»Šå¤©çš„è¡Œæƒ…<sil>è‚¡ç¥¨è¡Œæƒ…',
        'asr_emotion': 'å¹³æ·¡'
    },
    'test_user_058': {
        'text': 'å‘ƒ...å‘ƒ...ä»åŒ—äº¬åˆ°ä¸Šæµ·çš„é«˜é“ç¥¨è¿˜æœ‰å—<unk>è¿˜æœ‰å—',
        'asr_emotion': 'å¹³æ·¡'
    },
    'test_user_059': {
        'text': 'å—¯...é‚£ä¸ª...æ„Ÿå†’äº†åº”è¯¥åƒä»€ä¹ˆè¯<sil>åƒä»€ä¹ˆè¯',
        'asr_emotion': 'å…³åˆ‡'
    },
    'test_user_060': {
        'text': 'å‘ƒ...å‘ƒ...æœ‰å“ªäº›å¥½çš„åœ¨çº¿è¯¾ç¨‹æ¨è<unk>åœ¨çº¿è¯¾ç¨‹',
        'asr_emotion': 'å¹³æ·¡'
    },
    'test_user_061': {
        'text': 'å—¯...é‚£ä¸ª...æŸ¥ä¸€ä¸‹å»ä¸‰äºšæ—…æ¸¸çš„æ”»ç•¥<sil>æ—…æ¸¸æ”»ç•¥',
        'asr_emotion': 'å¹³æ·¡'
    },
    'test_user_062': {
        'text': 'å‘ƒ...å‘ƒ...å¸®æˆ‘æ‰¾ä¸€äº›æ€§ä»·æ¯”é«˜çš„æ‰‹æœº<unk>æ€§ä»·æ¯”é«˜çš„æ‰‹æœº',
        'asr_emotion': 'å¹³æ·¡'
    },
    'test_user_063': {
        'text': 'å—¯...é‚£ä¸ª...æœ‰ä»€ä¹ˆå¥½åƒçš„å·èœæ¨èå—<sil>å·èœæ¨è',
        'asr_emotion': 'å¹³æ·¡'
    },
    'test_user_064': {
        'text': 'å‘ƒ...å‘ƒ...æŸ¥ä¸€ä¸‹æœ€æ–°çš„NBAæ¯”èµ›ç»“æœ<unk>æ¯”èµ›ç»“æœ',
        'asr_emotion': 'å¹³æ·¡'
    },
    'test_user_065': {
        'text': 'å—¯...é‚£ä¸ª...æœç´¢ä¸€ä¸‹äººå·¥æ™ºèƒ½çš„å‘å±•è¶‹åŠ¿<sil>å‘å±•è¶‹åŠ¿',
        'asr_emotion': 'å¹³æ·¡'
    },
    'test_user_066': {
        'text': 'å‘ƒ...å‘ƒ...æ—©ä¸Šå¥½å‘€<unk>æ—©ä¸Šå¥½',
        'asr_emotion': 'å¼€å¿ƒ'
    },
    'test_user_067': {
        'text': 'å—¯...é‚£ä¸ª...ä»Šå¤©å·¥ä½œå¾ˆé¡ºåˆ©<sil>å¾ˆé¡ºåˆ©',
        'asr_emotion': 'å¼€å¿ƒ'
    },
    'test_user_068': {
        'text': 'å‘ƒ...å‘ƒ...æœ€è¿‘å­¦ä¹ å‹åŠ›æœ‰ç‚¹å¤§<unk>æœ‰ç‚¹å¤§',
        'asr_emotion': 'å¹³æ·¡'
    },
    'test_user_069': {
        'text': 'å—¯...é‚£ä¸ª...å‘¨æœ«æ‰“ç®—å»çˆ¬å±±<sil>å»çˆ¬å±±',
        'asr_emotion': 'å¼€å¿ƒ'
    },
    'test_user_070': {
        'text': 'å‘ƒ...å‘ƒ...æœ€è¿‘åœ¨è¿½ä¸€éƒ¨å¾ˆç«çš„å‰§<unk>å¾ˆç«çš„å‰§',
        'asr_emotion': 'å¹³æ·¡'
    },
    'test_user_071': {
        'text': 'å—¯...é‚£ä¸ª...èº«ä½“ä¸å¤ªèˆ’æœ<sil>ä¸å¤ªèˆ’æœ',
        'asr_emotion': 'å…³åˆ‡'
    },
    'test_user_072': {
        'text': 'å‘ƒ...å‘ƒ...ä»Šå¤©å¤©æ°”çœŸä¸é”™<unk>çœŸä¸é”™',
        'asr_emotion': 'å¼€å¿ƒ'
    },
    'test_user_073': {
        'text': 'å—¯...é‚£ä¸ª...æœ€è¿‘å®¶é‡Œä¸€åˆ‡éƒ½å¥½<sil>ä¸€åˆ‡éƒ½å¥½',
        'asr_emotion': 'å¹³æ·¡'
    },
    'test_user_074': {
        'text': 'å‘ƒ...å‘ƒ...å¥½ä¹…æ²¡å’Œæœ‹å‹èšäº†<unk>å’Œæœ‹å‹èšäº†',
        'asr_emotion': 'å¹³æ·¡'
    },
    'test_user_075': {
        'text': 'å—¯...é‚£ä¸ª...ä½ è®°å¾—æˆ‘ä¸Šæ¬¡è·Ÿä½ è¯´è¿‡æˆ‘å–œæ¬¢ä»€ä¹ˆè¿åŠ¨å—<sil>ä»€ä¹ˆè¿åŠ¨',
        'asr_emotion': 'å…³åˆ‡'
    },
    'test_user_076': {
        'text': 'å‘ƒ...å‘ƒ...è¿˜è®°å¾—æˆ‘è·Ÿä½ è¯´è¿‡æˆ‘çš„å·¥ä½œæ˜¯ä»€ä¹ˆå—<unk>å·¥ä½œæ˜¯ä»€ä¹ˆ',
        'asr_emotion': 'å…³åˆ‡'
    },
    'test_user_077': {
        'text': 'å—¯...é‚£ä¸ª...ä½ è®°å¾—æˆ‘ä¸Šæ¬¡è·Ÿä½ è¯´çš„é‚£ä¸ªæ¢¦æƒ³å—<sil>é‚£ä¸ªæ¢¦æƒ³',
        'asr_emotion': 'å…³åˆ‡'
    },
    'test_user_078': {
        'text': 'å‘ƒ...å‘ƒ...è¿˜è®°å¾—æˆ‘ä¸Šæ¬¡è·Ÿä½ è¯´çš„å­¦ä¹ è®¡åˆ’å—<unk>å­¦ä¹ è®¡åˆ’',
        'asr_emotion': 'å…³åˆ‡'
    },
    'test_user_079': {
        'text': 'å—¯...é‚£ä¸ª...ä½ è®°å¾—æˆ‘ä¸Šæ¬¡è·Ÿä½ è¯´çš„å…´è¶£çˆ±å¥½å—<sil>å…´è¶£çˆ±å¥½',
        'asr_emotion': 'å…³åˆ‡'
    },
    'test_user_080': {
        'text': 'å‘ƒ...å‘ƒ...è¿˜è®°å¾—æˆ‘ä¸Šæ¬¡è·Ÿä½ è¯´çš„ç”Ÿæ´»ä¹ æƒ¯å—<unk>ç”Ÿæ´»ä¹ æƒ¯',
        'asr_emotion': 'å…³åˆ‡'
    },
    'test_user_081': {
        'text': 'å—¯...é‚£ä¸ª...ä½ è®°å¾—æˆ‘ä¸Šæ¬¡è·Ÿä½ è¯´çš„ç›®æ ‡æ˜¯ä»€ä¹ˆå—<sil>ç›®æ ‡æ˜¯ä»€ä¹ˆ',
        'asr_emotion': 'å…³åˆ‡'
    },
    'test_user_082': {
        'text': 'å‘ƒ...å‘ƒ...è¿˜è®°å¾—æˆ‘ä¸Šæ¬¡è·Ÿä½ è¯´çš„é‚£æ¬¡ç»å†å—<unk>é‚£æ¬¡ç»å†',
        'asr_emotion': 'å…³åˆ‡'
    },
    'test_user_083': {
        'text': 'å—¯...é‚£ä¸ª...æœ‰ç‚¹æ— èŠ<sil>ä¸çŸ¥é“å¹²ä»€ä¹ˆä¸çŸ¥é“å¹²ä»€ä¹ˆ',
        'asr_emotion': 'å¹³æ·¡'
    },
    'test_user_084': {
        'text': 'å‘ƒ...å‘ƒ...å†·åœºäº†<unk>ä½ æ¨èä¸ªè¯é¢˜å§ä½ æ¨èä¸ªè¯é¢˜å§',
        'asr_emotion': 'å¹³æ·¡'
    },
    'test_user_085': {
        'text': 'å—¯...é‚£ä¸ª...ä¸çŸ¥é“èŠä»€ä¹ˆäº†<sil>æ¨èç‚¹å¥½ç©çš„æ¨èç‚¹å¥½ç©çš„',
        'asr_emotion': 'å¹³æ·¡'
    },
    'test_user_086': {
        'text': 'å‘ƒ...å‘ƒ...æœ€è¿‘æ²¡ä»€ä¹ˆå¨±ä¹æ´»åŠ¨<unk>æ¨èç‚¹å¥½ç©çš„æ¨èç‚¹å¥½ç©çš„',
        'asr_emotion': 'å¹³æ·¡'
    },
    'test_user_087': {
        'text': 'å—¯...é‚£ä¸ª...æƒ³å­¦ç‚¹æ–°ä¸œè¥¿<sil>ä½ æ¨èä¸€ä¸‹ä½ æ¨èä¸€ä¸‹',
        'asr_emotion': 'å¹³æ·¡'
    },
    'test_user_088': {
        'text': 'å‘ƒ...å‘ƒ...ä¸çŸ¥é“åƒä»€ä¹ˆå¥½<unk>ä½ æ¨èä¸€ä¸‹å§ä½ æ¨èä¸€ä¸‹å§',
        'asr_emotion': 'å¹³æ·¡'
    },
    'test_user_089': {
        'text': 'å—¯...é‚£ä¸ª...æƒ³å»æ—…æ¸¸<sil>æ¨èä¸ªå¥½ç©çš„åœ°æ–¹æ¨èä¸ªå¥½ç©çš„åœ°æ–¹',
        'asr_emotion': 'å¹³æ·¡'
    }
}

def update_csv_file(input_file, output_file):
    """
    æ›´æ–°CSVæ–‡ä»¶ä¸­çš„è¯æœ¯
    """
    updated_rows = []
    updated_count = 0
    
    with open(input_file, 'r', encoding='utf-8') as f:
        reader = csv.DictReader(f, delimiter='|')
        fieldnames = reader.fieldnames
        
        for row in reader:
            user_id = row['user_id']
            
            if user_id in UPDATE_MAPPING:
                update_info = UPDATE_MAPPING[user_id]
                
                # è§£æhistoryå­—æ®µ
                history = eval(row['history'])
                if history and len(history) > 0:
                    # æ›´æ–°textå­—æ®µ
                    history[0]['text'] = update_info['text']
                    # æ›´æ–°asr_emotionå­—æ®µ
                    row['asr_emotion'] = update_info['asr_emotion']
                    # é‡æ–°åºåˆ—åŒ–history
                    row['history'] = str(history).replace("'", '"')
                    
                    updated_count += 1
                    print(f"âœ“ æ›´æ–° {user_id}: {update_info['text'][:30]}...")
            
            updated_rows.append(row)
    
    # å†™å…¥æ›´æ–°åçš„æ–‡ä»¶
    with open(output_file, 'w', encoding='utf-8', newline='') as f:
        writer = csv.DictWriter(f, fieldnames=fieldnames, delimiter='|')
        writer.writeheader()
        writer.writerows(updated_rows)
    
    print(f"\nâœ… å®Œæˆï¼å…±æ›´æ–° {updated_count} æ¡è®°å½•")
    print(f"ğŸ“ è¾“å‡ºæ–‡ä»¶: {output_file}")

if __name__ == '__main__':
    input_file = r'e:\AIæµ‹è¯•ç”¨ä¾‹\æ¥å£æµ‹è¯•\data\intent_recognition_test_data_v2.csv'
    output_file = r'e:\AIæµ‹è¯•ç”¨ä¾‹\æ¥å£æµ‹è¯•\data\intent_recognition_test_data_v2.csv'
    
    update_csv_file(input_file, output_file)
