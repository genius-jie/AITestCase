# ğŸš€ æ‰¹é‡æ›´æ–° CSV æµ‹è¯•æ•°æ® - å¿«é€ŸæŒ‡å—

## âœ¨ æ ¸å¿ƒä¼˜åŠ¿

**é…ç½®é©±åŠ¨æ–¹æ¡ˆ** = AGENT ç”Ÿæˆå†…å®¹ + Python æ‰¹é‡å¤„ç†

| ç‰¹æ€§ | ä¼ ç»Ÿé€è¡Œä¿®æ”¹ | é…ç½®é©±åŠ¨æ–¹æ¡ˆ |
|------|------------|------------|
| AGENT è°ƒç”¨æ¬¡æ•° | N æ¬¡ | **1 æ¬¡** |
| æ–‡ä»¶ I/O æ¬¡æ•° | 2N æ¬¡ | **2 æ¬¡** |
| æ›´æ–° 100 æ¡è€—æ—¶ | ~10 åˆ†é’Ÿ | **~10 ç§’** |
| é€Ÿåº¦æå‡ | - | **60 å€** âš¡ |
| å¯å®¡æŸ¥æ€§ | å·® | âœ… å¥½ |
| å¯å›æ»šæ€§ | å·® | âœ… å¥½ |

## ğŸ“¦ å·²åˆ›å»ºçš„æ–‡ä»¶

```
e:\AIæµ‹è¯•ç”¨ä¾‹\æ¥å£æµ‹è¯•\
â”œâ”€â”€ batch_update_csv.py              # æ‰¹é‡æ›´æ–°è„šæœ¬ï¼ˆæ ¸å¿ƒï¼‰
â”œâ”€â”€ update_config_template.json      # é…ç½®æ–‡ä»¶æ¨¡æ¿
â”œâ”€â”€ update_config_demo.json          # æ¼”ç¤ºé…ç½®æ–‡ä»¶
â”œâ”€â”€ æ‰¹é‡æ›´æ–°å·¥ä½œæµ.md                 # è¯¦ç»†å·¥ä½œæµæ–‡æ¡£
â””â”€â”€ å¿«é€ŸæŒ‡å—.md                       # æœ¬æ–‡ä»¶
```

## ğŸ¯ ä¸‰æ­¥å®Œæˆæ‰¹é‡æ›´æ–°

### æ­¥éª¤ 1ï¼šè®© AGENT ç”Ÿæˆé…ç½®æ–‡ä»¶

**ç”¨æˆ·æŒ‡ä»¤ï¼š**
```
è¯·ä¸ºä»¥ä¸‹ user_id ç”Ÿæˆæ–°çš„ history å€¼ï¼Œè¦æ±‚ï¼š
- æ¨¡æ‹ŸçœŸå®äººç±»è¯´è¯
- 20% æ¦‚ç‡ç©¿æ’ ASR å¼‚å¸¸ç‰¹å¾ï¼ˆå¡«å……è¯ã€<unk>ã€<sil>ã€é‡å¤è¡¨è¾¾ï¼‰
- ä¿æŒåŸæœ‰çš„æ„å›¾å’Œæƒ…ç»ª

éœ€è¦æ›´æ–°çš„ user_idï¼š
- test_user_001: æŸ¥è¯¢å¤©æ°”
- test_user_002: æŸ¥è¯¢é¤å…
- test_user_003: æ‰“æ‹›å‘¼

è¯·ç”Ÿæˆ update_config.json é…ç½®æ–‡ä»¶
```

**AGENT è¾“å‡ºï¼š**
```json
{
  "description": "æ‰¹é‡æ›´æ–° CSV æ–‡ä»¶çš„ history å­—æ®µé…ç½®",
  "version": "1.0",
  "updates": {
    "test_user_001": "[{\"role\":\"user\",\"text\":\"å‘ƒ...å‘ƒ...ä»Šå¤©åŒ—äº¬å¤©æ°”æ€ä¹ˆæ ·<unk>å¤©æ°”æ€ä¹ˆæ ·\"}]",
    "test_user_002": "[{\"role\":\"user\",\"text\":\"å—¯...é‚£ä¸ª...å¸®æˆ‘æŸ¥ä¸€ä¸‹é™„è¿‘çš„é¤å…<sil>é™„è¿‘çš„é¤å…\"}]",
    "test_user_003": "[{\"role\":\"user\",\"text\":\"ä½ å¥½å‘€<unk>ä½ å¥½å‘€\"}]"
  }
}
```

### æ­¥éª¤ 2ï¼šå®¡æŸ¥é…ç½®æ–‡ä»¶

æ‰‹åŠ¨æ£€æŸ¥ `update_config.json`ï¼š
- âœ… JSON æ ¼å¼æ­£ç¡®
- âœ… history å€¼ç¬¦åˆè¦æ±‚
- âœ… åŒå¼•å·å·²æ­£ç¡®è½¬ä¹‰

### æ­¥éª¤ 3ï¼šè¿è¡Œæ‰¹é‡æ›´æ–°

```powershell
cd e:\AIæµ‹è¯•ç”¨ä¾‹\æ¥å£æµ‹è¯•
python batch_update_csv.py
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
ğŸš€ å¼€å§‹æ‰¹é‡æ›´æ–° CSV æ–‡ä»¶

ğŸ“¦ å·²å¤‡ä»½åˆ°: e:\AIæµ‹è¯•ç”¨ä¾‹\æ¥å£æµ‹è¯•\data\intent_recognition_test_data_v2_backup_20260112_143022.csv
ğŸ“ å‡†å¤‡æ›´æ–° 5 æ¡è®°å½•...
============================================================
âœ“ test_user_001: å·²æ›´æ–°
âœ“ test_user_002: å·²æ›´æ–°
âœ“ test_user_003: å·²æ›´æ–°
============================================================
âœ… å®Œæˆï¼å…±æ›´æ–° 3 æ¡è®°å½•
ğŸ“„ è¾“å‡ºæ–‡ä»¶: e:\AIæµ‹è¯•ç”¨ä¾‹\æ¥å£æµ‹è¯•\data\intent_recognition_test_data_v2.csv

ğŸ‰ æ›´æ–°å®Œæˆï¼
```

## ğŸ” éªŒè¯æ›´æ–°ç»“æœ

```powershell
# æŸ¥çœ‹æ›´æ–°åçš„è®°å½•
Get-Content data\intent_recognition_test_data_v2.csv | Select-String -Pattern "test_user_001|test_user_002|test_user_003"
```

## ğŸ“Š é…ç½®æ–‡ä»¶æ ¼å¼è¯´æ˜

### åŸºæœ¬æ ¼å¼

```json
{
  "description": "æè¿°ä¿¡æ¯",
  "version": "1.0",
  "created_at": "2026-01-12",
  "updates": {
    "user_id": "æ–°çš„ history å€¼ï¼ˆJSON å­—ç¬¦ä¸²ï¼‰"
  }
}
```

### å…³é”®è¦ç‚¹

1. **user_id**: å¿…é¡»æ˜¯ CSV æ–‡ä»¶ä¸­å­˜åœ¨çš„ user_id
2. **history å€¼**: å¿…é¡»æ˜¯æœ‰æ•ˆçš„ JSON å­—ç¬¦ä¸²
3. **è½¬ä¹‰è§„åˆ™**: åŒå¼•å·å¿…é¡»è½¬ä¹‰ä¸º `\"`
4. **é€‰æ‹©æ€§æ›´æ–°**: åªé…ç½®éœ€è¦æ›´æ–°çš„è®°å½•

### ç¤ºä¾‹

```json
{
  "updates": {
    "test_user_001": "[{\"role\":\"user\",\"text\":\"å‘ƒ...å‘ƒ...ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·<unk>å¤©æ°”æ€ä¹ˆæ ·\"}]",
    "test_user_002": "[{\"role\":\"user\",\"text\":\"å—¯...é‚£ä¸ª...å¸®æˆ‘æŸ¥ä¸€ä¸‹é™„è¿‘çš„é¤å…<sil>é™„è¿‘çš„é¤å…\"}]"
  }
}
```

## ğŸ¨ ASR å¼‚å¸¸ç‰¹å¾è¯´æ˜

æ ¹æ®æç¤ºè¯è¦æ±‚ï¼Œä»¥ **20% çš„æ¦‚ç‡**ç©¿æ’ä»¥ä¸‹ç‰¹å¾ï¼š

| ç‰¹å¾ | æ ‡è®° | ç¤ºä¾‹ |
|------|------|------|
| å¡«å……è¯ | å—¯...é‚£ä¸ª...ã€å‘ƒ...å‘ƒ... | `"å‘ƒ...å‘ƒ...ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·"` |
| æœªçŸ¥è¯ | `<unk>` | `"æ¨èä¸€é¦–å¥½å¬çš„æ­Œ<unk>å¥½å¬çš„æ­Œ"` |
| é™éŸ³ | `<sil>` | `"å—¯...é‚£ä¸ª...çœ‹çœ‹è¿™å¼ å›¾ç‰‡<sil>æœ‰ä»€ä¹ˆ"` |
| é‡å¤è¡¨è¾¾ | é‡å¤çŸ­è¯­ | `"æ¨èç‚¹å¥½ç©çš„æ¨èç‚¹å¥½ç©çš„"` |

## ğŸ’¡ é«˜çº§ç”¨æ³•

### åˆ†æ‰¹æ›´æ–°

å¦‚æœéœ€è¦æ›´æ–°å¤§é‡è®°å½•ï¼Œå¯ä»¥åˆ†æ‰¹è¿›è¡Œï¼š

**æ‰¹æ¬¡ 1 (1-20 æ¡):**
```json
{
  "batch": 1,
  "total_batches": 5,
  "updates": {
    "test_user_001": "...",
    "test_user_002": "...",
    ...
    "test_user_020": "..."
  }
}
```

**æ‰¹æ¬¡ 2 (21-40 æ¡):**
```json
{
  "batch": 2,
  "total_batches": 5,
  "updates": {
    "test_user_021": "...",
    ...
    "test_user_040": "..."
  }
}
```

### å¢é‡æ›´æ–°

åªæ›´æ–°éœ€è¦ä¿®æ”¹çš„è®°å½•ï¼š

```json
{
  "updates": {
    "test_user_001": "...",  // åªä¿®æ”¹è¿™ä¸€æ¡
    "test_user_050": "..."   // åªä¿®æ”¹è¿™ä¸€æ¡
  }
}
```

### å›æ»šåˆ°å¤‡ä»½

å¦‚æœæ›´æ–°ç»“æœä¸æ»¡æ„ï¼Œå¯ä»¥å›æ»šï¼š

```powershell
# æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶
Get-ChildItem data\intent_recognition_test_data_v2_backup_*.csv | Sort-Object LastWriteTime -Descending

# æ¢å¤æœ€æ–°çš„å¤‡ä»½
Copy-Item data\intent_recognition_test_data_v2_backup_20260112_143022.csv data\intent_recognition_test_data_v2.csv
```

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

### è‡ªåŠ¨å¤‡ä»½

è„šæœ¬ä¼šåœ¨æ›´æ–°å‰è‡ªåŠ¨å¤‡ä»½åŸæ–‡ä»¶ï¼š

```
ğŸ“¦ å·²å¤‡ä»½åˆ°: e:\AIæµ‹è¯•ç”¨ä¾‹\æ¥å£æµ‹è¯•\data\intent_recognition_test_data_v2_backup_20260112_143022.csv
```

### é”™è¯¯å¤„ç†

- âœ… é…ç½®æ–‡ä»¶ä¸ºç©ºæ—¶æç¤º
- âœ… user_id ä¸å­˜åœ¨æ—¶ç»Ÿè®¡å¹¶æç¤º
- âœ… JSON æ ¼å¼é”™è¯¯æ—¶æŠ›å‡ºå¼‚å¸¸

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

### æ›´æ–° 100 æ¡è®°å½•

| æ–¹å¼ | AGENT è°ƒç”¨ | æ–‡ä»¶ I/O | è€—æ—¶ |
|------|-----------|---------|------|
| é€è¡Œä¿®æ”¹ | 100 æ¬¡ | 200 æ¬¡ | ~10 åˆ†é’Ÿ |
| é…ç½®é©±åŠ¨ | 1 æ¬¡ | 2 æ¬¡ | ~10 ç§’ |

**é€Ÿåº¦æå‡ï¼šçº¦ 60 å€** âš¡

### æ›´æ–° 1000 æ¡è®°å½•

| æ–¹å¼ | AGENT è°ƒç”¨ | æ–‡ä»¶ I/O | è€—æ—¶ |
|------|-----------|---------|------|
| é€è¡Œä¿®æ”¹ | 1000 æ¬¡ | 2000 æ¬¡ | ~100 åˆ†é’Ÿ |
| é…ç½®é©±åŠ¨ | 1 æ¬¡ | 2 æ¬¡ | ~15 ç§’ |

**é€Ÿåº¦æå‡ï¼šçº¦ 400 å€** âš¡âš¡

## ğŸ¯ æœ€ä½³å®è·µ

1. **å°æ­¥å¿«è·‘**ï¼šæ¯æ¬¡æ›´æ–° 10-20 æ¡è®°å½•
2. **ç‰ˆæœ¬æ§åˆ¶**ï¼šä¸ºé…ç½®æ–‡ä»¶æ·»åŠ ç‰ˆæœ¬å·
3. **å®¡æŸ¥é…ç½®**ï¼šæ›´æ–°å‰æ‰‹åŠ¨æ£€æŸ¥é…ç½®æ–‡ä»¶
4. **éªŒè¯ç»“æœ**ï¼šæ›´æ–°åéªŒè¯å…³é”®è®°å½•
5. **ä¿ç•™å¤‡ä»½**ï¼šä¸è¦åˆ é™¤å¤‡ä»½æ–‡ä»¶
6. **è®°å½•æ—¥å¿—**ï¼šè®°å½•æ¯æ¬¡æ›´æ–°çš„è¯¦ç»†ä¿¡æ¯

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¤åˆ¶æ¨¡æ¿

```powershell
Copy-Item update_config_template.json update_config.json
```

### 2. ç¼–è¾‘é…ç½®æ–‡ä»¶

```json
{
  "description": "æˆ‘çš„ç¬¬ä¸€æ¬¡æ‰¹é‡æ›´æ–°",
  "version": "1.0",
  "updates": {
    "test_user_001": "[{\"role\":\"user\",\"text\":\"ä½ çš„æ–°æ–‡æœ¬\"}]"
  }
}
```

### 3. è¿è¡Œæ›´æ–°

```powershell
python batch_update_csv.py
```

### 4. éªŒè¯ç»“æœ

```powershell
Get-Content data\intent_recognition_test_data_v2.csv | Select-String -Pattern "test_user_001"
```

## ğŸ“ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•åªæ›´æ–°éƒ¨åˆ†å­—æ®µï¼Ÿ

A: ä¿®æ”¹ `batch_update_csv.py` è„šæœ¬ï¼Œæ”¯æŒæŒ‡å®šå­—æ®µï¼š

```python
def update_csv_from_config(csv_path, config_path, field='history'):
    # ä¿®æ”¹ field å‚æ•°
    row[field] = updates[user_id]
```

### Q: å¦‚ä½•æ‰¹é‡åˆ é™¤è®°å½•ï¼Ÿ

A: åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  `"action": "delete"`ï¼š

```json
{
  "updates": {
    "test_user_001": {"action": "delete"}
  }
}
```

### Q: å¦‚ä½•æ‰¹é‡æ’å…¥æ–°è®°å½•ï¼Ÿ

A: åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  `"action": "insert"`ï¼š

```json
{
  "updates": {
    "test_user_200": {
      "action": "insert",
      "data": {
        "session_id": "session_200",
        "history": "...",
        "asr_emotion": "å¹³æ·¡",
        ...
      }
    }
  }
}
```

## ğŸ‰ æ€»ç»“

**é…ç½®é©±åŠ¨æ–¹æ¡ˆ**å®Œç¾è§£å†³äº†ä½ çš„éœ€æ±‚ï¼š

âœ… **AGENT åŠ¨æ€ç”Ÿæˆ**ï¼šAGENT ä¸“æ³¨äºç”Ÿæˆé«˜è´¨é‡çš„å†…å®¹  
âœ… **æ‰¹é‡é«˜æ•ˆå¤„ç†**ï¼šPython è„šæœ¬ä¸€æ¬¡æ€§æ‰¹é‡æ›´æ–°ï¼Œé€Ÿåº¦å¿«  
âœ… **å¯å®¡æŸ¥å¯å›æ»š**ï¼šé…ç½®æ–‡ä»¶é›†ä¸­ç®¡ç†ï¼Œè‡ªåŠ¨å¤‡ä»½  
âœ… **çµæ´»å¯æ§**ï¼šæ”¯æŒåˆ†æ‰¹æ›´æ–°ã€å¢é‡æ›´æ–°ã€æ¡ä»¶æ›´æ–°  

**å¼€å§‹ä½¿ç”¨å§ï¼** ğŸš€
