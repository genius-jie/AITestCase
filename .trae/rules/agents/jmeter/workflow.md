@workflow_type: business
@usage_mode: execution
@enforcement: executable

# JMeter测试执行工作流

## 阶段1: 需求分析与规则提取（A1）

### 步骤1.1: 读取测试项目规则文档
- 操作：使用Read工具读取测试项目规则文档
- 输入：规则文档路径
- 输出：规则文档内容

### 步骤1.2: 分析接口文档与业务逻辑
- 操作：分析接口文档和业务逻辑文档
- 输入：规则文档内容
- 输出：接口分析结果、业务逻辑分析结果

### 步骤1.3: 数据策略初步分析
- 操作：进行数据来源决策的初步分析
- 输入：接口分析结果、业务逻辑分析结果
- 输出：数据策略初步分析结果
- **关键分析点**：
  - 是否依赖已有业务实体？
  - 是否存在"数据前置条件"？
  - 业务约束强度如何？

### 步骤1.4: 提取测试数据契约
- 操作：从文档中提取测试数据契约
- 输入：接口分析结果、业务逻辑分析结果、数据策略初步分析结果
- 输出：测试数据契约

### 步骤1.5: 生成A1阶段文档
- 操作：生成A1阶段的三件套文档
- 输入：测试数据契约、数据策略初步分析结果
- 输出：A1阶段文档

## 阶段2: 流程架构与标准制定（A2）

### 步骤2.1: 设计测试流程架构
- 操作：设计测试流程架构和标准
- 输入：测试数据契约
- 输出：测试流程架构设计

### 步骤2.2: 数据策略详细分析
- 操作：进行数据来源决策的详细分析
- 输入：测试流程架构设计
- 输出：数据策略详细分析结果
- **关键分析点**：
  - 是否可以通过接口构造数据？
  - 构造成本是否可接受？
  - 数据构造的稳定性如何？

### 步骤2.3: 制定测试标准
- 操作：制定测试标准和规范
- 输入：测试流程架构设计、数据策略详细分析结果
- 输出：测试标准文档

### 步骤2.4: 生成A2阶段文档
- 操作：生成A2阶段的三件套文档
- 输入：测试标准文档、数据策略详细分析结果
- 输出：A2阶段文档

## 阶段3: 资产聚合与标准化（A3）

### 步骤3.1: 收集测试资产
- 操作：收集测试数据、脚本、配置等资产
- 输入：测试标准文档
- 输出：测试资产清单

### 步骤3.2: 数据策略最终决策
- 操作：完成数据来源决策的最终分析
- 输入：测试资产清单
- 输出：数据策略最终决策结果
- **关键产出**：
  - 数据来源决策表（CSV/动态/混合）
  - CSV字段清单（如果需要）
  - 并发风险说明
  - 回退策略设计

### 步骤3.3: 标准化测试资产
- 操作：对测试资产进行标准化处理
- 输入：测试资产清单、数据策略最终决策结果
- 输出：标准化后的测试资产

### 步骤3.4: 生成A3阶段文档
- 操作：生成A3阶段的三件套文档
- 输入：标准化后的测试资产、数据策略最终决策结果
- 输出：A3阶段文档

## 阶段4: 数据构造与工具适配（A4）

### 步骤4.1: 验证数据策略一致性
- 操作：验证A3阶段的数据策略决策结果
- 输入：数据策略最终决策结果
- 输出：验证通过的数据策略
- **执行约束**：
  - 严格执行已批准的数据策略
  - 不得自行引入/移除CSV
  - 不得推翻A1-A3的决策

### 步骤4.2: 构造测试数据
- 操作：根据数据策略构造测试数据
- 输入：测试数据契约、验证通过的数据策略
- 输出：测试数据文件

### 步骤4.3: 适配测试工具
- 操作：适配测试工具，配置测试脚本
- 输入：测试数据文件、测试脚本、验证通过的数据策略
- 输出：配置好的测试脚本

### 步骤4.4: 生成A4阶段文档
- 操作：生成A4阶段的三件套文档
- 输入：配置好的测试脚本、验证通过的数据策略
- 输出：A4阶段文档

## 阶段5: 测试执行与问题调试（A5）

### 步骤5.1: 验证数据策略执行
- 操作：验证A4阶段的数据策略执行情况
- 输入：配置好的测试脚本、验证通过的数据策略
- 输出：数据策略执行验证结果
- **执行约束**：
  - 确保脚本符合数据策略要求
  - 检查CSV使用是否符合决策
  - 验证动态参数生成逻辑

### 步骤5.2: 执行测试
- 操作：使用测试工具命令执行测试
- 输入：配置好的测试脚本、数据策略执行验证结果
- 输出：测试结果文件

### 步骤5.3: 收集测试结果
- 操作：收集和整理测试结果
- 输入：测试结果文件
- 输出：整理后的测试结果

### 步骤5.4: 分析测试失败
- 操作：分析测试失败的原因
- 输入：整理后的测试结果、数据策略执行验证结果
- 输出：失败原因分析

### 步骤5.5: 生成A5阶段文档
- 操作：生成A5阶段的三件套文档
- 输入：失败原因分析、数据策略执行验证结果
- 输出：A5阶段文档

## 阶段6: 结果评估与体系迭代（A6）

### 步骤6.1: 生成可视化测试报告
- 操作：使用测试工具生成可视化测试报告
- 输入：测试结果文件
- 输出：可视化测试报告

### 步骤6.2: 评估测试结果
- 操作：评估测试结果的有效性和完整性
- 输入：可视化测试报告、整理后的测试结果
- 输出：测试结果评估报告

### 步骤6.3: 生成优化建议
- 操作：根据测试结果生成优化建议
- 输入：测试结果评估报告
- 输出：优化建议文档

### 步骤6.4: 生成A6阶段文档
- 操作：生成A6阶段的三件套文档
- 输入：优化建议文档
- 输出：A6阶段文档

## 执行流程约束
1. **阶段依赖**：严格遵循A1→A2→A3→A4→A5→A6的执行顺序
2. **文档完整性**：每个阶段必须生成完整的三件套文档
3. **测试执行**：必须使用JMeter工具执行测试，生成标准的JTL结果文件
4. **报告生成**：必须生成HTML格式的可视化测试报告
5. **文件路径**：所有文件路径必须使用绝对路径
6. **禁止臆造**：严禁臆造测试结果，必须基于实际执行结果

---

## 跨阶段流程：业务规则变更与级联更新

### 流程引用
本流程的完整定义请参考：[6a_test_flow.md中的CROSS-FLOW-001](../../workflows/6a_test_flow.md#跨阶段流程业务规则变更与级联更新)

### 流程概述
当业务规则发生变更时，需要分析影响范围并级联更新相关文档和资产。本流程适用于：
- 业务规则文档（如OTA测试业务规则约定.md）发生变更
- 接口文档发生变更
- 测试需求发生变更
- 发现业务规则与实际实现不一致

### 流程触发条件
@trigger_conditions:
  - business_rule_changed: 业务规则文档发生变更
  - api_document_changed: 接口文档发生变更
  - test_requirement_changed: 测试需求发生变更
  - rule_implementation_mismatch: 发现业务规则与实际实现不一致

### 流程目标
- 分析业务规则变更的影响范围
- 级联更新受影响的阶段文档（A2-A6）
- 重新设计受影响的测试数据
- 更新测试脚本以适配新规则
- 确保所有文档和资产的一致性

### 各阶段在跨阶段流程中的职责

#### A2阶段职责
@phase_id: A2
@cross_flow_role: 架构文档更新
@upstream_phases: [A1]
@depends_on: [CROSS-FLOW-001-1]

**核心动作**：
- 更新接口依赖关系图
- 更新测试架构设计
- 更新场景设计规则
- 在SCENARIO-004等场景规则中添加新的业务约束

#### A4阶段职责
@phase_id: A4
@cross_flow_role: 脚本文档更新 + 数据设计
@upstream_phases: [A3]
@depends_on: [CROSS-FLOW-001-2]

**核心动作**：
- 更新接口实现说明
- 更新场景实现说明
- 添加业务规则变更说明
- 重新设计测试数据，确保符合新规则
- 验证测试数据的完整性和唯一性

**数据设计原则**：
- **唯一性约束**：对于有唯一性要求的字段（如version），确保除冲突测试用例外，其他用例值各不相同
- **冲突测试**：专门设计冲突场景，验证系统对重复值的处理
- **命名规范**：使用时间戳或递增序号确保唯一性
- **场景覆盖**：确保正常流程、边界、异常场景都有覆盖

#### A5阶段职责
@phase_id: A5
@cross_flow_role: 脚本验证 + 断言调整
@upstream_phases: [A4]
@depends_on: [CROSS-FLOW-001-4]

**核心动作**：
- 更新执行环境说明
- 更新测试场景说明
- 添加业务规则变更说明
- 验证脚本可达性
- 根据新规则调整断言逻辑

**断言调整原则**：
- **公共组件集中管理**：使用HTTP Request Defaults集中管理服务器配置和全局请求头
- **变量传递正确性**：确保变量提取和传递逻辑符合新规则
- **断言逻辑更新**：根据业务规则更新断言条件
- **配置优先级**：遵循单个请求配置 > HTTP Request Defaults > Test Plan级别配置

### 流程执行顺序
```
CROSS-FLOW-001-1: 变更识别与影响分析
    ↓
CROSS-FLOW-001-2: 级联更新A2-A4文档
    ↓
CROSS-FLOW-001-3: 重新设计测试数据
    ↓
CROSS-FLOW-001-4: 更新测试脚本
    ↓
CROSS-FLOW-001-5: 级联更新A5-A6文档
    ↓
CROSS-FLOW-001-6: 验证与测试
```

### 流程完成判定
本流程被视为"执行完成"，必须同时满足以下条件：

1. 所有受影响的文档都已更新
2. 测试数据已重新设计并验证
3. 测试脚本已更新并验证
4. 所有文档间保持一致
5. 验证测试通过
6. 变更历史已完整记录

### 流程应用示例
**示例场景**：创建升级包接口的version字段必须唯一

**执行流程**:
1. **CROSS-FLOW-001-1**：识别version唯一性约束变更，分析影响范围为A2-A6
2. **CROSS-FLOW-001-2**：更新A2-A4文档，在SCENARIO-004中添加version唯一性约束
3. **CROSS-FLOW-001-3**：重新设计测试数据，使用递增序号确保version唯一性，添加version冲突测试用例
4. **CROSS-FLOW-001-4**：更新测试脚本，确保version参数化正确
5. **CROSS-FLOW-001-5**：更新A5-A6文档，添加version唯一性约束说明
6. **CROSS-FLOW-001-6**：验证所有文档一致性，执行测试验证功能正常

**输出结果**:
- 更新后的OTA测试业务规则约定.md
- 更新后的A4_脚本编写.md
- 更新后的test_data.csv（16条数据，version使用递增序号）
- 验证测试报告

### 与阶段三件套的关系
本流程与各阶段三件套的关系：

| 阶段 | 三件套 | 流程中的角色 |
|------|--------|------------|
| A2 | workflow.md, role.prompt.md, mistakes.md | 被更新对象 |
| A3 | workflow.md, role.prompt.md, mistakes.md | 被更新对象 |
| A4 | workflow.md, role.prompt.md, mistakes.md | 被更新对象 + 数据设计 |
| A5 | workflow.md, role.prompt.md, mistakes.md | 被更新对象 + 脚本验证 |
| A6 | workflow.md, role.prompt.md, mistakes.md | 被更新对象 + 评估记录 |
