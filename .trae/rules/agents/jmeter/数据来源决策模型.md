# 数据来源决策模型（Data Strategy Model）

**文档版本**：1.0.0
**最后更新**：2026-01-15
**维护团队**：QA Team

---

## 1. 核心概念

### 1.1 数据来源决策定义
**数据来源决策**是确定测试数据来源方式的系统化分析过程，**不是由测试类型决定的硬性规则**。

### 1.2 决策原则
- **CSV是否使用 = 数据来源决策结果**
- **数据策略必须在A1-A3阶段完成分析**
- **A4-A5仅允许执行，不允许决策**

---

## 2. 数据策略字段定义（Agent必须输出）

### 2.1 统一数据策略字段
```text
data_strategy:
  use_csv: true | false
  csv_reason: <原因>
  csv_scope: control | identity | relation
  concurrency_safe: true | false
  fallback_strategy: dynamic | skip
```

### 2.2 字段说明

| 字段 | 类型 | 说明 | 示例 |
|------|------|------|------|
| use_csv | boolean | 是否使用CSV | true |
| csv_reason | string | CSV使用原因 | "用户账号必须真实存在" |
| csv_scope | enum | CSV范围 | control（控制参数） |
| concurrency_safe | boolean | 并发安全 | true |
| fallback_strategy | enum | 回退策略 | dynamic（动态生成） |

---

## 3. 数据策略判定原则

### 3.1 ✅ 必须使用CSV的场景

#### 3.1.1 业务实体必须真实存在
- 用户/账号/商户/设备**必须真实存在**
- 数据存在**强校验/强约束**
- **示例**：会员系统测试，必须使用真实会员账号

#### 3.1.2 业务状态无法快速构造
- 状态依赖**复杂业务链路**
- 构造成本**不可接受**
- **示例**：订单状态测试，需要完整下单流程

#### 3.1.3 数据关系必须稳定
- 上下游绑定关系
- 权限树结构
- **示例**：组织架构测试，需要固定层级关系

### 3.2 ❌ 不建议使用CSV的场景

#### 3.2.1 参数纯展示/日志字段
- 不影响业务逻辑
- 仅用于调试/日志
- **示例**：remark、description字段

#### 3.2.2 可随机且无业务影响
- 无业务约束
- 随机生成不影响测试
- **示例**：随机字符串、时间戳

#### 3.2.3 高并发下无状态依赖
- 无状态依赖
- 并发安全
- **示例**：设备SN号、版本号

---

## 4. 数据策略分析流程

### 4.1 A1阶段（需求理解）
**Agent必须回答：**
- 是否依赖已有业务实体？
- 是否存在"数据前置条件"？
- 业务约束强度如何？

### 4.2 A2阶段（接口/业务分析）
**Agent必须回答：**
- 是否可以通过接口构造数据？
- 构造成本是否可接受？
- 数据构造的稳定性如何？

### 4.3 A3阶段（场景/数据设计）
**Agent必须产出：**
- 数据来源决策表（CSV/动态/混合）
- CSV字段清单（如果需要）
- 并发风险说明
- 回退策略设计

### 4.4 人工审核阶段
**人工必须确认：**
- 数据策略的合理性
- 并发安全评估
- 业务约束验证

### 4.5 A4/A5执行阶段
**仅允许执行：**
- 严格执行已批准的数据策略
- 不得自行引入/移除CSV
- 不得推翻A1-A3的决策

---

## 5. 数据策略示例

### 5.1 示例1：会员系统性能测试
```yaml
data_strategy:
  use_csv: true
  csv_reason: "会员账号必须真实存在，且状态固定"
  csv_scope: identity
  concurrency_safe: true
  fallback_strategy: skip
```

### 5.2 示例2：设备注册功能测试
```yaml
data_strategy:
  use_csv: false
  csv_reason: "设备参数可动态生成，无业务约束"
  csv_scope: control
  concurrency_safe: true
  fallback_strategy: dynamic
```

### 5.3 示例3：订单创建性能测试
```yaml
data_strategy:
  use_csv: true
  csv_reason: "商品信息必须真实存在，库存状态固定"
  csv_scope: relation
  concurrency_safe: false
  fallback_strategy: skip
```

---

## 6. 工程级定论

> **CSV是否使用，是数据策略问题，不是测试类型问题。**
> **数据策略必须在A1-A3阶段完成分析并经人工确认，**
> **A4-A5仅允许执行，不允许决策。**

---

## 7. 实施指南

### 7.1 Agent实施要求
- 所有阶段必须输出data_strategy字段
- A1-A3必须完成数据策略分析
- A4-A5必须验证数据策略一致性

### 7.2 人工审核要点
- 验证数据策略的业务合理性
- 确认并发安全性评估
- 审核回退策略的可行性

### 7.3 错误处理
- 数据策略缺失：返回A1阶段重新分析
- 策略不一致：返回A3阶段重新设计
- 执行偏差：立即停止，重新审核