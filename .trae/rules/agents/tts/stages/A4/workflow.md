@workflow_type: reusable
@usage_mode: execution
@enforcement: optional
@phase_id: A4
@version: 1.0.0
@author: QA Team
@created_at: 2026-01-14
@last_updated: 2026-01-14

Automate｜数据构造与工具适配
@phase_id: A4
@role: 测试数据设计Agent / 工具适配Agent
@human_review: optional
@upstream_phases: [A3]

@goal:
- 生成“可直接被工具消费”的自动化测试输入资产

@inputs:
- A3 输出文档：测试任务拆分文档（按场景类型、优先级、执行顺序拆分）
- A3 输出文档：标准化测试资产库（CSV数据模板、SSML模板、音频处理脚本）
- A3 输出文档：标准化数据契约（字段定义、取值规则、约束条件）
- A3 输出文档：测试场景分类清单（正常场景/异常场景/边界场景/鲁棒性场景）
- A3 输出文档：测试任务优先级矩阵（P0/P1/P2优先级划分）
- 语音生成数据契约文档.md - 数据规范和字段定义
- VAD测试数据设计与样本生成指南.md - 测试设计指南

@outputs:
- 测试数据集（CSV格式，包含正常/异常/边界/鲁棒性场景）
  - vad_test_data_comprehensive.csv - 综合测试数据（25个场景）
  - vad_test_data_sc025.csv - 特定场景测试数据
  - vad_test_data_sc003.csv - 特定场景测试数据
  - vad_test_data_noise_comparison.csv - 噪音对比测试数据
- 工具参数化与适配说明
  - Azure TTS配置说明（azure_config.py）
  - SSML生成脚本参数说明（generate_ssml.py）
  - 呼吸音效添加脚本参数说明（add_breath_sound.py）
  - VAD样本生成脚本参数说明（generate_vad_samples.py）
- 脚本与数据映射关系文档
- 测试数据质量验证报告

@validation_rules:
- 必须校验 A3 阶段已完成（三件套+结果文档）
- 必须校验 A3 输出的标准化数据契约已通过人工审核，未通过则拒绝执行
- 必须校验标准化数据契约的格式符合约定规范
- 必须校验测试资产库的完整性和可用性

@execution_steps:
1. 读取A3提供的CSV和SSML模板
2. 按CSV字段生成多样化测试数据，遵循以下最佳实践：
   - **口语化表达**：添加口语化词汇和语气词
   - **情绪表达**：覆盖开心、悲伤、愤怒、温柔、严肃、兴奋等多种情绪
   - **停顿表达**：使用"..."表示自然停顿
   - **场景多样化**：覆盖日常对话、工作场景、情感场景等
   - **文本长度多样性**：包含短句、中等句子、长句
   - **语言维度丰富**：包含普通话、方言和外语
   - **人物角色多样化**：模拟不同角色的语音特点
   - **环境噪声考虑**：设计不同环境场景
   - **ASR识别后特性话术**：确保50%的测试数据包含ASR识别后的特性，如语气词、口气、口头禅等
3. 构建SSML：
   - 停顿、语气、语速、音调、音量、强调词
   - 插入杂音/呼吸声
4. 调用后处理脚本：
   - 添加呼吸音、背景噪声
5. 确保Audacity已打开并激活mod-script-pipe模块
6. 导入A3生成的基础语音
7. 按配置批量处理：
   - 添加噪音（白噪音、粉噪音、环境噪音）
   - 改变语速、音高
   - 添加混响或削波失真
8. 导出处理后音频到输出目录
9. 验证音频参数：
   - 采样率、声道数、位深是否符合要求
10. 将生成数据存入输出目录，用于 A5 测试执行

@data_quality_rules:
- 文本重复度：避免使用相同或相似的话术，确保文本内容多样化
- 口语化程度：文本应符合真实用户语音输入，避免过于正式的表达
- 情绪覆盖：确保覆盖多种情绪表达
- 场景覆盖：确保覆盖多种使用场景
- 语言维度：包含普通话、方言和外语
- 人物角色：模拟不同角色的语音特点
- 环境考虑：设计不同环境场景
- ASR特性覆盖率：确保50%的测试数据包含ASR识别后的特性，如语气词、口气、口头禅等
- 语气词使用：在50%的测试数据中添加自然的语气词
- 情绪表达比例：50%的测试数据应包含丰富的情绪表达
- 停顿表达比例：50%的测试数据应使用自然停顿表达

@skeleton:
  sections:
    - 数据设计策略说明
    - 数据覆盖范围定义
    - 数据样例与格式
    - 工具适配说明

---