# 📚 错题本自动调用规则

**重要：** 在分析任何文件或解决问题之前，必须先调用错题本！

## 核心原则

**只记录通用性问题！** 不是所有问题都需要记录到错题本。

### 通用性问题判断标准
✅ **应该记录**：
- 可复用：类似场景下可能再次遇到
- 有规律：不是偶然的、特定的问题
- 有价值：记录后能帮助快速定位和解决
- 可推广：解决方案可以应用到其他类似场景

❌ **不应该记录**：
- 一次性问题：特定场景下只出现一次
- 偶发性问题：没有规律可循
- 特定问题：只针对某个具体文件或内容
- 简单问题：太简单，不值得记录

## 执行流程

### 1. 问题诊断阶段
当用户报告问题或需要分析文件时：
1. **首先读取错题本**：`e:\AI测试用例\.trae\rules\错题本规则.md`（查看"历史错误记录"章节）
2. **搜索相关历史问题**：
   - 检查是否有相同或类似的问题
   - 查找相关的技术栈分类（如 Mermaid、VS Code、Markdown 等）
   - 重点关注最近记录的问题

### 2. 问题解决阶段
如果找到相关历史问题：
- ✅ 直接应用错题本中的解决方案
- ✅ 告知用户："这个问题在错题本中有记录，已按历史方案解决"
- ✅ 如果方案不适用，说明原因并记录新的解决方案

如果没有找到相关历史问题：
- 🔍 分析问题原因
- 💡 提供解决方案
- 📝 **判断是否为通用性问题**：
  - 如果是通用性：记录到错题本
  - 如果不是：直接解决，不记录

### 3. 记录更新阶段
只有通用性问题才需要记录到错题本：
1. 更新错题本中的统计信息（总问题数、已解决数、最后更新时间）
2. 确保新记录按时间倒序排列
3. 更新分类索引（如有新分类）

## 触发条件

以下情况必须调用错题本：
- 用户报告任何错误或问题
- 用户要求分析文件格式问题
- 用户要求优化代码或文档
- 遇到重复性技术问题

## 工具使用规范

### Write 工具必填参数
**重要：** Write 工具必须包含 `file_path` 参数！

**错误示例：**
```python
Write(content="文件内容")
```

**正确示例：**
```python
Write(
    file_path="e:\\AI测试用例\\接口测试\\data\\test.csv",
    content="文件内容"
)
```

**注意事项：**
- `file_path` 必须使用完整的绝对路径
- 路径分隔符必须使用反斜杠 `\`（Windows路径规范）
- 在JSON字符串中需要对反斜杠进行转义：`"e:\\AI测试用例\\file.txt"`
- 如果是编辑现有文件，必须先使用 Read 工具读取文件内容

## 优势

- ⚡ 快速定位问题（基于历史经验）
- 🎯 避免重复踩坑
- 📈 持续积累知识
- 🔄 形成知识闭环

## 历史错误记录

| 日期 | 模块 | 错误描述 | 根因分析 | 修正方案 |
| :--- | :--- | :--- | :--- | :--- |
| 2026-01-12 | JMeter | CSV文件格式错误导致只读取18条数据 | CSV文件第20行（索引19）的role字段缺少一个引号：`"role":"user"` 应该是 `"role":"user"`，导致CSV解析器无法正确解析该行及后续行。 | 修复CSV文件中的引号格式错误，确保所有JSON字段的双引号都正确闭合。 |
| 2026-01-12 | JMeter | JTL文件中没有记录响应数据 | ResultCollector配置中缺少响应数据保存配置（responseData和samplerData）。 | 在ResultCollector的saveConfig中添加responseData和samplerData配置，确保完整记录测试结果。 |
| 2026-01-11 | JMeter | 422 Unprocessable Entity (JSON格式错误) | CSV 中的 JSON 字段包含反斜杠转义 (`{\"key\"...`)，导致 JMeter 构造的请求体非法。 | 1. 清洗 CSV，移除反斜杠，使用标准 CSV 转义 (`"{""key""...}"`)。2. JMeter 开启 `quotedData=true`。3. 确保 `ignoreFirstLine=true`。 |
| 2026-01-11 | JMeter | JSON decode error | CSV 数据中的 JSON 字段被错误地进行了 CSV 转义（双引号包裹且内部双引号转义），导致 JMeter 解析失败。 | 1. 使用 `|` 作为 CSV 分隔符。2. 确保 JSON 字段不使用引号包裹，也不转义内部双引号。3. 更新 DDT 智能体提示词，强制执行此规则。 |
| 2026-01-11 | JMeter | 断言逻辑缺陷与CSV数据枚举值不匹配 | 1. 脚本未正确处理 `modality=VISION` 的情况（无 intent）。2. CSV 中的情绪标签与接口定义不一致。 | 1. 清洗数据，统一枚举值。2. 重构 JSR223 断言，实现基于 `modality` 的分层校验。 |
| 2026-01-11 | Process | 修复脚本后未自动验证 | SOP 中缺少强制的回归验证步骤，导致修改后的脚本可能仍存在问题。 | 更新 JMeter 和 DDT 智能体提示词，增加"修复后强制验证"规则，强制要求修改后必须运行脚本验证。 |
