@skill_name: JMeter 执行层设计
@skill_level: L4
@skill_type: 执行设计
@domain: 接口测试 / JMeter / 自动化测试 / 执行调试
@input_contract:
  - executable_jmx: ${resources_dir}/scripts/executable_test.jmx
  - execution_plan: ${resources_dir}/docs/execution_plan.md
  - test_method_docs: ${resources_dir}/docs/test_method_docs.md
  - assertion_config: ${resources_dir}/config/assertion_config.yaml
  - parameter_mapping: ${resources_dir}/config/parameter_mapping.yaml
  - test_data: ${resources_dir}/data/test_data.csv
  - environment_config: ${resources_dir}/config/environment_config.yaml
@output_artifact:
  - execution_log: ${resources_dir}/logs/execution.log
  - test_results: ${resources_dir}/results/test_results.jtl
  - summary_report: ${resources_dir}/reports/summary_report.md
  - analysis_report: ${resources_dir}/reports/analysis_report.md
  - mistakes_updated: ${resources_dir}/docs/mistakes_updated.md
  - optimized_script: ${resources_dir}/scripts/optimized_test.jmx
@enforcement: 必须执行脚本并生成完整的执行日志和分析报告
@on_missing_input: 返回错误，要求提供完整的执行输入

---

# Skill 目标
- 为JMeter测试提供标准化的执行层能力
- 支持CLI执行和调试迭代
- 高封装执行能力，确保脚本真正可用
- 输出详细的执行日志、总结分析报告和错题本更新
- 具备执行调试和迭代优化脚本的能力
- 提供标准化的测试执行和优化流程
- 确保测试执行的可靠性和可重复性

# 输入说明
- **executable_jmx**：可直接执行的JMeter测试计划文件
- **execution_plan**：执行计划文档，描述测试执行策略
- **test_method_docs**：测试方法文档，描述测试方法设计和执行流程
- **assertion_config**：断言配置文档，定义断言规则和判责标准
- **parameter_mapping**：参数映射文档，定义参数传递关系
- **test_data**：测试数据文件，包含测试用例数据
- **environment_config**：环境配置文件，定义测试环境参数

# 输出说明
- **execution_log**：详细的执行日志文件，记录执行过程和结果
- **test_results**：测试结果文件，包含详细的测试执行数据
- **summary_report**：总结报告，概述测试执行结果和关键指标
- **analysis_report**：分析报告，深入分析测试执行结果和问题
- **mistakes_updated**：更新后的错题本，记录执行过程中的问题和解决方案
- **optimized_script**：优化后的测试脚本，包含迭代优化的结果

# 执行约束
- 严格遵循执行计划中的执行策略和流程
- 保证执行过程的可重复性和可靠性
- 确保执行日志的完整性和详细性
- 测试执行失败时必须提供详细的错误信息
- 迭代优化必须用户驱动，不得自动执行
- 输入缺失或格式错误 → 返回错误，不执行测试
- 重试次数 ≤3次，超过阈值请求人工介入

# 核心功能

## 1. CLI执行能力
- **命令行执行**：使用JMeter CLI模式执行测试脚本
- **参数化执行**：支持通过命令行参数动态配置执行环境
- **批量执行**：支持批量执行多个测试脚本
- **并行执行**：支持在多个环境并行执行测试
- **执行监控**：实时监控执行过程，捕获执行状态

## 2. 执行调试能力
- **排除法调试**：使用排除法等科学调试方法定位和解决问题
- **对比分析**：与可正常工作的脚本和数据进行对比分析
- **分阶段验证**：每次修改后立即验证，确认问题是否解决
- **日志分析**：检查日志文件，定位问题原因
- **错误处理**：设计合理的错误处理机制，重试 ≤3次
- **人工介入**：超过阈值请求用户手动检查

## 3. 迭代优化能力
- **闭环更新迭代**：支持项目输出产物的自主迭代优化能力
- **脚本优化**：根据执行结果优化脚本结构和配置
- **性能优化**：优化测试执行性能和资源使用
- **可维护性优化**：提高脚本的可维护性和可读性
- **持续改进**：定期总结经验教训，不断优化测试方法设计

### 闭环更新迭代能力

#### 项目输出产物更新机制（自主迭代）
- **适用范围**：数据契约、组件语法、JMeter脚本等项目交付物
- **更新规则**：
  - **自主迭代优化**：Agent可以自动进行迭代优化更新，无需用户驱动
  - **持续改进**：根据执行结果和分析发现，自动优化交付物质量
  - **验证机制**：每次更新后自动验证更新结果的正确性
  - **可追溯性**：记录更新历史，便于审计和回退

#### 触发条件
- 脚本执行失败，需要调整配置
- 断言设计不合理，需要优化
- 上下游关联处理不当，需要改进
- 性能问题，需要优化执行效率
- 业务规则变更，需要调整脚本逻辑

#### 更新流程
1. **检测阶段**：分析执行结果，识别需要优化的项目交付物
2. **执行阶段**：自动执行项目交付物的优化更新
3. **验证阶段**：验证更新后的交付物执行正确、稳定
4. **反馈阶段**：向用户反馈更新结果及优化效果

#### 变更历史记录
```yaml
change_history:
  - timestamp: <时间戳>
    change_type: <更新类型>
    changed_files:
      - <文件路径>
    changes:
      - <变更内容>
    requested_by: agent
    executed_by: agent
    update_type: project_delivery
```

#### 反馈机制
- 更新成功：返回更新后的交付物路径、优化内容摘要、执行效果
- 更新失败：返回失败原因、错误信息、回退建议
- 部分更新：返回成功更新的部分和失败的部分

## 4. 结果分析能力
- **执行结果分析**：分析测试执行结果，识别成功和失败的测试用例
- **性能分析**：分析测试执行性能，识别性能瓶颈
- **错误分析**：分析执行过程中的错误，提供详细的错误信息
- **趋势分析**：分析测试执行的趋势，识别潜在的问题
- **根因分析**：深入分析问题的根本原因，提供解决方案

## 5. 断言判断结合业务字段能力
- **业务字段验证**：结合业务字段进行断言判断，确保业务逻辑正确性
- **断言设计**：根据业务规则设计合理的断言，覆盖核心业务场景
- **判责能力**：区分系统问题和测试设计问题，提供准确的责任判定
- **业务规则变更响应**：及时响应业务规则变更，调整断言设计
- **基线样本捕获**：捕获正常执行的基线样本，用于对比分析

### 核心原则
- **业务字段驱动**：优先覆盖核心业务字段，确保关键业务逻辑正确性
- **基线样本对比**：使用历史成功执行结果作为断言设计参考
- **判责明确**：系统问题记录BUG，测试设计问题可自动调整断言参数
- **自适应与动态优化**：结合执行结果和历史数据动态调整断言
- **宪法级验证**：功能测试断言基于Baseline，性能测试断言仅验证基础业务成功

### 断言设计方法
- **断言类型选择**：值匹配、范围判断、正则匹配、存在性校验
- **断言点布局**：结构断言、状态断言、业务断言
- **断言版本与追溯**：记录每次断言生成或修改的版本信息，支持追溯回退

### 执行闭环与动态调整
- **无断言执行评估**：捕获执行结果，分析异常字段并进行风险分级，动态生成初步断言
- **自适应调整**：根据执行结果自动调整断言参数或类型，删除冗余断言
- **有限自愈与重试**：单阶段重试≤3次，超过阈值或关键异常→请求人工介入
- **系统状态判断与报告**：输出断言版本、调整记录、执行状态和优化建议

## 6. 报告生成能力
- **执行日志生成**：生成详细的执行日志，记录执行过程和结果
- **总结报告生成**：生成总结报告，概述测试执行结果和关键指标
- **分析报告生成**：生成分析报告，深入分析测试执行结果和问题
- **错题本更新**：更新错题本，记录执行过程中的问题和解决方案
- **优化建议生成**：生成脚本优化建议，提高脚本质量

## 7. 断言最佳实践
- **优先核心字段**：断言覆盖率优先保证核心业务字段，而非盲目全字段断言
- **基线驱动**：新业务或接口变更时，先执行无断言脚本生成Baseline，再设计断言
- **动态优化**：将断言生成、调整、删除纳入自动化闭环，减少人工维护
- **可追溯与审计**：所有断言版本、调整记录、执行结果均应可查询和回退
- **性能保护**：避免复杂业务断言在性能测试中引起不必要的开销
- **执行流程**：先跑通 → 看实证 → 再加断言，确保基于实际响应设计断言
- **实证原则**：实际响应是唯一真理，断言设计必须基于真实执行结果
- **价值导向**：失败用例比成功用例更有价值，重点分析失败原因
- **诚信原则**：禁止为了通过率修改断言或预期，确保测试结果真实可信
- **错误分类**：严格区分脚本/配置错误、测试数据问题、系统真实Bug

### 错误类型严格区分

| 错误类型 | 定义 | 处理策略 | 责任归属 |
|---------|------|---------|---------|
| **脚本/配置错误** | 测试脚本结构错误、组件配置不当、参数设置错误 | 调整脚本配置，重新执行 | 测试设计问题 |
| **测试数据问题** | 测试数据格式错误、数据值不符合业务规则、数据缺失 | 修正测试数据，重新执行 | 测试数据设计问题 |
| **系统真实Bug** | 接口响应不符合预期、业务逻辑错误、性能问题 | 记录Bug，不调整断言 | 系统问题 |

# 执行流程
1. **输入分析**：分析执行输入，确认执行环境和参数
2. **环境准备**：准备测试执行环境，配置环境参数
3. **CLI执行**：使用JMeter CLI模式执行测试脚本
4. **执行监控**：实时监控执行过程，捕获执行状态
5. **执行调试**：执行脚本，使用排除法调试，对比分析，分阶段验证
6. **结果收集**：收集测试执行结果和日志
7. **结果分析**：分析测试执行结果，识别问题和优化点
8. **迭代优化**：根据执行结果优化脚本，支持闭环更新
9. **报告生成**：生成执行日志、总结分析报告和错题本更新
10. **输出交付**：交付最终的执行结果和优化建议

# 失败处理

## 执行错误
- 脚本执行失败 → 分析失败原因，提供详细的错误信息
- 环境配置错误 → 返回错误并提示检查环境配置
- 测试数据错误 → 返回错误并提示检查测试数据
- 网络连接问题 → 返回错误并提示检查网络状态
- 执行超时 → 返回错误并建议调整超时设置

## 调试错误
- 排除法调试失败 → 提供详细的调试信息，请求人工介入
- 对比分析失败 → 提供详细的对比信息，请求人工介入
- 分阶段验证失败 → 提供详细的验证信息，请求人工介入
- 日志分析失败 → 提供详细的日志信息，请求人工介入

## 优化错误
- 脚本优化失败 → 提供详细的优化信息，请求人工介入
- 性能优化失败 → 提供详细的性能信息，请求人工介入
- 可维护性优化失败 → 提供详细的维护性信息，请求人工介入
- 闭环更新失败 → 提供详细的更新信息，请求人工介入

# 最佳实践

## CLI执行最佳实践
- **命令行参数化**：使用命令行参数动态配置执行环境，提高灵活性
- **批量执行**：合理组织批量执行策略，提高执行效率
- **并行执行**：根据环境资源合理配置并行执行，提高执行速度
- **执行监控**：实时监控执行过程，及时发现问题
- **日志管理**：合理管理执行日志，便于分析和排查问题

## 执行调试最佳实践
- **排除法调试**：逐步排除可能的问题点，定位根本原因
- **对比分析**：与可正常工作的脚本进行对比，找出差异
- **分阶段验证**：每次修改后立即验证，确保问题解决
- **日志分析**：充分利用JMeter日志，定位问题原因
- **有限重试**：单阶段重试 ≤3次，超过阈值请求人工介入
- **备份原脚本**：在修改前备份原脚本，便于回退

## 迭代优化最佳实践
- **用户驱动**：所有更新操作必须获得用户确认
- **变更记录**：详细记录所有更新变更，便于追溯
- **验证反馈**：更新后提供完整的验证报告，确保脚本可用
- **状态跟踪**：跟踪脚本更新状态和版本，便于管理
- **回退机制**：提供更新失败的回退机制，确保系统稳定
- **持续改进**：定期总结经验教训，不断优化测试方法设计

## 结果分析最佳实践
- **多维度分析**：从多个维度分析测试执行结果
- **深入分析**：深入分析问题的根本原因，提供解决方案
- **趋势分析**：分析测试执行的趋势，识别潜在的问题
- **数据可视化**：使用数据可视化工具展示分析结果，提高可读性
- **报告质量**：确保分析报告结构清晰、内容完整、结论明确

# 参考规范

## A5三件套参考
- **role.prompt.md**：参考核心能力和行为准则
- **workflow.md**：参考阶段执行流程和宪法级约束
- **mistakes.md**：参考常见错误类型和解决方案

## A6三件套参考
- **role.prompt.md**：参考评估总结与体系迭代能力
- **workflow.md**：参考阶段执行流程和落地建议
- **mistakes.md**：参考常见错误类型和解决方案

## 关键参考点
1. **CLI执行能力**：使用JMeter CLI模式执行测试脚本
2. **执行调试能力**：使用排除法调试、对比分析、分阶段验证等方法
3. **迭代优化能力**：支持用户驱动的闭环更新迭代
4. **结果分析能力**：深入分析测试执行结果，识别问题和优化点
5. **报告生成能力**：生成详细的执行日志、总结分析报告和错题本更新
6. **有限自愈**：单阶段重试 ≤3次，超过阈值请求人工介入
7. **持续改进**：定期总结经验教训，不断优化测试执行和方法设计

## 执行原则
- **阶段化执行**：按步骤执行测试方法，确保执行顺序正确
- **验证充分**：对测试执行结果进行充分验证
- **文档完整**：生成完整的执行日志和分析报告
- **持续改进**：定期总结经验教训，不断优化测试执行方法
- **用户驱动**：所有更新操作必须获得用户确认，不得自动执行