@skill_name: 接口测试数据设计
@skill_level: L1
@skill_type: 数据设计
@domain: 接口测试 / DDT / 性能测试
@input_contract:
  - 接口字段定义: ${resources_dir}/docs/接口定义.md
  - 数据契约文档: ${resources_dir}/docs/数据契约.md
  - 数据来源决策模型: E:\AI测试用例\.trae\rules\agents\jmeter\数据来源决策模型.md
  - 现有测试数据: ${resources_dir}/data/existing_data.csv
  - 接口分析文档: ${resources_dir}/docs/接口分析.md
@output_artifact:
  - data_strategy.yaml: ${resources_dir}/docs/data_strategy.yaml
  - CSV 文件（如需要）: ${resources_dir}/docs/测试数据.csv
  - 并发安全说明: ${resources_dir}/docs/并发安全说明.md
  - 数据契约文档优化版: ${resources_dir}/docs/数据契约.md
  - 脚本数据映射文档: ${resources_dir}/docs/脚本数据映射.md
  - 数据设计文档: ${resources_dir}/docs/数据设计文档.md
@enforcement: 必须遵循数据策略决策模型，保证格式正确、数据可用
@on_missing_input: 返回错误，要求提供完整接口字段或数据契约文档

---

# Skill 目标
- 为接口测试提供可复用的测试数据设计能力
- 支持 DDT 数据设计和性能测试数据设计
- 自动根据【数据来源决策模型】分析数据来源（CSV / 动态 / 混合）
- 输出符合数据契约的可用数据格式
- 保证并发安全和回退策略
- 支持闭环更新迭代能力（用户驱动）
- 提供标准化的测试数据设计和生成流程
- 明确脚本与数据的映射关系

# 输入说明
- **接口字段定义**：接口入参/出参字段及类型
- **数据契约文档**：约束规则、上下游依赖
- **上下游接口依赖信息**（可选）：关联接口数据关系
- **数据来源决策模型**：CSV / 动态 / 混合决策规则
- **现有测试数据**（可选）：已有的测试数据集
- **接口分析文档**（可选）：接口详细分析信息

# 输出说明
- **data_strategy.yaml**：
```yaml
data_strategy:
  use_csv: true | false
  csv_reason: <原因>
  csv_scope: control | identity | relation
  concurrency_safe: true | false
  fallback_strategy: dynamic | skip
```

* **CSV 文件**（如需要）: `${resources_dir}/docs/测试数据.csv`
* **并发安全说明**: `${resources_dir}/docs/并发安全说明.md`
* **数据契约文档优化版**: `${resources_dir}/docs/数据契约.md`
* **脚本数据映射文档**: `${resources_dir}/docs/脚本数据映射.md`
* **数据设计文档**: `${resources_dir}/docs/数据设计文档.md`
* **闭环更新反馈**（可选）

# 执行约束

* Skill 只生成数据策略和数据文件，不执行接口测试
* 数据策略必须符合数据来源决策模型
* CSV 使用决策由数据契约和业务约束决定
* 输出数据格式必须可直接供测试脚本使用
* 闭环更新必须**用户驱动**，Agent 不得自动更新A4阶段的文档
* 输入缺失或格式错误 → 返回错误，不执行生成
* 优先使用动态生成和接口关联，仅对必要场景使用CSV
* 测试数据必须覆盖所有业务场景和边界情况

# 核心能力

## 1. 测试数据设计能力
- **场景分析**：使用场景分析法设计测试数据
- **边界值分析**：使用边界值分析法设计测试数据
- **业务逻辑验证**：确保测试数据符合实际业务逻辑
- **格式规范遵循**：确保测试数据符合格式规范
- **覆盖检查**：建立测试数据覆盖检查清单

## 2. 测试数据生成能力
- **标准化生成**：生成标准化测试数据集
- **去重处理**：确保生成的测试数据不重复
- **质量保证**：建立数据质量检查机制
- **效率优化**：优化数据生成算法，提高效率
- **格式验证**：对生成的测试数据进行格式验证

## 3. 脚本数据映射能力
- **映射关系定义**：明确脚本与数据的映射关系
- **数据驱动策略**：设计合理的数据驱动策略
- **类型匹配**：确保脚本与数据类型匹配
- **映射文档**：生成详细的映射关系文档
- **验证机制**：对映射关系进行验证

## 4. 闭环更新迭代能力

### 触发条件

* 数据契约文档存在约束不明确或冲突
* 接口字段定义与实际接口不匹配
* 上下游依赖关系发生变化
* 数据策略执行后发现优化空间
* 业务规则变更影响测试数据设计

### 更新流程

1. **检测阶段**：分析输入文档，识别需要更新的内容
2. **提示阶段**：向用户展示需要更新的具体内容和建议
3. **确认阶段**：等待用户明确的更新确认指令
4. **执行阶段**：根据用户指令执行文档更新
5. **验证阶段**：验证更新后的文档格式正确、内容完整
6. **反馈阶段**：向用户反馈更新结果及文档状态

### 更新规则

* **禁止自动更新**：Agent 不得自动执行更新操作
* **用户驱动**：更新必须由用户明确触发或确认
* **可追溯性**：更新过程需记录变更历史
* **状态反馈**：更新完成后提供详细的状态报告

### 变更历史记录

```yaml
change_history:
  - timestamp: <时间戳>
    change_type: <更新类型>
    changed_files:
      - <文件路径>
    changes:
      - <变更内容>
    requested_by: user
    executed_by: agent
```

### 反馈机制

* 更新成功：返回更新后的文档路径、变更内容摘要
* 更新失败：返回失败原因、错误信息、回退建议
* 部分更新：返回成功更新的部分和失败的部分

# 更新迭代机制

## 项目输出产物更新机制（自主迭代）
- **适用范围**：数据契约、组件语法、JMeter脚本等项目交付物
- **更新规则**：
  - **自主迭代优化**：Agent可以自动进行迭代优化更新，无需用户驱动
  - **持续改进**：根据执行结果和分析发现，自动优化交付物质量
  - **验证机制**：每次更新后自动验证更新结果的正确性
  - **可追溯性**：记录更新历史，便于审计和回退

## 触发条件
- 数据契约文档存在约束不明确或冲突
- 接口字段定义与实际接口不匹配
- 上下游依赖关系发生变化
- 数据策略执行后发现优化空间
- 业务规则变更影响测试数据设计

## 更新流程
1. **检测阶段**：分析执行结果，识别需要优化的项目交付物
2. **执行阶段**：自动执行项目交付物的优化更新
3. **验证阶段**：验证更新后的交付物执行正确、稳定
4. **反馈阶段**：向用户反馈更新结果及优化效果

## 变更历史记录
```yaml
change_history:
  - timestamp: <时间戳>
    change_type: <更新类型>
    changed_files:
      - <文件路径>
    changes:
      - <变更内容>
    requested_by: agent
    executed_by: agent
    update_type: project_delivery
```

## 反馈机制
- 更新成功：返回更新后的交付物路径、优化内容摘要、执行效果
- 更新失败：返回失败原因、错误信息、回退建议
- 部分更新：返回成功更新的部分和失败的部分

# 执行流程
1. **输入分析**：分析接口字段定义、数据契约文档等输入
2. **数据来源决策**：根据数据来源决策模型分析数据来源
3. **测试数据设计**：设计覆盖所有场景的测试数据
4. **测试数据生成**：生成标准化测试数据集
5. **脚本数据映射**：明确脚本与数据的映射关系
6. **并发安全设计**：设计并发安全和回退策略
7. **文档生成**：生成数据策略、映射文档等输出
8. **验证检查**：验证生成的文档和数据格式正确
9. **输出交付**：交付最终的数据策略和数据文件

# 失败处理

* 输入字段缺失或数据契约不完整 → 返回错误并提示补充
* 生成的数据不符合契约 → 返回错误，要求重新分析策略
* 并发安全性无法保证 → 提示风险并建议回退策略
* 测试数据覆盖不完整 → 返回错误并提示补充场景
* 脚本数据映射关系不明确 → 返回错误并要求明确映射关系

# 最佳实践

## 数据设计最佳实践
- **场景覆盖**：使用场景分析法确保覆盖所有业务场景
- **边界值考虑**：使用边界值分析法设计边界情况测试数据
- **业务逻辑符合**：测试数据必须符合实际业务逻辑
- **格式规范遵循**：测试数据必须符合格式规范
- **CSV最小化**：优先使用动态生成和接口关联，仅对必要场景使用CSV

## 数据生成最佳实践
- **标准化生成**：使用模板生成标准化测试数据
- **去重处理**：确保生成的测试数据不重复
- **质量检查**：建立数据质量检查机制
- **效率优化**：优化数据生成算法，提高效率
- **格式验证**：对生成的测试数据进行格式验证

## 脚本数据映射最佳实践
- **映射关系明确**：明确脚本与数据的映射关系
- **策略合理**：设计合理的数据驱动策略
- **类型匹配**：确保脚本与数据类型匹配
- **文档完整**：生成详细的映射关系文档
- **验证充分**：对映射关系进行充分验证

## 闭环更新最佳实践
- **用户驱动**：所有更新操作必须获得用户确认
- **变更记录**：详细记录所有更新变更
- **验证反馈**：更新后提供完整的验证报告
- **状态跟踪**：跟踪文档更新状态和版本
- **回退机制**：提供更新失败的回退机制

# 参考规范

## A4三件套参考
- **role.prompt.md**：参考核心能力和行为准则
- **mistakes.md**：参考常见错误类型和解决方案
- **workflow.md**：参考阶段执行流程


## 关键参考点
1. **参数设计原则**：优先使用动态生成和接口关联，仅对必要场景使用CSV
2. **测试数据覆盖**：测试数据必须覆盖所有业务场景和边界情况
3. **数据质量保证**：建立数据质量检查机制，确保数据符合业务逻辑
4. **映射关系明确**：明确脚本与数据的映射关系，确保测试执行正确
5. **验证机制**：对测试数据、配置和映射关系进行充分验证
6. **持续改进**：定期总结经验教训，不断优化数据设计和生成方法



