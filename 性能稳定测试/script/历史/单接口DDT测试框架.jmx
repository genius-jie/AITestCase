<?xml version="1.0" encoding="UTF-8"?>
<jmeterTestPlan version="1.2" properties="5.0" jmeter="5.1.1 r1855137">
  <hashTree>
    <TestPlan guiclass="TestPlanGui" testclass="TestPlan" testname="测试计划" enabled="true">
      <stringProp name="TestPlan.comments">1、先看下是不是用到数据库了，需要补充进去地址</stringProp>
      <boolProp name="TestPlan.functional_mode">false</boolProp>
      <boolProp name="TestPlan.tearDown_on_shutdown">true</boolProp>
      <boolProp name="TestPlan.serialize_threadgroups">false</boolProp>
      <elementProp name="TestPlan.user_defined_variables" elementType="Arguments" guiclass="ArgumentsPanel" testclass="Arguments" testname="用户定义的变量" enabled="true">
        <collectionProp name="Arguments.arguments"/>
      </elementProp>
      <stringProp name="TestPlan.user_define_classpath"></stringProp>
    </TestPlan>
    <hashTree>
      <SetupThreadGroup guiclass="SetupThreadGroupGui" testclass="SetupThreadGroup" testname="设置环境变量" enabled="true">
        <stringProp name="ThreadGroup.on_sample_error">continue</stringProp>
        <elementProp name="ThreadGroup.main_controller" elementType="LoopController" guiclass="LoopControlPanel" testclass="LoopController" testname="循环控制器" enabled="true">
          <boolProp name="LoopController.continue_forever">false</boolProp>
          <stringProp name="LoopController.loops">1</stringProp>
        </elementProp>
        <stringProp name="ThreadGroup.num_threads">1</stringProp>
        <stringProp name="ThreadGroup.ramp_time">1</stringProp>
        <boolProp name="ThreadGroup.scheduler">false</boolProp>
        <stringProp name="ThreadGroup.duration"></stringProp>
        <stringProp name="ThreadGroup.delay"></stringProp>
      </SetupThreadGroup>
      <hashTree>
        <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP信息头管理器" enabled="true">
          <collectionProp name="HeaderManager.headers">
            <elementProp name="User-Agent" elementType="Header">
              <stringProp name="Header.name">User-Agent</stringProp>
              <stringProp name="Header.value">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.121 Safari/537.36</stringProp>
            </elementProp>
            <elementProp name="Content-Type" elementType="Header">
              <stringProp name="Header.name">Content-Type</stringProp>
              <stringProp name="Header.value">application/json;charset=UTF-8</stringProp>
            </elementProp>
            <elementProp name="Accept" elementType="Header">
              <stringProp name="Header.name">Accept</stringProp>
              <stringProp name="Header.value">*/*</stringProp>
            </elementProp>
            <elementProp name="Accept-Language" elementType="Header">
              <stringProp name="Header.name">Accept-Language</stringProp>
              <stringProp name="Header.value">zh-CN,zh;q=0.9</stringProp>
            </elementProp>
          </collectionProp>
        </HeaderManager>
        <hashTree/>
        <BeanShellSampler guiclass="BeanShellSamplerGui" testclass="BeanShellSampler" testname="获取testlink数据" enabled="true">
          <stringProp name="BeanShellSampler.query">import web.utils.*;
import br.eti.kinoshita.testlinkjavaapi.TestLinkAPI;
import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONObject;
import com.qa.util.TestlinkUtil;
import java.util.List;
import java.util.Map;

TestLinkAPI api = TestlinkUtil.connect(&quot;http://10.1.56.164/lib/api/xmlrpc/v1/xmlrpc.php&quot;, &quot;202fa4483098bac8890f29472f5389a1&quot;);
List total_data =  TestlinkUtil.get_total_data(api);
String count=total_data.size()+&quot;&quot;;
props.put(&quot;count&quot;,count);
props.put(&quot;total_data&quot;,total_data);
String url=&quot;${__P(request.url)}&quot;;
vars.put(&quot;url&quot;,url);
//vars.put(&quot;url&quot;,&quot;testx&quot;);


</stringProp>
          <stringProp name="BeanShellSampler.filename"></stringProp>
          <stringProp name="BeanShellSampler.parameters"></stringProp>
          <boolProp name="BeanShellSampler.resetInterpreter">false</boolProp>
        </BeanShellSampler>
        <hashTree/>
        <IfController guiclass="IfControllerPanel" testclass="IfController" testname="如果环境是10.1.61.11" enabled="true">
          <stringProp name="IfController.condition">${__jexl3(vars.get(&quot;url&quot;) == &quot;10.1.61.11&quot; )}</stringProp>
          <boolProp name="IfController.evaluateAll">false</boolProp>
          <boolProp name="IfController.useExpression">true</boolProp>
        </IfController>
        <hashTree>
          <BeanShellSampler guiclass="BeanShellSamplerGui" testclass="BeanShellSampler" testname="设置环境信息" enabled="true">
            <stringProp name="BeanShellSampler.query">////调试用
${__setProperty(omp.url,10.1.61.117,)};
${__setProperty(omp.protocol,http,)};
${__setProperty(omp.port,7500,)};
${__setProperty(omp.passwd,&quot;Tm9zNTc1Jg==&quot;,)};

${__setProperty(tenant.url,10.1.50.105,)};
${__setProperty(tenant.protocol,http,)};
${__setProperty(tenant.port,80,)};

${__setProperty(databank_metadata.url,10.1.61.111,)};
${__setProperty(databank_metadata.protocol,http,)};
${__setProperty(databank_metadata.port,8990,)};

${__setProperty(esIp,&quot;10.1.56.65&quot;,)};
${__setProperty(mysqlIp,&quot;10.1.61.11&quot;,)};
${__setProperty(mysqlpasswd,&quot;4SKVCz2g12&quot;,)};
${__setProperty(flumeIp,&quot;10.1.60.109&quot;,)};
${__setProperty(mongoIp,&quot;10.1.53.20&quot;,)};
${__setProperty(kafkaIp,&quot;10.1.60.109&quot;,)};
${__setProperty(redisIp,&quot;10.1.61.11&quot;,)};
${__setProperty(redisPasswd,&quot;Redis@456_\$%^&quot;,)};
vars.put(&quot;mysqlIp&quot;,&quot;10.1.61.11&quot;);
vars.put(&quot;mysqlpasswd&quot;,&quot;4SKVCz2g12&quot;);

String url=&quot;${__P(tenant.url)}&quot;;
System.out.println(url);</stringProp>
            <stringProp name="BeanShellSampler.filename"></stringProp>
            <stringProp name="BeanShellSampler.parameters"></stringProp>
            <boolProp name="BeanShellSampler.resetInterpreter">false</boolProp>
          </BeanShellSampler>
          <hashTree/>
        </hashTree>
        <IfController guiclass="IfControllerPanel" testclass="IfController" testname="如果环境是testx" enabled="true">
          <stringProp name="IfController.condition">${__jexl3(vars.get(&quot;url&quot;) == &quot;testx&quot; )}</stringProp>
          <boolProp name="IfController.evaluateAll">false</boolProp>
          <boolProp name="IfController.useExpression">true</boolProp>
        </IfController>
        <hashTree>
          <BeanShellSampler guiclass="BeanShellSamplerGui" testclass="BeanShellSampler" testname="设置环境信息" enabled="true">
            <stringProp name="BeanShellSampler.query">////调试用
${__setProperty(omp.url,10.1.40.93,)};
${__setProperty(omp.protocol,http,)};
${__setProperty(omp.port,7500,)};
${__setProperty(omp.passwd,&quot;Tm9zNTc1Jg==&quot;,)};

${__setProperty(tenant.url,10.1.40.81,)};
${__setProperty(tenant.protocol,https,)};
${__setProperty(tenant.port,7508,)};

${__setProperty(databank_metadata.url,10.1.40.98,)};
${__setProperty(databank_metadata.protocol,http,)};
${__setProperty(databank_metadata.port,8990,)};

${__setProperty(esIp,&quot;10.1.40.89&quot;,)};
${__setProperty(mysqlIp,&quot;10.1.40.81&quot;,)};
${__setProperty(mysqlpasswd,&quot;qazwsx@123!&quot;,)};
${__setProperty(flumeIp,&quot;10.1.40.86&quot;,)};
${__setProperty(mongodbIp,&quot;10.1.40.81&quot;,)};
${__setProperty(kafkaIp,&quot;10.1.40.86&quot;,)};
${__setProperty(redisIp,&quot;10.1.40.100&quot;,)};
${__setProperty(redisPasswd,&quot;Redis@456_\$%^&quot;,)};
vars.put(&quot;mysqlIp&quot;,&quot;10.1.61.11&quot;);
vars.put(&quot;mysqlpasswd&quot;,&quot;4SKVCz2g12&quot;);

String url=&quot;${__P(tenant.url)}&quot;;
System.out.println(url);</stringProp>
            <stringProp name="BeanShellSampler.filename"></stringProp>
            <stringProp name="BeanShellSampler.parameters"></stringProp>
            <boolProp name="BeanShellSampler.resetInterpreter">false</boolProp>
          </BeanShellSampler>
          <hashTree/>
        </hashTree>
        <IfController guiclass="IfControllerPanel" testclass="IfController" testname="如果环境是56.159" enabled="true">
          <stringProp name="IfController.condition">${__jexl3(vars.get(&quot;url&quot;) == &quot;10.1.56.159&quot; )}</stringProp>
          <boolProp name="IfController.evaluateAll">false</boolProp>
          <boolProp name="IfController.useExpression">true</boolProp>
        </IfController>
        <hashTree>
          <BeanShellSampler guiclass="BeanShellSamplerGui" testclass="BeanShellSampler" testname="设置环境信息" enabled="true">
            <stringProp name="BeanShellSampler.query">////调试用
${__setProperty(omp.url,10.1.56.159,)};
${__setProperty(omp.protocol,http,)};
${__setProperty(omp.port,7500,)};
${__setProperty(omp.passwd,&quot;Tm9zNTc1Jg==&quot;,)};

${__setProperty(tenant.url,10.1.56.159,)};
${__setProperty(tenant.protocol,http,)};
${__setProperty(tenant.port,80,)};

${__setProperty(databank_metadata.url,10.1.56.160,)};
${__setProperty(databank_metadata.protocol,http,)};
${__setProperty(databank_metadata.port,8990,)};

${__setProperty(esIp,&quot;10.1.56.161&quot;,)};
${__setProperty(mysqlIp,&quot;10.1.56.159&quot;,)};
${__setProperty(mysqlpasswd,&quot;Uyun_123&quot;,)};
${__setProperty(flumeIp,&quot;10.1.56.162&quot;,)};
${__setProperty(mongodbIp,&quot;10.1.56.161&quot;,)};
${__setProperty(kafkaIp,&quot;10.1.56.161&quot;,)};
${__setProperty(redisIp,&quot;10.1.56.159&quot;,)};
${__setProperty(redisPasswd,&quot;Redis@456_\$%^&quot;,)};
vars.put(&quot;mysqlIp&quot;,&quot;10.1.56.159&quot;);
vars.put(&quot;mysqlpasswd&quot;,&quot;Uyun_123&quot;);

String url=&quot;${__P(tenant.url)}&quot;;
System.out.println(url);</stringProp>
            <stringProp name="BeanShellSampler.filename"></stringProp>
            <stringProp name="BeanShellSampler.parameters"></stringProp>
            <boolProp name="BeanShellSampler.resetInterpreter">false</boolProp>
          </BeanShellSampler>
          <hashTree/>
        </hashTree>
        <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="用户登录tenant" enabled="true">
          <boolProp name="HTTPSampler.postBodyRaw">true</boolProp>
          <elementProp name="HTTPsampler.Arguments" elementType="Arguments">
            <collectionProp name="Arguments.arguments">
              <elementProp name="" elementType="HTTPArgument">
                <boolProp name="HTTPArgument.always_encode">false</boolProp>
                <stringProp name="Argument.value">{	&quot;email&quot;:&quot;admin&quot;,&#xd;
	&quot;passwd&quot;:&quot;Admin@123&quot;&#xd;
}</stringProp>
                <stringProp name="Argument.metadata">=</stringProp>
              </elementProp>
            </collectionProp>
          </elementProp>
          <stringProp name="HTTPSampler.domain">${__P(tenant.url)}</stringProp>
          <stringProp name="HTTPSampler.port">${__P(tenant.port)}</stringProp>
          <stringProp name="HTTPSampler.protocol">${__P(tenant.protocol)}</stringProp>
          <stringProp name="HTTPSampler.contentEncoding"></stringProp>
          <stringProp name="HTTPSampler.path">/tenant/api/v1/user/login</stringProp>
          <stringProp name="HTTPSampler.method">POST</stringProp>
          <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
          <boolProp name="HTTPSampler.auto_redirects">false</boolProp>
          <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
          <boolProp name="HTTPSampler.DO_MULTIPART_POST">false</boolProp>
          <stringProp name="HTTPSampler.embedded_url_re"></stringProp>
          <stringProp name="HTTPSampler.connect_timeout"></stringProp>
          <stringProp name="HTTPSampler.response_timeout"></stringProp>
        </HTTPSamplerProxy>
        <hashTree>
          <RegexExtractor guiclass="RegexExtractorGui" testclass="RegexExtractor" testname="正则表达式提取器" enabled="true">
            <stringProp name="RegexExtractor.useHeaders">false</stringProp>
            <stringProp name="RegexExtractor.refname">token</stringProp>
            <stringProp name="RegexExtractor.regex">&quot;token&quot;:&quot;(.*?)&quot;</stringProp>
            <stringProp name="RegexExtractor.template">$1$</stringProp>
            <stringProp name="RegexExtractor.default"></stringProp>
            <stringProp name="RegexExtractor.match_number">0</stringProp>
          </RegexExtractor>
          <hashTree/>
          <BeanShellPostProcessor guiclass="TestBeanGUI" testclass="BeanShellPostProcessor" testname="BeanShell 后置处理程序" enabled="true">
            <boolProp name="resetInterpreter">false</boolProp>
            <stringProp name="parameters"></stringProp>
            <stringProp name="filename"></stringProp>
            <stringProp name="script">${__setProperty(tenant_token,${token},)};
//${__setProperty(timestamp,${timestamp},)}
//String t=&quot;${__time()}&quot;;
//vars.put(&quot;timestamp&quot;,t);




</stringProp>
          </BeanShellPostProcessor>
          <hashTree/>
        </hashTree>
        <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="用户登录omp" enabled="true">
          <boolProp name="HTTPSampler.postBodyRaw">true</boolProp>
          <elementProp name="HTTPsampler.Arguments" elementType="Arguments">
            <collectionProp name="Arguments.arguments">
              <elementProp name="" elementType="HTTPArgument">
                <boolProp name="HTTPArgument.always_encode">false</boolProp>
                <stringProp name="Argument.value">{	&quot;username&quot;:&quot;admin&quot;,&#xd;
	&quot;passwd&quot;:${__P(omp.passwd)}&#xd;
}</stringProp>
                <stringProp name="Argument.metadata">=</stringProp>
              </elementProp>
            </collectionProp>
          </elementProp>
          <stringProp name="HTTPSampler.domain">${__P(omp.url)}</stringProp>
          <stringProp name="HTTPSampler.port">${__P(omp.port)}</stringProp>
          <stringProp name="HTTPSampler.protocol">${__P(omp.protocol)}</stringProp>
          <stringProp name="HTTPSampler.contentEncoding"></stringProp>
          <stringProp name="HTTPSampler.path">/omp/api/v1/user/login</stringProp>
          <stringProp name="HTTPSampler.method">POST</stringProp>
          <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
          <boolProp name="HTTPSampler.auto_redirects">false</boolProp>
          <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
          <boolProp name="HTTPSampler.DO_MULTIPART_POST">false</boolProp>
          <stringProp name="HTTPSampler.embedded_url_re"></stringProp>
          <stringProp name="HTTPSampler.connect_timeout"></stringProp>
          <stringProp name="HTTPSampler.response_timeout"></stringProp>
        </HTTPSamplerProxy>
        <hashTree>
          <RegexExtractor guiclass="RegexExtractorGui" testclass="RegexExtractor" testname="正则表达式提取器" enabled="true">
            <stringProp name="RegexExtractor.useHeaders">true</stringProp>
            <stringProp name="RegexExtractor.refname">omp_token</stringProp>
            <stringProp name="RegexExtractor.regex">omp_token=(.*?);</stringProp>
            <stringProp name="RegexExtractor.template">$1$</stringProp>
            <stringProp name="RegexExtractor.default"></stringProp>
            <stringProp name="RegexExtractor.match_number">1</stringProp>
            <boolProp name="RegexExtractor.default_empty_value">true</boolProp>
          </RegexExtractor>
          <hashTree/>
          <BeanShellPostProcessor guiclass="TestBeanGUI" testclass="BeanShellPostProcessor" testname="BeanShell 后置处理程序" enabled="true">
            <boolProp name="resetInterpreter">false</boolProp>
            <stringProp name="parameters"></stringProp>
            <stringProp name="filename"></stringProp>
            <stringProp name="script">${__setProperty(omp_token,${omp_token},)};</stringProp>
          </BeanShellPostProcessor>
          <hashTree/>
        </hashTree>
        <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="获取apikey" enabled="true">
          <elementProp name="HTTPsampler.Arguments" elementType="Arguments" guiclass="HTTPArgumentsPanel" testclass="Arguments" testname="用户定义的变量" enabled="true">
            <collectionProp name="Arguments.arguments"/>
          </elementProp>
          <stringProp name="HTTPSampler.domain">${__P(tenant.url)}</stringProp>
          <stringProp name="HTTPSampler.port">${__P(tenant.port)}</stringProp>
          <stringProp name="HTTPSampler.protocol">${__P(tenant.protocol)}</stringProp>
          <stringProp name="HTTPSampler.contentEncoding"></stringProp>
          <stringProp name="HTTPSampler.path">/tenant/serviceapi/api/v1/tenant/view?tenantId=e10adc3949ba59abbe56e057f20f88dd</stringProp>
          <stringProp name="HTTPSampler.method">GET</stringProp>
          <boolProp name="HTTPSampler.follow_redirects">false</boolProp>
          <boolProp name="HTTPSampler.auto_redirects">false</boolProp>
          <boolProp name="HTTPSampler.use_keepalive">false</boolProp>
          <boolProp name="HTTPSampler.DO_MULTIPART_POST">false</boolProp>
          <stringProp name="HTTPSampler.embedded_url_re"></stringProp>
          <stringProp name="HTTPSampler.connect_timeout"></stringProp>
          <stringProp name="HTTPSampler.response_timeout"></stringProp>
        </HTTPSamplerProxy>
        <hashTree>
          <JSONPostProcessor guiclass="JSONPostProcessorGui" testclass="JSONPostProcessor" testname="JSON提取器" enabled="true">
            <stringProp name="JSONPostProcessor.referenceNames">apikey</stringProp>
            <stringProp name="JSONPostProcessor.jsonPathExprs">$..apiKeys[0].key</stringProp>
            <stringProp name="JSONPostProcessor.match_numbers">1</stringProp>
            <stringProp name="JSONPostProcessor.defaultValues">e10adc3949ba59abbe56e057f20f88dd</stringProp>
            <stringProp name="Scope.variable"></stringProp>
          </JSONPostProcessor>
          <hashTree/>
          <BeanShellPostProcessor guiclass="TestBeanGUI" testclass="BeanShellPostProcessor" testname="BeanShell 后置处理程序" enabled="true">
            <boolProp name="resetInterpreter">false</boolProp>
            <stringProp name="parameters"></stringProp>
            <stringProp name="filename"></stringProp>
            <stringProp name="script">${__setProperty(apikey,&quot;${apikey}&quot;,)};</stringProp>
          </BeanShellPostProcessor>
          <hashTree/>
        </hashTree>
        <DebugSampler guiclass="TestBeanGUI" testclass="DebugSampler" testname="调试取样器" enabled="true">
          <boolProp name="displayJMeterProperties">false</boolProp>
          <boolProp name="displayJMeterVariables">true</boolProp>
          <boolProp name="displaySystemProperties">false</boolProp>
        </DebugSampler>
        <hashTree/>
      </hashTree>
      <ThreadGroup guiclass="ThreadGroupGui" testclass="ThreadGroup" testname="接口测试" enabled="true">
        <stringProp name="ThreadGroup.on_sample_error">continue</stringProp>
        <elementProp name="ThreadGroup.main_controller" elementType="LoopController" guiclass="LoopControlPanel" testclass="LoopController" testname="循环控制器" enabled="true">
          <boolProp name="LoopController.continue_forever">false</boolProp>
          <stringProp name="LoopController.loops">1</stringProp>
        </elementProp>
        <stringProp name="ThreadGroup.num_threads">1</stringProp>
        <stringProp name="ThreadGroup.ramp_time">1</stringProp>
        <boolProp name="ThreadGroup.scheduler">false</boolProp>
        <stringProp name="ThreadGroup.duration"></stringProp>
        <stringProp name="ThreadGroup.delay"></stringProp>
      </ThreadGroup>
      <hashTree>
        <BeanShellSampler guiclass="BeanShellSamplerGui" testclass="BeanShellSampler" testname="测试准备2-引入环境变量" enabled="true">
          <stringProp name="TestPlan.comments">设置好用例循环次数</stringProp>
          <stringProp name="BeanShellSampler.query">vars.put(&quot;apikey&quot;,${__P(apikey,)});
vars.put(&quot;esIp&quot;,${__P(esIp,)});
vars.put(&quot;kafkaIp&quot;,${__P(kafkaIp,)});
vars.put(&quot;mysqlIp&quot;,${__P(mysqlIp,)});
vars.put(&quot;mysqlpasswd&quot;,${__P(mysqlpasswd,)});
vars.put(&quot;redisIp&quot;,${__P(redisIp,)});
vars.put(&quot;redisPasswd&quot;,${__P(redisPasswd,)});
vars.put(&quot;mongodbIp&quot;,${__P(mongodbIp,)});



vars.put(&quot;omp.protocol&quot;,&quot;${__P(omp.protocol,)}&quot;);
vars.put(&quot;omp.url&quot;,&quot;${__P(omp.url,)}&quot;);
vars.put(&quot;omp.port&quot;,&quot;${__P(omp.port,)}&quot;);

vars.put(&quot;tenant.protocol&quot;,&quot;${__P(tenant.protocol,)}&quot;);
vars.put(&quot;tenant.url&quot;,&quot;${__P(tenant.url,)}&quot;);
vars.put(&quot;tenant.port&quot;,&quot;${__P(tenant.port,)}&quot;);

vars.put(&quot;databank_metadata.protocol&quot;,&quot;${__P(databank_metadata.protocol,)}&quot;);
vars.put(&quot;databank_metadata.url&quot;,&quot;${__P(databank_metadata.url,)}&quot;);
vars.put(&quot;databank_metadata.port&quot;,&quot;${__P(databank_metadata.port,)}&quot;);


vars.put(&quot;omp_token&quot;,&quot;${__P(omp_token,)}&quot;);
vars.put(&quot;tenant_token&quot;,&quot;${__P(tenant_token,)}&quot;);
vars.put(&quot;count&quot;,&quot;${__P(count,)}&quot;);
vars.put(&quot;__time(yyyyMMdd)&quot;,&quot;${__time(yyyyMMdd)}&quot;);
vars.put(&quot;__time()&quot;,&quot;${__time()}&quot;);
vars.put(&quot;__timeShift(,,PT1H,,)&quot;,&quot;${__timeShift(,,PT1H,,)}&quot;);
vars.put(&quot;__timeShift(,,-PT1H,,)&quot;,&quot;${__timeShift(,,-PT1H,,)}&quot;);
vars.put(&quot;__timeShift(yyyyMMdd,,P-1D,,)&quot;,&quot;${__timeShift(yyyyMMdd,,P-1D,,)}&quot;);
vars.put(&quot;__timeShift(yyyyMMdd,,P1D,,)&quot;,&quot;${__timeShift(yyyyMMdd,,P1D,,)}&quot;);
vars.put(&quot;__timeShift(yyyyMMdd,,P-2D,,)&quot;,&quot;${__timeShift(yyyyMMdd,,P-2D,,)}&quot;);
vars.put(&quot;__timeShift(,,P1D,,)&quot;,&quot;${__timeShift(,,P1D,,)}&quot;);
vars.put(&quot;__timeShift(,,P-2D,,)&quot;,&quot;${__timeShift(,,P-2D,,)}&quot;);
//kafka循环写入多条时的初始化值
vars.put(&quot;kafka_init_num&quot;,&quot;1&quot;);
</stringProp>
          <stringProp name="BeanShellSampler.filename"></stringProp>
          <stringProp name="BeanShellSampler.parameters"></stringProp>
          <boolProp name="BeanShellSampler.resetInterpreter">false</boolProp>
        </BeanShellSampler>
        <hashTree/>
        <LoopController guiclass="LoopControlPanel" testclass="LoopController" testname="执行用例" enabled="true">
          <boolProp name="LoopController.continue_forever">true</boolProp>
          <stringProp name="LoopController.loops">${count}</stringProp>
          <stringProp name="TestPlan.comments">${count}</stringProp>
        </LoopController>
        <hashTree>
          <CounterConfig guiclass="CounterConfigGui" testclass="CounterConfig" testname="计数器" enabled="true">
            <stringProp name="CounterConfig.start">0</stringProp>
            <stringProp name="CounterConfig.end">${count}</stringProp>
            <stringProp name="CounterConfig.incr">1</stringProp>
            <stringProp name="CounterConfig.name">execute_num</stringProp>
            <stringProp name="CounterConfig.format"></stringProp>
            <boolProp name="CounterConfig.per_user">false</boolProp>
          </CounterConfig>
          <hashTree/>
          <JSR223Sampler guiclass="TestBeanGUI" testclass="JSR223Sampler" testname="用例信息" enabled="true">
            <stringProp name="scriptLanguage">groovy</stringProp>
            <stringProp name="parameters"></stringProp>
            <stringProp name="filename"></stringProp>
            <stringProp name="cacheKey">false</stringProp>
            <stringProp name="script">import web.utils.*;
import br.eti.kinoshita.testlinkjavaapi.TestLinkAPI;
import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONObject;
import com.qa.util.TestlinkUtil;
import java.util.List;
import java.util.Map;
import java.util.regex.*;
vars.put(&quot;mysql_command&quot;,null);
vars.put(&quot;ES_command&quot;,null);
vars.put(&quot;kafka_command&quot;,null);
vars.put(&quot;mongodb_command&quot;,null);
vars.put(&quot;mysql_result&quot;,null);
vars.put(&quot;ES_result&quot;,null);
vars.put(&quot;mongodb_result&quot;,null);

List total_data = props.get(&quot;total_data&quot;); 
int execute_num=Integer.parseInt(vars.get(&quot;execute_num&quot;));
String preconditon = total_data.get(execute_num).get(&quot;preconditon&quot;).trim();
preconditon=var2Str(preconditon);
String expect_result=total_data.get(execute_num).get(&quot;expect_result&quot;).replace(&quot;&lt;br /&gt;&quot;,&quot;\n&quot;);

vars.put(&quot;caseName&quot;,total_data.get(execute_num).get(&quot;name&quot;));
vars.put(&quot;preconditon&quot;,preconditon);
String exec_body=total_data.get(execute_num).get(&quot;body&quot;)+&quot;&quot;;
exec_body=var2Str(exec_body);
vars.put(&quot;exec_body&quot;,exec_body);
vars.put(&quot;expect_result&quot;,expect_result);

vars.put(&quot;preconditon&quot;,preconditon);
public String var2Str(String var) {
	String var_name;
	//用于匹配出{}内部的数
	Pattern pattern =  Pattern.compile(&quot;\$*!?\\{([A-Za-z0-9_().,-]+)\\}&quot;);
	Matcher matcher = pattern.matcher(var);
	while(matcher.find()){
		var_name=matcher.group().replace(&quot;{&quot;,&quot;&quot;).replace(&quot;}&quot;,&quot;&quot;);
		if(vars.get(var_name)!=null){
		var=var.replace(&quot;\${&quot;+var_name+&quot;}&quot;,vars.get(var_name));
		}
	}
	return var;
}

</stringProp>
          </JSR223Sampler>
          <hashTree/>
          <JSR223Sampler guiclass="TestBeanGUI" testclass="JSR223Sampler" testname="执行判断" enabled="true">
            <stringProp name="scriptLanguage">groovy</stringProp>
            <stringProp name="parameters"></stringProp>
            <stringProp name="filename"></stringProp>
            <stringProp name="cacheKey">true</stringProp>
            <stringProp name="script">import web.utils.*;
import br.eti.kinoshita.testlinkjavaapi.TestLinkAPI;
import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONObject;
import com.qa.util.TestlinkUtil;
import java.util.List;
import java.util.Map;
import java.util.regex.*;
String preconditon=vars.get(&quot;preconditon&quot;);
JSONObject data_obj = JSON.parseObject(preconditon);
//提供变量给前置条件，执行判断
if(data_obj!=null){
	if(data_obj.get(&quot;mysql&quot;)!=null){
		String mysql_command=data_obj.get(&quot;mysql&quot;);
		vars.put(&quot;mysql_command&quot;,mysql_command);
	}
	if(data_obj.get(&quot;ES&quot;)!=null){
		String ES_command=data_obj.get(&quot;ES&quot;);
		vars.put(&quot;ES_command&quot;,ES_command);
	}
	if(data_obj.get(&quot;mongodb&quot;)!=null){
		String mongodb_command=data_obj.get(&quot;mongodb&quot;);
		vars.put(&quot;mongodb_command&quot;,mongodb_command);
	}
	if(data_obj.get(&quot;kafka&quot;)!=null){
		String kafka_command=data_obj.get(&quot;kafka&quot;).toString();
		String topic=data_obj.get(&quot;topic&quot;);
		String kafka_count=data_obj.get(&quot;kafka_count&quot;);
		vars.put(&quot;kafka_command&quot;,kafka_command);
		vars.put(&quot;topic&quot;,topic);
		vars.put(&quot;kafka_count&quot;,kafka_count);
	}
	if(data_obj.get(&quot;redis_delname&quot;)!=null){
		String redis_delname=data_obj.get(&quot;redis_delname&quot;);
		String index=data_obj.get(&quot;redis_index&quot;);
		vars.put(&quot;redis_delname&quot;,redis_delname);
		vars.put(&quot;index&quot;,index);
	}
	if(data_obj.get(&quot;request&quot;)!=null){
		String pre_request_command=data_obj.get(&quot;request&quot;).toString();
		vars.put(&quot;pre_request_command&quot;,pre_request_command);
		JSONObject request_resultobject = JSON.parseObject(pre_request_command);
		vars.put(&quot;pre_request_method&quot;,request_resultobject.get(&quot;request_method&quot;));
	}
}

//提供变量给请求方式和mysql对应的库，执行判断
String exec_body=vars.get(&quot;exec_body&quot;);
JSONObject body = JSON.parseObject(exec_body);
vars.put(&quot;method&quot;,body.get(&quot;method&quot;));
if(body.get(&quot;method&quot;) == &quot;DUBBO&quot;){
	int var_count=0;
	for(int i=1;i&lt;=5;i++){
		if(exec_body.contains(&quot;param_value&quot;+i)){
			var_count++;
			}
		}
	vars.put(&quot;var_count&quot;,var_count+&quot;&quot;);
}
if(body.get(&quot;url&quot;).contains(&quot;omp&quot;)){
	vars.put(&quot;protocol&quot;,&quot;${omp.protocol}&quot;);
	vars.put(&quot;ip&quot;,&quot;${omp.url}&quot;);
	vars.put(&quot;port&quot;,&quot;${omp.port}&quot;);
}else if(body.get(&quot;url&quot;).contains(&quot;metadata&quot;)){
	vars.put(&quot;protocol&quot;,&quot;${databank_metadata.protocol}&quot;);
	vars.put(&quot;ip&quot;,&quot;${databank_metadata.url}&quot;);
	vars.put(&quot;port&quot;,&quot;${databank_metadata.port}&quot;);
}else{
	vars.put(&quot;protocol&quot;,&quot;${tenant.protocol}&quot;);
	vars.put(&quot;ip&quot;,&quot;${tenant.url}&quot;);
	vars.put(&quot;port&quot;,&quot;${tenant.port}&quot;);
}
//提供变量给断言，执行判断
String expect_result=vars.get(&quot;expect_result&quot;);
JSONObject expect_obj = JSON.parseObject(expect_result);
String response_result=expect_obj.get(&quot;response_result&quot;).toString();

vars.put(&quot;response_expect_result&quot;,response_result);
vars.put(&quot;mysql_expect_result&quot;,expect_obj.get(&quot;mysql_result&quot;)+&quot;&quot;);
vars.put(&quot;ES_expect_result&quot;,expect_obj.get(&quot;ES_result&quot;)+&quot;&quot;);
vars.put(&quot;mongodb_expect_result&quot;,expect_obj.get(&quot;mongodb_result&quot;)+&quot;&quot;);
vars.put(&quot;redis_expect_result&quot;,expect_obj.get(&quot;redis_result&quot;)+&quot;&quot;);
//不是最终的校验值
vars.put(&quot;request_expect_result&quot;,expect_obj.get(&quot;request_result&quot;).toString());
</stringProp>
          </JSR223Sampler>
          <hashTree/>
          <CookieManager guiclass="CookiePanel" testclass="CookieManager" testname="测试准备1-引入登录cookie" enabled="true">
            <collectionProp name="CookieManager.cookies">
              <elementProp name="omp_token" elementType="Cookie" testname="omp_token">
                <stringProp name="Cookie.value">${omp_token}</stringProp>
                <stringProp name="Cookie.domain">${omp.url}</stringProp>
                <stringProp name="Cookie.path"></stringProp>
                <boolProp name="Cookie.secure">false</boolProp>
                <longProp name="Cookie.expires">0</longProp>
                <boolProp name="Cookie.path_specified">true</boolProp>
                <boolProp name="Cookie.domain_specified">true</boolProp>
              </elementProp>
              <elementProp name="token" elementType="Cookie" testname="token">
                <stringProp name="Cookie.value">${tenant_token}</stringProp>
                <stringProp name="Cookie.domain">${tenant.url}</stringProp>
                <stringProp name="Cookie.path"></stringProp>
                <boolProp name="Cookie.secure">false</boolProp>
                <longProp name="Cookie.expires">0</longProp>
                <boolProp name="Cookie.path_specified">true</boolProp>
                <boolProp name="Cookie.domain_specified">true</boolProp>
              </elementProp>
            </collectionProp>
            <stringProp name="TestPlan.comments">根据前提设置OMP还是租户的登录</stringProp>
            <boolProp name="CookieManager.clearEachIteration">false</boolProp>
          </CookieManager>
          <hashTree/>
          <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP信息头管理器" enabled="true">
            <collectionProp name="HeaderManager.headers">
              <elementProp name="Content-Type" elementType="Header">
                <stringProp name="Header.name">Content-Type</stringProp>
                <stringProp name="Header.value">application/json;charset=UTF-8</stringProp>
              </elementProp>
              <elementProp name="Accept" elementType="Header">
                <stringProp name="Header.name">Accept</stringProp>
                <stringProp name="Header.value">*/*</stringProp>
              </elementProp>
            </collectionProp>
          </HeaderManager>
          <hashTree/>
          <TransactionController guiclass="TransactionControllerGui" testclass="TransactionController" testname="${caseName}" enabled="true">
            <boolProp name="TransactionController.includeTimers">false</boolProp>
            <boolProp name="TransactionController.parent">false</boolProp>
          </TransactionController>
          <hashTree>
            <TransactionController guiclass="TransactionControllerGui" testclass="TransactionController" testname="前置条件" enabled="true">
              <boolProp name="TransactionController.includeTimers">false</boolProp>
              <boolProp name="TransactionController.parent">false</boolProp>
            </TransactionController>
            <hashTree>
              <JSR223PreProcessor guiclass="TestBeanGUI" testclass="JSR223PreProcessor" testname="JSR223 预处理程序" enabled="true">
                <stringProp name="scriptLanguage">groovy</stringProp>
                <stringProp name="parameters"></stringProp>
                <stringProp name="filename"></stringProp>
                <stringProp name="cacheKey">false</stringProp>
                <stringProp name="script">import web.utils.*;
import br.eti.kinoshita.testlinkjavaapi.TestLinkAPI;
import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONObject;
import com.qa.util.TestlinkUtil;
import java.util.List;
import java.util.Map;
import java.util.regex.*;
//前置条件变量替换
String preconditon=var2Str(vars.get(&quot;preconditon&quot;));
JSONObject data_obj = JSON.parseObject(preconditon);
if(data_obj!=null){
	if(data_obj.get(&quot;mysql&quot;)!=null){
		String mysql_command=data_obj.get(&quot;mysql&quot;);
		vars.put(&quot;mysql_command&quot;,mysql_command);
	}
	if(data_obj.get(&quot;ES&quot;)!=null){
		String ES_command=data_obj.get(&quot;ES&quot;);
		vars.put(&quot;ES_command&quot;,ES_command);
	}
	if(data_obj.get(&quot;mongodb&quot;)!=null){
		String mongodb_command=data_obj.get(&quot;mongodb&quot;);
		vars.put(&quot;mongodb_command&quot;,mongodb_command);
	}
	if(data_obj.get(&quot;kafka&quot;)!=null){
		String kafka_command=data_obj.get(&quot;kafka&quot;);
		String topic=data_obj.get(&quot;topic&quot;);
		String kafka_count=data_obj.get(&quot;kafka_count&quot;);
		vars.put(&quot;kafka_command&quot;,kafka_command);
		vars.put(&quot;topic&quot;,topic);
		vars.put(&quot;kafka_count&quot;,kafka_count);
	}
	if(data_obj.get(&quot;redis&quot;)!=null){
		String redis_delname=data_obj.get(&quot;redis&quot;);
		String index=data_obj.get(&quot;redis_index&quot;);
		vars.put(&quot;redis_delname&quot;,redis_delname);
		vars.put(&quot;index&quot;,index);
	}
	if(data_obj.get(&quot;request&quot;)!=null){
		String pre_request_command=data_obj.get(&quot;request&quot;).toString();
		vars.put(&quot;pre_request_command&quot;,pre_request_command);
		JSONObject request_resultobject = JSON.parseObject(pre_request_command);
		vars.put(&quot;pre_request_method&quot;,request_resultobject.get(&quot;request_method&quot;));
	}
}

public String var2Str(String var) {
	String var_name;
	//用于匹配出{}内部的数
	Pattern pattern =  Pattern.compile(&quot;\$*!?\\{([A-Za-z0-9_().,-]+)\\}&quot;);
	Matcher matcher = pattern.matcher(var);
	while(matcher.find()){
		var_name=matcher.group().replace(&quot;{&quot;,&quot;&quot;).replace(&quot;}&quot;,&quot;&quot;);
		if(vars.get(var_name)!=null){
		var=var.replace(&quot;\${&quot;+var_name+&quot;}&quot;,vars.get(var_name));
		}
	}
	return var;
}
</stringProp>
              </JSR223PreProcessor>
              <hashTree/>
              <IfController guiclass="IfControllerPanel" testclass="IfController" testname="ES前置条件" enabled="true">
                <stringProp name="IfController.condition">${__jexl3(vars.get(&quot;ES_command&quot;) != null )}</stringProp>
                <boolProp name="IfController.evaluateAll">false</boolProp>
                <boolProp name="IfController.useExpression">true</boolProp>
              </IfController>
              <hashTree>
                <org.apache.jmeter.protocol.ssh.sampler.SSHCommandSampler guiclass="TestBeanGUI" testclass="org.apache.jmeter.protocol.ssh.sampler.SSHCommandSampler" testname="ES数据初始化" enabled="true">
                  <stringProp name="command">${ES_command}</stringProp>
                  <intProp name="connectionTimeout">50000</intProp>
                  <stringProp name="hostname">${mysqlIp}</stringProp>
                  <stringProp name="passphrase"></stringProp>
                  <stringProp name="password">${mysqlpasswd}</stringProp>
                  <intProp name="port">22</intProp>
                  <boolProp name="printStdErr">true</boolProp>
                  <stringProp name="sshkeyfile"></stringProp>
                  <boolProp name="useReturnCode">true</boolProp>
                  <stringProp name="username">root</stringProp>
                </org.apache.jmeter.protocol.ssh.sampler.SSHCommandSampler>
                <hashTree>
                  <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="JSR223 后置处理程序" enabled="true">
                    <stringProp name="scriptLanguage">groovy</stringProp>
                    <stringProp name="parameters"></stringProp>
                    <stringProp name="filename"></stringProp>
                    <stringProp name="cacheKey">true</stringProp>
                    <stringProp name="script">sleep(20000)</stringProp>
                  </JSR223PostProcessor>
                  <hashTree/>
                </hashTree>
                <TestAction guiclass="TestActionGui" testclass="TestAction" testname="等待ES刷新" enabled="false">
                  <intProp name="ActionProcessor.action">1</intProp>
                  <intProp name="ActionProcessor.target">0</intProp>
                  <stringProp name="ActionProcessor.duration">5000</stringProp>
                </TestAction>
                <hashTree/>
              </hashTree>
              <IfController guiclass="IfControllerPanel" testclass="IfController" testname="mysql前置条件" enabled="true">
                <stringProp name="IfController.condition">${__jexl3(vars.get(&quot;mysql_command&quot;) != null )}</stringProp>
                <boolProp name="IfController.evaluateAll">false</boolProp>
                <boolProp name="IfController.useExpression">true</boolProp>
              </IfController>
              <hashTree>
                <TransactionController guiclass="TransactionControllerGui" testclass="TransactionController" testname="mysql数据准备" enabled="true">
                  <boolProp name="TransactionController.includeTimers">false</boolProp>
                  <boolProp name="TransactionController.parent">false</boolProp>
                </TransactionController>
                <hashTree>
                  <IfController guiclass="IfControllerPanel" testclass="IfController" testname="10.1.61.11databank-metadata测试" enabled="true">
                    <stringProp name="IfController.condition">&quot;${mysqlIp}&quot; == &quot;10.1.61.11&quot; &amp;&amp;&quot;${caseName}&quot;.contains(&quot;metadata&quot;)</stringProp>
                    <boolProp name="IfController.evaluateAll">false</boolProp>
                  </IfController>
                  <hashTree>
                    <JDBCDataSource guiclass="TestBeanGUI" testclass="JDBCDataSource" testname="JDBC Connection Configuration" enabled="true">
                      <boolProp name="autocommit">true</boolProp>
                      <stringProp name="checkQuery"></stringProp>
                      <stringProp name="connectionAge">5000</stringProp>
                      <stringProp name="dataSource">mysql_databankmetadata_6111</stringProp>
                      <stringProp name="dbUrl">jdbc:mysql://10.1.61.11:3306/databank_metadata?allowMultiQueries=true</stringProp>
                      <stringProp name="driver">com.mysql.jdbc.Driver</stringProp>
                      <stringProp name="initQuery"></stringProp>
                      <boolProp name="keepAlive">true</boolProp>
                      <stringProp name="password">Admin@123</stringProp>
                      <stringProp name="poolMax">0</stringProp>
                      <stringProp name="timeout">10000</stringProp>
                      <stringProp name="transactionIsolation">DEFAULT</stringProp>
                      <stringProp name="trimInterval">60000</stringProp>
                      <stringProp name="username">zhang</stringProp>
                    </JDBCDataSource>
                    <hashTree/>
                    <JDBCSampler guiclass="TestBeanGUI" testclass="JDBCSampler" testname="初始化数据库t1" enabled="true">
                      <stringProp name="dataSource">mysql_databankmetadata_6111</stringProp>
                      <stringProp name="query">${mysql_command}</stringProp>
                      <stringProp name="queryArguments"></stringProp>
                      <stringProp name="queryArgumentsTypes"></stringProp>
                      <stringProp name="queryTimeout"></stringProp>
                      <stringProp name="queryType">Callable Statement</stringProp>
                      <stringProp name="resultSetHandler">Store as String</stringProp>
                      <stringProp name="resultVariable"></stringProp>
                      <stringProp name="variableNames">name</stringProp>
                    </JDBCSampler>
                    <hashTree/>
                  </hashTree>
                  <IfController guiclass="IfControllerPanel" testclass="IfController" testname="10.1.61.11databank-datamap测试" enabled="true">
                    <stringProp name="IfController.condition">&quot;${mysqlIp}&quot; == &quot;10.1.61.11&quot; &amp;&amp;&quot;${caseName}&quot;.contains(&quot;datamap&quot;)</stringProp>
                    <boolProp name="IfController.evaluateAll">false</boolProp>
                  </IfController>
                  <hashTree>
                    <JDBCDataSource guiclass="TestBeanGUI" testclass="JDBCDataSource" testname="JDBC Connection Configuration" enabled="true">
                      <boolProp name="autocommit">true</boolProp>
                      <stringProp name="checkQuery"></stringProp>
                      <stringProp name="connectionAge">5000</stringProp>
                      <stringProp name="dataSource">mysql_databankdatamap_6111</stringProp>
                      <stringProp name="dbUrl">jdbc:mysql://10.1.61.11:3306/uyun_udap?allowMultiQueries=true</stringProp>
                      <stringProp name="driver">com.mysql.jdbc.Driver</stringProp>
                      <stringProp name="initQuery"></stringProp>
                      <boolProp name="keepAlive">true</boolProp>
                      <stringProp name="password">Admin@123</stringProp>
                      <stringProp name="poolMax">0</stringProp>
                      <stringProp name="timeout">10000</stringProp>
                      <stringProp name="transactionIsolation">DEFAULT</stringProp>
                      <stringProp name="trimInterval">60000</stringProp>
                      <stringProp name="username">zhang</stringProp>
                    </JDBCDataSource>
                    <hashTree/>
                    <JDBCSampler guiclass="TestBeanGUI" testclass="JDBCSampler" testname="初始化数据库t1" enabled="true">
                      <stringProp name="dataSource">mysql_databankdatamap_6111</stringProp>
                      <stringProp name="query">${mysql_command}</stringProp>
                      <stringProp name="queryArguments"></stringProp>
                      <stringProp name="queryArgumentsTypes"></stringProp>
                      <stringProp name="queryTimeout"></stringProp>
                      <stringProp name="queryType">Callable Statement</stringProp>
                      <stringProp name="resultSetHandler">Store as String</stringProp>
                      <stringProp name="resultVariable"></stringProp>
                      <stringProp name="variableNames">name</stringProp>
                    </JDBCSampler>
                    <hashTree/>
                  </hashTree>
                  <IfController guiclass="IfControllerPanel" testclass="IfController" testname="10.1.56.159databank-metadata测试" enabled="true">
                    <stringProp name="IfController.condition">&quot;${mysqlIp}&quot; == &quot;10.1.56.159&quot; &amp;&amp;&quot;${caseName}&quot;.contains(&quot;metadata&quot;)</stringProp>
                    <boolProp name="IfController.evaluateAll">false</boolProp>
                  </IfController>
                  <hashTree>
                    <JDBCDataSource guiclass="TestBeanGUI" testclass="JDBCDataSource" testname="JDBC Connection Configuration" enabled="true">
                      <boolProp name="autocommit">true</boolProp>
                      <stringProp name="checkQuery"></stringProp>
                      <stringProp name="connectionAge">5000</stringProp>
                      <stringProp name="dataSource">mysql_databankmetadata_56.159</stringProp>
                      <stringProp name="dbUrl">jdbc:mysql://10.1.56.159:3306/databank_metadata?allowMultiQueries=true</stringProp>
                      <stringProp name="driver">com.mysql.jdbc.Driver</stringProp>
                      <stringProp name="initQuery"></stringProp>
                      <boolProp name="keepAlive">true</boolProp>
                      <stringProp name="password">Admin@123</stringProp>
                      <stringProp name="poolMax">0</stringProp>
                      <stringProp name="timeout">10000</stringProp>
                      <stringProp name="transactionIsolation">DEFAULT</stringProp>
                      <stringProp name="trimInterval">60000</stringProp>
                      <stringProp name="username">zhang</stringProp>
                    </JDBCDataSource>
                    <hashTree/>
                    <JDBCSampler guiclass="TestBeanGUI" testclass="JDBCSampler" testname="初始化数据库t1" enabled="true">
                      <stringProp name="dataSource">mysql_databankmetadata_56.159</stringProp>
                      <stringProp name="query">${mysql_command}</stringProp>
                      <stringProp name="queryArguments"></stringProp>
                      <stringProp name="queryArgumentsTypes"></stringProp>
                      <stringProp name="queryTimeout"></stringProp>
                      <stringProp name="queryType">Callable Statement</stringProp>
                      <stringProp name="resultSetHandler">Store as String</stringProp>
                      <stringProp name="resultVariable"></stringProp>
                      <stringProp name="variableNames">name</stringProp>
                    </JDBCSampler>
                    <hashTree/>
                  </hashTree>
                  <IfController guiclass="IfControllerPanel" testclass="IfController" testname="10.1.56.159databank-datamap测试" enabled="true">
                    <stringProp name="IfController.condition">&quot;${mysqlIp}&quot; == &quot;10.1.56.159&quot; &amp;&amp;&quot;${caseName}&quot;.contains(&quot;datamap&quot;)</stringProp>
                    <boolProp name="IfController.evaluateAll">false</boolProp>
                  </IfController>
                  <hashTree>
                    <JDBCDataSource guiclass="TestBeanGUI" testclass="JDBCDataSource" testname="JDBC Connection Configuration" enabled="true">
                      <boolProp name="autocommit">true</boolProp>
                      <stringProp name="checkQuery"></stringProp>
                      <stringProp name="connectionAge">5000</stringProp>
                      <stringProp name="dataSource">mysql_databankdatamap_56.159</stringProp>
                      <stringProp name="dbUrl">jdbc:mysql://10.1.56.159:3306/uyun_udap?allowMultiQueries=true</stringProp>
                      <stringProp name="driver">com.mysql.jdbc.Driver</stringProp>
                      <stringProp name="initQuery"></stringProp>
                      <boolProp name="keepAlive">true</boolProp>
                      <stringProp name="password">Admin@123</stringProp>
                      <stringProp name="poolMax">0</stringProp>
                      <stringProp name="timeout">10000</stringProp>
                      <stringProp name="transactionIsolation">DEFAULT</stringProp>
                      <stringProp name="trimInterval">60000</stringProp>
                      <stringProp name="username">zhang</stringProp>
                    </JDBCDataSource>
                    <hashTree/>
                    <JDBCSampler guiclass="TestBeanGUI" testclass="JDBCSampler" testname="初始化数据库t1" enabled="true">
                      <stringProp name="dataSource">mysql_databankmetadata_56.159</stringProp>
                      <stringProp name="query">${mysql_command}</stringProp>
                      <stringProp name="queryArguments"></stringProp>
                      <stringProp name="queryArgumentsTypes"></stringProp>
                      <stringProp name="queryTimeout"></stringProp>
                      <stringProp name="queryType">Callable Statement</stringProp>
                      <stringProp name="resultSetHandler">Store as String</stringProp>
                      <stringProp name="resultVariable"></stringProp>
                      <stringProp name="variableNames">name</stringProp>
                    </JDBCSampler>
                    <hashTree/>
                  </hashTree>
                  <IfController guiclass="IfControllerPanel" testclass="IfController" testname="10.1.40.81databank-metadata测试" enabled="true">
                    <stringProp name="IfController.condition">&quot;${mysqlIp}&quot; == &quot;10.1.40.81&quot; &amp;&amp;&quot;${caseName}&quot;.contains(&quot;metadata&quot;)</stringProp>
                    <boolProp name="IfController.evaluateAll">false</boolProp>
                  </IfController>
                  <hashTree>
                    <JDBCDataSource guiclass="TestBeanGUI" testclass="JDBCDataSource" testname="JDBC Connection Configuration" enabled="true">
                      <boolProp name="autocommit">true</boolProp>
                      <stringProp name="checkQuery"></stringProp>
                      <stringProp name="connectionAge">5000</stringProp>
                      <stringProp name="dataSource">mysql_databankmetadata_4081</stringProp>
                      <stringProp name="dbUrl">jdbc:mysql://10.1.40.81:3306/databank_metadata?allowMultiQueries=true</stringProp>
                      <stringProp name="driver">com.mysql.jdbc.Driver</stringProp>
                      <stringProp name="initQuery"></stringProp>
                      <boolProp name="keepAlive">true</boolProp>
                      <stringProp name="password">Admin@123</stringProp>
                      <stringProp name="poolMax">0</stringProp>
                      <stringProp name="timeout">10000</stringProp>
                      <stringProp name="transactionIsolation">DEFAULT</stringProp>
                      <stringProp name="trimInterval">60000</stringProp>
                      <stringProp name="username">zhang</stringProp>
                    </JDBCDataSource>
                    <hashTree/>
                    <JDBCSampler guiclass="TestBeanGUI" testclass="JDBCSampler" testname="初始化数据库t1" enabled="true">
                      <stringProp name="dataSource">mysql_databankmetadata_4081</stringProp>
                      <stringProp name="query">${mysql_command}</stringProp>
                      <stringProp name="queryArguments"></stringProp>
                      <stringProp name="queryArgumentsTypes"></stringProp>
                      <stringProp name="queryTimeout"></stringProp>
                      <stringProp name="queryType">Callable Statement</stringProp>
                      <stringProp name="resultSetHandler">Store as String</stringProp>
                      <stringProp name="resultVariable"></stringProp>
                      <stringProp name="variableNames">name</stringProp>
                    </JDBCSampler>
                    <hashTree/>
                  </hashTree>
                  <IfController guiclass="IfControllerPanel" testclass="IfController" testname="10.1.40.81databank-datamap测试" enabled="true">
                    <stringProp name="IfController.condition">&quot;${mysqlIp}&quot; == &quot;10.1.40.81&quot; &amp;&amp; (&quot;${caseName}&quot;.contains(&quot;datamap&quot;) ||&quot;${caseName}&quot;.contains(&quot;openapi&quot;))</stringProp>
                    <boolProp name="IfController.evaluateAll">false</boolProp>
                  </IfController>
                  <hashTree>
                    <JDBCDataSource guiclass="TestBeanGUI" testclass="JDBCDataSource" testname="JDBC Connection Configuration" enabled="true">
                      <boolProp name="autocommit">true</boolProp>
                      <stringProp name="checkQuery"></stringProp>
                      <stringProp name="connectionAge">5000</stringProp>
                      <stringProp name="dataSource">mysql_databankdatamap_4081</stringProp>
                      <stringProp name="dbUrl">jdbc:mysql://10.1.40.81:3306/uyun_udap?allowMultiQueries=true</stringProp>
                      <stringProp name="driver">com.mysql.jdbc.Driver</stringProp>
                      <stringProp name="initQuery"></stringProp>
                      <boolProp name="keepAlive">true</boolProp>
                      <stringProp name="password">Admin@123</stringProp>
                      <stringProp name="poolMax">0</stringProp>
                      <stringProp name="timeout">10000</stringProp>
                      <stringProp name="transactionIsolation">DEFAULT</stringProp>
                      <stringProp name="trimInterval">60000</stringProp>
                      <stringProp name="username">zhang</stringProp>
                    </JDBCDataSource>
                    <hashTree/>
                    <JDBCSampler guiclass="TestBeanGUI" testclass="JDBCSampler" testname="初始化数据库t1" enabled="true">
                      <stringProp name="dataSource">mysql_databankmetadata_4081</stringProp>
                      <stringProp name="query">${mysql_command}</stringProp>
                      <stringProp name="queryArguments"></stringProp>
                      <stringProp name="queryArgumentsTypes"></stringProp>
                      <stringProp name="queryTimeout"></stringProp>
                      <stringProp name="queryType">Callable Statement</stringProp>
                      <stringProp name="resultSetHandler">Store as String</stringProp>
                      <stringProp name="resultVariable"></stringProp>
                      <stringProp name="variableNames">name</stringProp>
                    </JDBCSampler>
                    <hashTree/>
                  </hashTree>
                </hashTree>
              </hashTree>
              <IfController guiclass="IfControllerPanel" testclass="IfController" testname="mongodb前置条件" enabled="true">
                <stringProp name="IfController.condition">${__jexl3(vars.get(&quot;mongodb_command&quot;) != null )}</stringProp>
                <boolProp name="IfController.evaluateAll">false</boolProp>
                <boolProp name="IfController.useExpression">true</boolProp>
              </IfController>
              <hashTree>
                <TransactionController guiclass="TransactionControllerGui" testclass="TransactionController" testname="mongdb数据准备" enabled="true">
                  <boolProp name="TransactionController.includeTimers">false</boolProp>
                  <boolProp name="TransactionController.parent">false</boolProp>
                </TransactionController>
                <hashTree>
                  <JSR223Sampler guiclass="TestBeanGUI" testclass="JSR223Sampler" testname="JSR223 Sampler" enabled="true">
                    <stringProp name="scriptLanguage">groovy</stringProp>
                    <stringProp name="parameters"></stringProp>
                    <stringProp name="filename"></stringProp>
                    <stringProp name="cacheKey">false</stringProp>
                    <stringProp name="script">import com.mongodb.client.MongoClients;
import com.mongodb.client.MongoClient;
import com.mongodb.client.MongoCollection;
import com.mongodb.client.MongoDatabase;
import static com.mongodb.client.model.Filters.*;
import org.bson.Document;
import java.util.Arrays;
import com.mongodb.client.FindIterable;
import com.mongodb.client.MongoCursor;
${mongodb_command}</stringProp>
                  </JSR223Sampler>
                  <hashTree/>
                </hashTree>
              </hashTree>
              <IfController guiclass="IfControllerPanel" testclass="IfController" testname="kafka前置条件" enabled="true">
                <stringProp name="IfController.condition">${__jexl3(vars.get(&quot;kafka_command&quot;) != null )}</stringProp>
                <boolProp name="IfController.evaluateAll">false</boolProp>
                <boolProp name="IfController.useExpression">true</boolProp>
              </IfController>
              <hashTree>
                <TransactionController guiclass="TransactionControllerGui" testclass="TransactionController" testname="kafka数据准备" enabled="true">
                  <boolProp name="TransactionController.includeTimers">false</boolProp>
                  <boolProp name="TransactionController.parent">false</boolProp>
                </TransactionController>
                <hashTree>
                  <LoopController guiclass="LoopControlPanel" testclass="LoopController" testname="循环控制器" enabled="true">
                    <boolProp name="LoopController.continue_forever">true</boolProp>
                    <stringProp name="LoopController.loops">${kafka_count}</stringProp>
                  </LoopController>
                  <hashTree>
                    <JavaSampler guiclass="JavaTestSamplerGui" testclass="JavaSampler" testname="写入kafka" enabled="true">
                      <stringProp name="TestPlan.comments">1、安装时间戳创建topic保证了独一无二
2、写入100条数据</stringProp>
                      <elementProp name="arguments" elementType="Arguments" guiclass="ArgumentsPanel" testclass="Arguments" enabled="true">
                        <collectionProp name="Arguments.arguments">
                          <elementProp name="kafka_brokers" elementType="Argument">
                            <stringProp name="Argument.name">kafka_brokers</stringProp>
                            <stringProp name="Argument.value">${kafkaIp}:9192</stringProp>
                            <stringProp name="Argument.metadata">=</stringProp>
                          </elementProp>
                          <elementProp name="kafka_topic" elementType="Argument">
                            <stringProp name="Argument.name">kafka_topic</stringProp>
                            <stringProp name="Argument.value">${topic}</stringProp>
                            <stringProp name="Argument.metadata">=</stringProp>
                          </elementProp>
                          <elementProp name="kafka_message" elementType="Argument">
                            <stringProp name="Argument.name">kafka_message</stringProp>
                            <stringProp name="Argument.value">${kafka_command}</stringProp>
                            <stringProp name="Argument.metadata">=</stringProp>
                          </elementProp>
                        </collectionProp>
                      </elementProp>
                      <stringProp name="classname">co.signal.kafkameter.KafkaProducerSampler</stringProp>
                    </JavaSampler>
                    <hashTree/>
                    <CounterConfig guiclass="CounterConfigGui" testclass="CounterConfig" testname="计数器" enabled="true">
                      <stringProp name="CounterConfig.start">1</stringProp>
                      <stringProp name="CounterConfig.end">1000</stringProp>
                      <stringProp name="CounterConfig.incr">1</stringProp>
                      <stringProp name="CounterConfig.name">kafka_init_num</stringProp>
                      <stringProp name="CounterConfig.format"></stringProp>
                      <boolProp name="CounterConfig.per_user">false</boolProp>
                    </CounterConfig>
                    <hashTree/>
                  </hashTree>
                </hashTree>
              </hashTree>
              <IfController guiclass="IfControllerPanel" testclass="IfController" testname="redis前置条件" enabled="true">
                <stringProp name="IfController.condition">${__jexl3(vars.get(&quot;redis_delname&quot;) != null )}</stringProp>
                <boolProp name="IfController.evaluateAll">false</boolProp>
                <boolProp name="IfController.useExpression">true</boolProp>
              </IfController>
              <hashTree>
                <TransactionController guiclass="TransactionControllerGui" testclass="TransactionController" testname="redis数据准备" enabled="true">
                  <boolProp name="TransactionController.includeTimers">false</boolProp>
                  <boolProp name="TransactionController.parent">false</boolProp>
                </TransactionController>
                <hashTree>
                  <JSR223Sampler guiclass="TestBeanGUI" testclass="JSR223Sampler" testname="删除redis缓存" enabled="true">
                    <stringProp name="scriptLanguage">groovy</stringProp>
                    <stringProp name="parameters"></stringProp>
                    <stringProp name="filename"></stringProp>
                    <stringProp name="cacheKey">false</stringProp>
                    <stringProp name="script">import redis.clients.jedis.Jedis;
import org.apache.commons.lang3.StringUtils;

String host = vars.get(&quot;redisIp&quot;); //服务器地址
int port = 6379; //端口号
String password = vars.get(&quot;redisPasswd&quot;); //redis密码
int index = Integer.parseInt(vars.get(&quot;index&quot;)); //redis db   缓存区
String redis_delname=vars.get(&quot;redis_delname&quot;);
Jedis jedis = new Jedis(host, port);
if(StringUtils.isNotBlank(password)){
jedis.auth(password);
}
jedis.connect();
jedis.select(index); //选择redis db
jedis.del(redis_delname);

//处理 hash 类型的数据
//String key = &quot;applicationType&quot;;
//String filed = &quot;58c680df5b71a73b448ccec0&quot;;
////jedis.hset(key,filed,&quot;bbbbbbbbbbbb&quot;);
//String value=jedis.hget(key,filed);
</stringProp>
                  </JSR223Sampler>
                  <hashTree/>
                  <JSR223Sampler guiclass="TestBeanGUI" testclass="JSR223Sampler" testname="删除redis缓存" enabled="false">
                    <stringProp name="scriptLanguage">groovy</stringProp>
                    <stringProp name="parameters"></stringProp>
                    <stringProp name="filename"></stringProp>
                    <stringProp name="cacheKey">false</stringProp>
                    <stringProp name="script">${redis_command}</stringProp>
                  </JSR223Sampler>
                  <hashTree>
                    <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="JSR223 后置处理程序" enabled="true">
                      <stringProp name="scriptLanguage">groovy</stringProp>
                      <stringProp name="parameters"></stringProp>
                      <stringProp name="filename"></stringProp>
                      <stringProp name="cacheKey">false</stringProp>
                      <stringProp name="script">import java.util.regex.*;
//前置条件变量替换
String preconditon=var2Str(vars.get(&quot;preconditon&quot;));
JSONObject data_obj = JSON.parseObject(preconditon);
if(data_obj!=null){
	if(data_obj.get(&quot;mysql&quot;)!=null){
		String mysql_command=data_obj.get(&quot;mysql&quot;);
		vars.put(&quot;mysql_command&quot;,mysql_command);
	}
	if(data_obj.get(&quot;ES&quot;)!=null){
		String ES_command=data_obj.get(&quot;ES&quot;);
		vars.put(&quot;ES_command&quot;,ES_command);
	}
	if(data_obj.get(&quot;mongodb&quot;)!=null){
		String mongodb_command=data_obj.get(&quot;mongodb&quot;);
		vars.put(&quot;mongodb_command&quot;,mongodb_command);
	}
	if(data_obj.get(&quot;kafka&quot;)!=null){
		String kafka_command=data_obj.get(&quot;kafka&quot;);
		String topic=data_obj.get(&quot;topic&quot;);
		vars.put(&quot;kafka_command&quot;,kafka_command);
		vars.put(&quot;topic&quot;,topic);
	}
	if(data_obj.get(&quot;redis&quot;)!=null){
		String redis_command=data_obj.get(&quot;redis&quot;);
		String index=data_obj.get(&quot;redis_index&quot;);
		vars.put(&quot;redis_command&quot;,redis_command);
		vars.put(&quot;index&quot;,index);
	}
}
public String var2Str(String var) {
String var_name;
//用于匹配出{}内部的数
Pattern pattern =  Pattern.compile(&quot;\$*!?\\{([A-Za-z0-9_()]+)\\}&quot;);
Matcher matcher = pattern.matcher(var);
while(matcher.find()){
	var_name=matcher.group().replace(&quot;{&quot;,&quot;&quot;).replace(&quot;}&quot;,&quot;&quot;);
	var=var.replace(&quot;\${&quot;+s+&quot;}&quot;,vars.get(var_name));
}
return var;
}
</stringProp>
                    </JSR223PostProcessor>
                    <hashTree/>
                  </hashTree>
                </hashTree>
              </hashTree>
              <IfController guiclass="IfControllerPanel" testclass="IfController" testname="request前置条件" enabled="true">
                <stringProp name="IfController.condition">${__jexl3(vars.get(&quot;pre_request_command&quot;) != null )}</stringProp>
                <boolProp name="IfController.evaluateAll">false</boolProp>
                <boolProp name="IfController.useExpression">true</boolProp>
              </IfController>
              <hashTree>
                <IfController guiclass="IfControllerPanel" testclass="IfController" testname="GET请求" enabled="true">
                  <stringProp name="IfController.condition">&quot;${pre_request_method}&quot; == &quot;GET&quot;</stringProp>
                  <boolProp name="IfController.evaluateAll">false</boolProp>
                </IfController>
                <hashTree>
                  <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="GET前置请求" enabled="true">
                    <elementProp name="HTTPsampler.Arguments" elementType="Arguments" guiclass="HTTPArgumentsPanel" testclass="Arguments" testname="用户定义的变量" enabled="true">
                      <collectionProp name="Arguments.arguments"/>
                    </elementProp>
                    <stringProp name="HTTPSampler.domain">${pre_request_ip}</stringProp>
                    <stringProp name="HTTPSampler.port">${pre_request_port}</stringProp>
                    <stringProp name="HTTPSampler.protocol">${pre_request_protocol}</stringProp>
                    <stringProp name="HTTPSampler.contentEncoding">UTF-8</stringProp>
                    <stringProp name="HTTPSampler.path">${pre_request_url}</stringProp>
                    <stringProp name="HTTPSampler.method">${pre_request_method}</stringProp>
                    <boolProp name="HTTPSampler.follow_redirects">false</boolProp>
                    <boolProp name="HTTPSampler.auto_redirects">false</boolProp>
                    <boolProp name="HTTPSampler.use_keepalive">false</boolProp>
                    <boolProp name="HTTPSampler.DO_MULTIPART_POST">false</boolProp>
                    <stringProp name="HTTPSampler.embedded_url_re"></stringProp>
                    <stringProp name="HTTPSampler.connect_timeout"></stringProp>
                    <stringProp name="HTTPSampler.response_timeout"></stringProp>
                  </HTTPSamplerProxy>
                  <hashTree>
                    <JSR223PreProcessor guiclass="TestBeanGUI" testclass="JSR223PreProcessor" testname="JSR223 预处理程序" enabled="true">
                      <stringProp name="scriptLanguage">groovy</stringProp>
                      <stringProp name="parameters"></stringProp>
                      <stringProp name="filename"></stringProp>
                      <stringProp name="cacheKey">true</stringProp>
                      <stringProp name="script">import java.util.regex.*
import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONObject;
import com.alibaba.fastjson.serializer.SerializerFeature;
String command=vars.get(&quot;pre_request_command&quot;);
JSONObject request_resultobject = JSON.parseObject(command);
String request_protocol=request_resultobject.get(&quot;request_protocol&quot;);
String request_ip=request_resultobject.get(&quot;request_ip&quot;);
String request_port=request_resultobject.get(&quot;request_port&quot;);
String request_method=request_resultobject.get(&quot;request_method&quot;);
String request_url=request_resultobject.get(&quot;request_url&quot;);
String request_body=request_resultobject.get(&quot;request_body&quot;);
String request_return_var=request_resultobject.get(&quot;request_return_var&quot;);
String request_return_exp=request_resultobject.get(&quot;request_return_exp&quot;);
vars.put(&quot;pre_request_protocol&quot;,request_protocol);
vars.put(&quot;pre_request_ip&quot;,request_ip);
vars.put(&quot;pre_request_port&quot;,request_port);
vars.put(&quot;pre_request_url&quot;,request_url);
vars.put(&quot;pre_request_body&quot;,request_body);
vars.put(&quot;pre_request_return_var&quot;,request_return_var);
vars.put(&quot;pre_request_return_exp&quot;,request_return_exp);
int request_return_num=request_return_var.split(&quot;;&quot;).length;
String request_return_match=&quot;&quot;;
String request_return_default=&quot;&quot;;
for(i=0;i&lt;request_return_num;i++){
	request_return_match+=&quot;1;&quot;;
	request_return_default+=&quot;0;&quot;;
}
vars.put(&quot;pre_match_num&quot;,request_return_match);
vars.put(&quot;pre_return_default&quot;,request_return_default);</stringProp>
                    </JSR223PreProcessor>
                    <hashTree/>
                    <JSONPostProcessor guiclass="JSONPostProcessorGui" testclass="JSONPostProcessor" testname="JSON提取器" enabled="true">
                      <stringProp name="JSONPostProcessor.referenceNames">${pre_request_return_var}</stringProp>
                      <stringProp name="JSONPostProcessor.jsonPathExprs">${pre_request_return_exp}</stringProp>
                      <stringProp name="JSONPostProcessor.match_numbers">${pre_match_num}</stringProp>
                      <stringProp name="JSONPostProcessor.defaultValues">${pre_return_default}</stringProp>
                    </JSONPostProcessor>
                    <hashTree/>
                    <ConstantTimer guiclass="ConstantTimerGui" testclass="ConstantTimer" testname="固定定时器" enabled="true">
                      <stringProp name="ConstantTimer.delay">5000</stringProp>
                    </ConstantTimer>
                    <hashTree/>
                  </hashTree>
                </hashTree>
                <IfController guiclass="IfControllerPanel" testclass="IfController" testname="POST请求" enabled="true">
                  <stringProp name="IfController.condition">&quot;${pre_request_method}&quot; == &quot;POST&quot;</stringProp>
                  <boolProp name="IfController.evaluateAll">false</boolProp>
                </IfController>
                <hashTree>
                  <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="POST前置请求" enabled="true">
                    <boolProp name="HTTPSampler.postBodyRaw">true</boolProp>
                    <elementProp name="HTTPsampler.Arguments" elementType="Arguments">
                      <collectionProp name="Arguments.arguments">
                        <elementProp name="" elementType="HTTPArgument">
                          <boolProp name="HTTPArgument.always_encode">false</boolProp>
                          <stringProp name="Argument.value">${pre_request_body}</stringProp>
                          <stringProp name="Argument.metadata">=</stringProp>
                        </elementProp>
                      </collectionProp>
                    </elementProp>
                    <stringProp name="HTTPSampler.domain">${pre_request_ip}</stringProp>
                    <stringProp name="HTTPSampler.port">${pre_request_port}</stringProp>
                    <stringProp name="HTTPSampler.protocol">${pre_request_protocol}</stringProp>
                    <stringProp name="HTTPSampler.contentEncoding">UTF-8</stringProp>
                    <stringProp name="HTTPSampler.path">${pre_request_url}</stringProp>
                    <stringProp name="HTTPSampler.method">${pre_request_method}</stringProp>
                    <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
                    <boolProp name="HTTPSampler.auto_redirects">false</boolProp>
                    <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
                    <boolProp name="HTTPSampler.DO_MULTIPART_POST">false</boolProp>
                    <stringProp name="HTTPSampler.embedded_url_re"></stringProp>
                    <stringProp name="HTTPSampler.connect_timeout"></stringProp>
                    <stringProp name="HTTPSampler.response_timeout"></stringProp>
                  </HTTPSamplerProxy>
                  <hashTree>
                    <JSR223PreProcessor guiclass="TestBeanGUI" testclass="JSR223PreProcessor" testname="JSR223 预处理程序" enabled="true">
                      <stringProp name="scriptLanguage">groovy</stringProp>
                      <stringProp name="parameters"></stringProp>
                      <stringProp name="filename"></stringProp>
                      <stringProp name="cacheKey">true</stringProp>
                      <stringProp name="script">import java.util.regex.*
import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONObject;
import com.alibaba.fastjson.serializer.SerializerFeature;
String command=vars.get(&quot;pre_request_command&quot;);
JSONObject request_resultobject = JSON.parseObject(command);
String request_protocol=request_resultobject.get(&quot;request_protocol&quot;);
String request_ip=request_resultobject.get(&quot;request_ip&quot;);
String request_port=request_resultobject.get(&quot;request_port&quot;);
String request_method=request_resultobject.get(&quot;request_method&quot;);
String request_url=request_resultobject.get(&quot;request_url&quot;);
String request_body=request_resultobject.get(&quot;request_body&quot;);
String request_return_var=request_resultobject.get(&quot;request_return_var&quot;);
String request_return_exp=request_resultobject.get(&quot;request_return_exp&quot;);
vars.put(&quot;pre_request_protocol&quot;,request_protocol);
vars.put(&quot;pre_request_ip&quot;,request_ip);
vars.put(&quot;pre_request_port&quot;,request_port);
vars.put(&quot;pre_request_url&quot;,request_url);
vars.put(&quot;pre_request_body&quot;,request_body);
vars.put(&quot;pre_request_return_var&quot;,request_return_var);
vars.put(&quot;pre_request_return_exp&quot;,request_return_exp);
int request_return_num=request_return_var.split(&quot;;&quot;).length;
String request_return_match=&quot;&quot;;
String request_return_default=&quot;&quot;;
for(i=0;i&lt;request_return_num;i++){
	request_return_match+=&quot;1;&quot;;
	request_return_default+=&quot;0;&quot;;
}
vars.put(&quot;pre_match_num&quot;,request_return_match);
vars.put(&quot;pre_return_default&quot;,request_return_default);</stringProp>
                    </JSR223PreProcessor>
                    <hashTree/>
                    <JSONPostProcessor guiclass="JSONPostProcessorGui" testclass="JSONPostProcessor" testname="JSON提取器" enabled="true">
                      <stringProp name="JSONPostProcessor.referenceNames">${pre_request_return_var}</stringProp>
                      <stringProp name="JSONPostProcessor.jsonPathExprs">${pre_request_return_exp}</stringProp>
                      <stringProp name="JSONPostProcessor.match_numbers">${pre_match_num}</stringProp>
                      <stringProp name="JSONPostProcessor.defaultValues">${pre_return_default}</stringProp>
                    </JSONPostProcessor>
                    <hashTree/>
                    <ConstantTimer guiclass="ConstantTimerGui" testclass="ConstantTimer" testname="固定定时器" enabled="true">
                      <stringProp name="ConstantTimer.delay">5000</stringProp>
                    </ConstantTimer>
                    <hashTree/>
                  </hashTree>
                </hashTree>
              </hashTree>
            </hashTree>
            <TransactionController guiclass="TransactionControllerGui" testclass="TransactionController" testname="发起请求" enabled="true">
              <boolProp name="TransactionController.includeTimers">false</boolProp>
              <boolProp name="TransactionController.parent">false</boolProp>
            </TransactionController>
            <hashTree>
              <JSR223PreProcessor guiclass="TestBeanGUI" testclass="JSR223PreProcessor" testname="JSR223 预处理程序" enabled="true">
                <stringProp name="cacheKey">true</stringProp>
                <stringProp name="filename"></stringProp>
                <stringProp name="parameters"></stringProp>
                <stringProp name="script">import web.utils.*;
import br.eti.kinoshita.testlinkjavaapi.TestLinkAPI;
import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONObject;
import com.alibaba.fastjson.parser.Feature;
import com.alibaba.fastjson.serializer.SerializerFeature;
import com.qa.util.TestlinkUtil;
import java.util.List;
import java.util.Map;
import java.util.regex.*;
import org.apache.commons.lang3.StringUtils;
//操作步骤变量替换
String exec_body=var2Str(vars.get(&quot;exec_body&quot;));
JSONObject body = JSON.parseObject(exec_body,Feature.OrderedField);
if(body.get(&quot;method&quot;) == &quot;DUBBO&quot;){
	int count = Integer.parseInt(vars.get(&quot;var_count&quot;));
	vars.put(&quot;version&quot;,body.get(&quot;version&quot;));
	vars.put(&quot;interface&quot;,body.get(&quot;interface&quot;));
	vars.put(&quot;methods&quot;,body.get(&quot;methods&quot;));
	for(int i=1;i&lt;=count;i++){
		vars.put(&quot;param_key&quot;+i,body.get(&quot;param_key&quot;+i));
		vars.put(&quot;param_value&quot;+i,body.get(&quot;param_value&quot;+i));
	}
}
vars.put(&quot;url&quot;,body.get(&quot;url&quot;).replaceAll(&quot;`&quot;,&quot;%60&quot;));
if(body.get(&quot;body&quot;)!=null){
	String request_body=JSON.toJSONString(body.get(&quot;body&quot;),SerializerFeature.WriteMapNullValue);
	vars.put(&quot;body&quot;,request_body);
}else{
	vars.put(&quot;body&quot;,&quot;&quot;);	
}

public String var2Str(String var) {
String var_name;
//用于匹配出{}内部的数
Pattern pattern =  Pattern.compile(&quot;\$*!?\\{([A-Za-z0-9_().,-]+)\\}&quot;);
Matcher matcher = pattern.matcher(var);
while(matcher.find()){
	var_name=matcher.group().replace(&quot;{&quot;,&quot;&quot;).replace(&quot;}&quot;,&quot;&quot;);
	if(vars.get(var_name)!=null){
		var=var.replace(&quot;\${&quot;+var_name+&quot;}&quot;,vars.get(var_name));
		}
}
return var;
}
</stringProp>
                <stringProp name="scriptLanguage">groovy</stringProp>
              </JSR223PreProcessor>
              <hashTree/>
              <IfController guiclass="IfControllerPanel" testclass="IfController" testname="POST请求" enabled="true">
                <stringProp name="IfController.condition">&quot;${method}&quot; == &quot;POST&quot;</stringProp>
                <boolProp name="IfController.evaluateAll">false</boolProp>
              </IfController>
              <hashTree>
                <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="POST请求发起" enabled="true">
                  <boolProp name="HTTPSampler.postBodyRaw">true</boolProp>
                  <elementProp name="HTTPsampler.Arguments" elementType="Arguments">
                    <collectionProp name="Arguments.arguments">
                      <elementProp name="" elementType="HTTPArgument">
                        <boolProp name="HTTPArgument.always_encode">false</boolProp>
                        <stringProp name="Argument.value">${body}</stringProp>
                        <stringProp name="Argument.metadata">=</stringProp>
                      </elementProp>
                    </collectionProp>
                  </elementProp>
                  <stringProp name="HTTPSampler.domain">${ip}</stringProp>
                  <stringProp name="HTTPSampler.port">${port}</stringProp>
                  <stringProp name="HTTPSampler.protocol">${protocol}</stringProp>
                  <stringProp name="HTTPSampler.contentEncoding">UTF-8</stringProp>
                  <stringProp name="HTTPSampler.path">${url}</stringProp>
                  <stringProp name="HTTPSampler.method">${method}</stringProp>
                  <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
                  <boolProp name="HTTPSampler.auto_redirects">false</boolProp>
                  <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
                  <boolProp name="HTTPSampler.DO_MULTIPART_POST">false</boolProp>
                  <stringProp name="HTTPSampler.embedded_url_re"></stringProp>
                  <stringProp name="HTTPSampler.connect_timeout"></stringProp>
                  <stringProp name="HTTPSampler.response_timeout"></stringProp>
                </HTTPSamplerProxy>
                <hashTree>
                  <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="提取返回结果" enabled="true">
                    <stringProp name="cacheKey">false</stringProp>
                    <stringProp name="filename"></stringProp>
                    <stringProp name="parameters"></stringProp>
                    <stringProp name="script">String response_result = prev.getResponseDataAsString();
vars.put(&quot;response_result&quot;,response_result);
</stringProp>
                    <stringProp name="scriptLanguage">groovy</stringProp>
                  </JSR223PostProcessor>
                  <hashTree/>
                </hashTree>
              </hashTree>
              <IfController guiclass="IfControllerPanel" testclass="IfController" testname="GET请求" enabled="true">
                <stringProp name="IfController.condition">&quot;${method}&quot; == &quot;GET&quot;</stringProp>
                <boolProp name="IfController.evaluateAll">false</boolProp>
              </IfController>
              <hashTree>
                <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="GET请求发起" enabled="true">
                  <elementProp name="HTTPsampler.Arguments" elementType="Arguments" guiclass="HTTPArgumentsPanel" testclass="Arguments" testname="用户定义的变量" enabled="true">
                    <collectionProp name="Arguments.arguments"/>
                  </elementProp>
                  <stringProp name="HTTPSampler.domain">${ip}</stringProp>
                  <stringProp name="HTTPSampler.port">${port}</stringProp>
                  <stringProp name="HTTPSampler.protocol">${protocol}</stringProp>
                  <stringProp name="HTTPSampler.contentEncoding">UTF-8</stringProp>
                  <stringProp name="HTTPSampler.path">${url}</stringProp>
                  <stringProp name="HTTPSampler.method">${method}</stringProp>
                  <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
                  <boolProp name="HTTPSampler.auto_redirects">false</boolProp>
                  <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
                  <boolProp name="HTTPSampler.DO_MULTIPART_POST">true</boolProp>
                  <boolProp name="HTTPSampler.BROWSER_COMPATIBLE_MULTIPART">true</boolProp>
                  <stringProp name="HTTPSampler.embedded_url_re"></stringProp>
                  <stringProp name="HTTPSampler.connect_timeout"></stringProp>
                  <stringProp name="HTTPSampler.response_timeout"></stringProp>
                </HTTPSamplerProxy>
                <hashTree>
                  <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="提取返回结果" enabled="true">
                    <stringProp name="cacheKey">false</stringProp>
                    <stringProp name="filename"></stringProp>
                    <stringProp name="parameters"></stringProp>
                    <stringProp name="script">String response_result = prev.getResponseDataAsString();
vars.put(&quot;response_result&quot;,response_result);</stringProp>
                    <stringProp name="scriptLanguage">groovy</stringProp>
                  </JSR223PostProcessor>
                  <hashTree/>
                  <ResponseAssertion guiclass="AssertionGui" testclass="ResponseAssertion" testname="响应断言" enabled="true">
                    <collectionProp name="Asserion.test_strings"/>
                    <stringProp name="Assertion.custom_message"></stringProp>
                    <stringProp name="Assertion.test_field">Assertion.response_headers</stringProp>
                    <boolProp name="Assertion.assume_success">true</boolProp>
                    <intProp name="Assertion.test_type">16</intProp>
                  </ResponseAssertion>
                  <hashTree/>
                </hashTree>
              </hashTree>
              <IfController guiclass="IfControllerPanel" testclass="IfController" testname="DUBBO请求" enabled="true">
                <stringProp name="IfController.condition">&quot;${method}&quot; == &quot;DUBBO&quot;</stringProp>
                <boolProp name="IfController.evaluateAll">false</boolProp>
              </IfController>
              <hashTree>
                <IfController guiclass="IfControllerPanel" testclass="IfController" testname="如果（If）控制器" enabled="true">
                  <stringProp name="IfController.condition">&quot;${var_count}&quot; == &quot;1&quot;</stringProp>
                  <boolProp name="IfController.evaluateAll">false</boolProp>
                </IfController>
                <hashTree>
                  <io.github.ningyu.jmeter.plugin.dubbo.sample.DubboSample guiclass="io.github.ningyu.jmeter.plugin.dubbo.gui.DubboSampleGui" testclass="io.github.ningyu.jmeter.plugin.dubbo.sample.DubboSample" testname="Dubbo Sample" enabled="true">
                    <stringProp name="FIELD_DUBBO_REGISTRY_PROTOCOL">zookeeper</stringProp>
                    <stringProp name="FIELD_DUBBO_REGISTRY_GROUP"></stringProp>
                    <stringProp name="FIELD_DUBBO_RPC_PROTOCOL">dubbo://</stringProp>
                    <stringProp name="FIELD_DUBBO_ADDRESS">${url}</stringProp>
                    <stringProp name="FIELD_DUBBO_TIMEOUT"></stringProp>
                    <stringProp name="FIELD_DUBBO_VERSION">${version}</stringProp>
                    <stringProp name="FIELD_DUBBO_RETRIES">0</stringProp>
                    <stringProp name="FIELD_DUBBO_GROUP"></stringProp>
                    <stringProp name="FIELD_DUBBO_CONNECTIONS">100</stringProp>
                    <stringProp name="FIELD_DUBBO_LOADBALANCE">random</stringProp>
                    <stringProp name="FIELD_DUBBO_ASYNC">sync</stringProp>
                    <stringProp name="FIELD_DUBBO_CLUSTER">failfast</stringProp>
                    <stringProp name="FIELD_DUBBO_INTERFACE">${interface}</stringProp>
                    <stringProp name="FIELD_DUBBO_METHOD">${methods}</stringProp>
                    <intProp name="FIELD_DUBBO_METHOD_ARGS_SIZE">1</intProp>
                    <stringProp name="FIELD_DUBBO_METHOD_ARGS_PARAM_TYPE1">${param_key1}</stringProp>
                    <stringProp name="FIELD_DUBBO_METHOD_ARGS_PARAM_VALUE1">${param_value1}</stringProp>
                    <stringProp name="FIELD_DUBBO_METHOD_ARGS_PARAM_TYPE2"></stringProp>
                    <stringProp name="FIELD_DUBBO_METHOD_ARGS_PARAM_VALUE2"></stringProp>
                    <stringProp name="FIELD_DUBBO_METHOD_ARGS_PARAM_TYPE3"></stringProp>
                    <stringProp name="FIELD_DUBBO_METHOD_ARGS_PARAM_VALUE3"></stringProp>
                    <stringProp name="FIELD_DUBBO_METHOD_ARGS_PARAM_TYPE4"></stringProp>
                    <stringProp name="FIELD_DUBBO_METHOD_ARGS_PARAM_VALUE4"></stringProp>
                  </io.github.ningyu.jmeter.plugin.dubbo.sample.DubboSample>
                  <hashTree>
                    <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="提取返回结果" enabled="true">
                      <stringProp name="cacheKey">false</stringProp>
                      <stringProp name="filename"></stringProp>
                      <stringProp name="parameters"></stringProp>
                      <stringProp name="script">String response_result = prev.getResponseDataAsString();
vars.put(&quot;response_result&quot;,response_result);</stringProp>
                      <stringProp name="scriptLanguage">groovy</stringProp>
                    </JSR223PostProcessor>
                    <hashTree/>
                  </hashTree>
                </hashTree>
                <IfController guiclass="IfControllerPanel" testclass="IfController" testname="如果（If）控制器" enabled="true">
                  <stringProp name="IfController.condition">&quot;${var_count}&quot; == &quot;2&quot;</stringProp>
                  <boolProp name="IfController.evaluateAll">false</boolProp>
                </IfController>
                <hashTree>
                  <io.github.ningyu.jmeter.plugin.dubbo.sample.DubboSample guiclass="io.github.ningyu.jmeter.plugin.dubbo.gui.DubboSampleGui" testclass="io.github.ningyu.jmeter.plugin.dubbo.sample.DubboSample" testname="Dubbo Sample" enabled="true">
                    <stringProp name="FIELD_DUBBO_REGISTRY_PROTOCOL">zookeeper</stringProp>
                    <stringProp name="FIELD_DUBBO_REGISTRY_GROUP"></stringProp>
                    <stringProp name="FIELD_DUBBO_RPC_PROTOCOL">dubbo://</stringProp>
                    <stringProp name="FIELD_DUBBO_ADDRESS">${url}</stringProp>
                    <stringProp name="FIELD_DUBBO_TIMEOUT"></stringProp>
                    <stringProp name="FIELD_DUBBO_VERSION">${version}</stringProp>
                    <stringProp name="FIELD_DUBBO_RETRIES">0</stringProp>
                    <stringProp name="FIELD_DUBBO_GROUP"></stringProp>
                    <stringProp name="FIELD_DUBBO_CONNECTIONS">100</stringProp>
                    <stringProp name="FIELD_DUBBO_LOADBALANCE">random</stringProp>
                    <stringProp name="FIELD_DUBBO_ASYNC">sync</stringProp>
                    <stringProp name="FIELD_DUBBO_CLUSTER">failfast</stringProp>
                    <stringProp name="FIELD_DUBBO_INTERFACE">${interface}</stringProp>
                    <stringProp name="FIELD_DUBBO_METHOD">${methods}</stringProp>
                    <intProp name="FIELD_DUBBO_METHOD_ARGS_SIZE">2</intProp>
                    <stringProp name="FIELD_DUBBO_METHOD_ARGS_PARAM_TYPE1">${param_key1}</stringProp>
                    <stringProp name="FIELD_DUBBO_METHOD_ARGS_PARAM_VALUE1">${param_value1}</stringProp>
                    <stringProp name="FIELD_DUBBO_METHOD_ARGS_PARAM_TYPE2">${param_key2}</stringProp>
                    <stringProp name="FIELD_DUBBO_METHOD_ARGS_PARAM_VALUE2">${param_value2}</stringProp>
                    <stringProp name="FIELD_DUBBO_METHOD_ARGS_PARAM_TYPE3"></stringProp>
                    <stringProp name="FIELD_DUBBO_METHOD_ARGS_PARAM_VALUE3"></stringProp>
                    <stringProp name="FIELD_DUBBO_METHOD_ARGS_PARAM_TYPE4"></stringProp>
                    <stringProp name="FIELD_DUBBO_METHOD_ARGS_PARAM_VALUE4"></stringProp>
                  </io.github.ningyu.jmeter.plugin.dubbo.sample.DubboSample>
                  <hashTree/>
                </hashTree>
                <IfController guiclass="IfControllerPanel" testclass="IfController" testname="如果（If）控制器" enabled="true">
                  <stringProp name="IfController.condition">&quot;${var_count}&quot; == &quot;3&quot;</stringProp>
                  <boolProp name="IfController.evaluateAll">false</boolProp>
                </IfController>
                <hashTree>
                  <io.github.ningyu.jmeter.plugin.dubbo.sample.DubboSample guiclass="io.github.ningyu.jmeter.plugin.dubbo.gui.DubboSampleGui" testclass="io.github.ningyu.jmeter.plugin.dubbo.sample.DubboSample" testname="Dubbo Sample" enabled="true">
                    <stringProp name="FIELD_DUBBO_REGISTRY_PROTOCOL">zookeeper</stringProp>
                    <stringProp name="FIELD_DUBBO_REGISTRY_GROUP"></stringProp>
                    <stringProp name="FIELD_DUBBO_RPC_PROTOCOL">dubbo://</stringProp>
                    <stringProp name="FIELD_DUBBO_ADDRESS">${url}</stringProp>
                    <stringProp name="FIELD_DUBBO_TIMEOUT"></stringProp>
                    <stringProp name="FIELD_DUBBO_VERSION">${version}</stringProp>
                    <stringProp name="FIELD_DUBBO_RETRIES">0</stringProp>
                    <stringProp name="FIELD_DUBBO_GROUP"></stringProp>
                    <stringProp name="FIELD_DUBBO_CONNECTIONS">100</stringProp>
                    <stringProp name="FIELD_DUBBO_LOADBALANCE">random</stringProp>
                    <stringProp name="FIELD_DUBBO_ASYNC">sync</stringProp>
                    <stringProp name="FIELD_DUBBO_CLUSTER">failfast</stringProp>
                    <stringProp name="FIELD_DUBBO_INTERFACE">${interface}</stringProp>
                    <stringProp name="FIELD_DUBBO_METHOD">${methods}</stringProp>
                    <intProp name="FIELD_DUBBO_METHOD_ARGS_SIZE">3</intProp>
                    <stringProp name="FIELD_DUBBO_METHOD_ARGS_PARAM_TYPE1">${param_key1}</stringProp>
                    <stringProp name="FIELD_DUBBO_METHOD_ARGS_PARAM_VALUE1">${param_value1}</stringProp>
                    <stringProp name="FIELD_DUBBO_METHOD_ARGS_PARAM_TYPE2">${param_key2}</stringProp>
                    <stringProp name="FIELD_DUBBO_METHOD_ARGS_PARAM_VALUE2">${param_value2}</stringProp>
                    <stringProp name="FIELD_DUBBO_METHOD_ARGS_PARAM_TYPE3">${param_key3}</stringProp>
                    <stringProp name="FIELD_DUBBO_METHOD_ARGS_PARAM_VALUE3">${param_value3}</stringProp>
                    <stringProp name="FIELD_DUBBO_METHOD_ARGS_PARAM_TYPE4"></stringProp>
                    <stringProp name="FIELD_DUBBO_METHOD_ARGS_PARAM_VALUE4"></stringProp>
                  </io.github.ningyu.jmeter.plugin.dubbo.sample.DubboSample>
                  <hashTree/>
                </hashTree>
                <IfController guiclass="IfControllerPanel" testclass="IfController" testname="如果（If）控制器" enabled="true">
                  <stringProp name="IfController.condition">&quot;${var_count}&quot; == &quot;4&quot;</stringProp>
                  <boolProp name="IfController.evaluateAll">false</boolProp>
                </IfController>
                <hashTree>
                  <io.github.ningyu.jmeter.plugin.dubbo.sample.DubboSample guiclass="io.github.ningyu.jmeter.plugin.dubbo.gui.DubboSampleGui" testclass="io.github.ningyu.jmeter.plugin.dubbo.sample.DubboSample" testname="Dubbo Sample" enabled="true">
                    <stringProp name="FIELD_DUBBO_REGISTRY_PROTOCOL">zookeeper</stringProp>
                    <stringProp name="FIELD_DUBBO_REGISTRY_GROUP"></stringProp>
                    <stringProp name="FIELD_DUBBO_RPC_PROTOCOL">dubbo://</stringProp>
                    <stringProp name="FIELD_DUBBO_ADDRESS">${url}</stringProp>
                    <stringProp name="FIELD_DUBBO_TIMEOUT"></stringProp>
                    <stringProp name="FIELD_DUBBO_VERSION">${version}</stringProp>
                    <stringProp name="FIELD_DUBBO_RETRIES">0</stringProp>
                    <stringProp name="FIELD_DUBBO_GROUP"></stringProp>
                    <stringProp name="FIELD_DUBBO_CONNECTIONS">100</stringProp>
                    <stringProp name="FIELD_DUBBO_LOADBALANCE">random</stringProp>
                    <stringProp name="FIELD_DUBBO_ASYNC">sync</stringProp>
                    <stringProp name="FIELD_DUBBO_CLUSTER">failfast</stringProp>
                    <stringProp name="FIELD_DUBBO_INTERFACE">${interface}</stringProp>
                    <stringProp name="FIELD_DUBBO_METHOD">${methods}</stringProp>
                    <intProp name="FIELD_DUBBO_METHOD_ARGS_SIZE">4</intProp>
                    <stringProp name="FIELD_DUBBO_METHOD_ARGS_PARAM_TYPE1">${param_key1}</stringProp>
                    <stringProp name="FIELD_DUBBO_METHOD_ARGS_PARAM_VALUE1">${param_value1}</stringProp>
                    <stringProp name="FIELD_DUBBO_METHOD_ARGS_PARAM_TYPE2">${param_key2}</stringProp>
                    <stringProp name="FIELD_DUBBO_METHOD_ARGS_PARAM_VALUE2">${param_value2}</stringProp>
                    <stringProp name="FIELD_DUBBO_METHOD_ARGS_PARAM_TYPE3">${param_key3}</stringProp>
                    <stringProp name="FIELD_DUBBO_METHOD_ARGS_PARAM_VALUE3">${param_value3}</stringProp>
                    <stringProp name="FIELD_DUBBO_METHOD_ARGS_PARAM_TYPE4">${param_key4}</stringProp>
                    <stringProp name="FIELD_DUBBO_METHOD_ARGS_PARAM_VALUE4">${param_value4}</stringProp>
                  </io.github.ningyu.jmeter.plugin.dubbo.sample.DubboSample>
                  <hashTree/>
                </hashTree>
              </hashTree>
            </hashTree>
            <TransactionController guiclass="TransactionControllerGui" testclass="TransactionController" testname="执行断言" enabled="true">
              <boolProp name="TransactionController.includeTimers">false</boolProp>
              <boolProp name="TransactionController.parent">false</boolProp>
            </TransactionController>
            <hashTree>
              <JSR223PreProcessor guiclass="TestBeanGUI" testclass="JSR223PreProcessor" testname="JSR223 预处理程序" enabled="true">
                <stringProp name="scriptLanguage">groovy</stringProp>
                <stringProp name="parameters"></stringProp>
                <stringProp name="filename"></stringProp>
                <stringProp name="cacheKey">true</stringProp>
                <stringProp name="script">import web.utils.*;
import br.eti.kinoshita.testlinkjavaapi.TestLinkAPI;
import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONObject;
import com.alibaba.fastjson.parser.Feature;
import com.alibaba.fastjson.serializer.SerializerFeature;
import com.qa.util.TestlinkUtil;
import java.util.List;
import java.util.Map;
import java.util.regex.*;
import org.apache.commons.lang3.StringUtils;

//
String expect_result=var2Str(vars.get(&quot;expect_result&quot;));
JSONObject expect_obj = JSON.parseObject(expect_result,Feature.OrderedField);

//保留null属性

//做一个标记，判断是否比对过了
if(!vars.get(&quot;response_expect_result&quot;).equals(&quot;测试完成&quot;)){
	String response_expect_result = JSON.toJSONString(expect_obj.get(&quot;response_result&quot;),SerializerFeature.WriteMapNullValue);
	vars.put(&quot;response_field&quot;,expect_obj.get(&quot;response_field&quot;)+&quot;&quot;);
	if(isJSON(response_expect_result)){
		vars.put(&quot;response_expect_result&quot;,response_expect_result);
	}else{
		vars.put(&quot;response_expect_result&quot;,expect_obj.get(&quot;response_result&quot;)+&quot;&quot;);
	}
}
if(!vars.get(&quot;mysql_expect_result&quot;).equals(&quot;测试完成&quot;)){
	vars.put(&quot;mysql_expect_result&quot;,expect_obj.get(&quot;mysql_result&quot;)+&quot;&quot;);
}
if(!vars.get(&quot;ES_expect_result&quot;).equals(&quot;测试完成&quot;)){
	vars.put(&quot;ES_expect_result&quot;,expect_obj.get(&quot;ES_result&quot;)+&quot;&quot;);
}
if(!vars.get(&quot;mongodb_expect_result&quot;).equals(&quot;测试完成&quot;)){
	vars.put(&quot;mongodb_expect_result&quot;,expect_obj.get(&quot;mongodb_result&quot;)+&quot;&quot;);
}
if(!vars.get(&quot;redis_expect_result&quot;).equals(&quot;测试完成&quot;)){
	vars.put(&quot;redis_expect_result&quot;,expect_obj.get(&quot;redis_result&quot;)+&quot;&quot;);
}
if(!vars.get(&quot;request_expect_result&quot;).equals(&quot;测试完成&quot;)){
//	最终的校验值,如果request_result预期结果为json串且json中有字段的值为null，那get(&quot;request_result&quot;)不会获得到这个null的部分字符串，所以这种情况预期结果需要设置为字符串而不是json
	String request_result=expect_obj.get(&quot;request_result&quot;).toString()
	vars.put(&quot;request_expect_result&quot;,request_result);
}

vars.put(&quot;mysql_result_command&quot;,expect_obj.get(&quot;mysql&quot;)+&quot;&quot;);
vars.put(&quot;ES_result_command&quot;,expect_obj.get(&quot;ES&quot;)+&quot;&quot;);
vars.put(&quot;mongodb_result_command&quot;,expect_obj.get(&quot;mongodb&quot;)+&quot;&quot;);
vars.put(&quot;redis_result_command&quot;,expect_obj.get(&quot;redis&quot;)+&quot;&quot;);
String request_String=expect_obj.get(&quot;request&quot;).toString();
vars.put(&quot;request_result_command&quot;,request_String);


//断言前做好请求类型判断
if(expect_obj.get(&quot;request&quot;)!=null&amp;&amp;!expect_obj.get(&quot;request&quot;).equals(&quot;&quot;)){
	JSONObject request_resultobject = JSON.parseObject(request_String);
	vars.put(&quot;request_method&quot;,request_resultobject.get(&quot;request_method&quot;));
}
public String var2Str(String var) {
String var_name;
//用于匹配出{}内部的数
Pattern pattern =  Pattern.compile(&quot;\$*!?\\{([A-Za-z0-9_().,-]+)\\}&quot;);
Matcher matcher = pattern.matcher(var);
while(matcher.find()){
	var_name=matcher.group().replace(&quot;{&quot;,&quot;&quot;).replace(&quot;}&quot;,&quot;&quot;);
	if(vars.get(var_name)!=null){
		var=var.replace(&quot;\${&quot;+var_name+&quot;}&quot;,vars.get(var_name));
		}
}
return var;
}
public static boolean isJSON(String str) {
    boolean result = false;
    if (StringUtils.isNotBlank(str)) {
        str = str.trim();
        if (str.startsWith(&quot;{&quot;) &amp;&amp; str.endsWith(&quot;}&quot;)) {
            result = true;
        } else if (str.startsWith(&quot;[&quot;) &amp;&amp; str.endsWith(&quot;]&quot;)) {
            result = true;
        }
    }
    return result;
}
</stringProp>
              </JSR223PreProcessor>
              <hashTree/>
              <IfController guiclass="IfControllerPanel" testclass="IfController" testname="ES断言" enabled="true">
                <stringProp name="IfController.condition">${__jexl3(vars.get(&quot;ES_expect_result&quot;) != &quot;null&quot; )}</stringProp>
                <boolProp name="IfController.evaluateAll">false</boolProp>
                <boolProp name="IfController.useExpression">true</boolProp>
              </IfController>
              <hashTree>
                <org.apache.jmeter.protocol.ssh.sampler.SSHCommandSampler guiclass="TestBeanGUI" testclass="org.apache.jmeter.protocol.ssh.sampler.SSHCommandSampler" testname="ES断言" enabled="true">
                  <stringProp name="command">${ES_result_command}</stringProp>
                  <intProp name="connectionTimeout">50000</intProp>
                  <stringProp name="hostname">${mysqlIp}</stringProp>
                  <stringProp name="passphrase"></stringProp>
                  <stringProp name="password">${mysqlpasswd}</stringProp>
                  <intProp name="port">22</intProp>
                  <boolProp name="printStdErr">true</boolProp>
                  <stringProp name="sshkeyfile"></stringProp>
                  <boolProp name="useReturnCode">true</boolProp>
                  <stringProp name="username">root</stringProp>
                </org.apache.jmeter.protocol.ssh.sampler.SSHCommandSampler>
                <hashTree>
                  <BeanShellPostProcessor guiclass="TestBeanGUI" testclass="BeanShellPostProcessor" testname="BeanShell 后置处理程序" enabled="true">
                    <boolProp name="resetInterpreter">false</boolProp>
                    <stringProp name="parameters"></stringProp>
                    <stringProp name="filename"></stringProp>
                    <stringProp name="script">import org.json.*;
String response_data = prev.getResponseDataAsString();
String text1=response_data.replace(&quot;=== stdin ===&quot;,&quot;&quot;);
String text2=text1.split(&quot;=== stderr ===&quot;)[0].trim();
vars.put(&quot;ES_result&quot;,text2);</stringProp>
                  </BeanShellPostProcessor>
                  <hashTree/>
                </hashTree>
              </hashTree>
              <IfController guiclass="IfControllerPanel" testclass="IfController" testname="mysql断言" enabled="true">
                <stringProp name="IfController.condition">${__jexl3(vars.get(&quot;mysql_expect_result&quot;) != &quot;null&quot; )}</stringProp>
                <boolProp name="IfController.evaluateAll">false</boolProp>
                <boolProp name="IfController.useExpression">true</boolProp>
              </IfController>
              <hashTree>
                <IfController guiclass="IfControllerPanel" testclass="IfController" testname="10.1.61.11databank测试" enabled="true">
                  <stringProp name="IfController.condition">&quot;${mysqlIp}&quot; == &quot;10.1.61.11&quot; &amp;&amp;&quot;${caseName}&quot;.contains(&quot;datamap&quot;)</stringProp>
                  <boolProp name="IfController.evaluateAll">false</boolProp>
                </IfController>
                <hashTree>
                  <JDBCSampler guiclass="TestBeanGUI" testclass="JDBCSampler" testname="mysql断言" enabled="true">
                    <stringProp name="dataSource">mysql_databankdatamap_6111</stringProp>
                    <stringProp name="query">${mysql_result_command}</stringProp>
                    <stringProp name="queryArguments"></stringProp>
                    <stringProp name="queryArgumentsTypes"></stringProp>
                    <stringProp name="queryTimeout"></stringProp>
                    <stringProp name="queryType">Callable Statement</stringProp>
                    <stringProp name="resultSetHandler">Count Records</stringProp>
                    <stringProp name="resultVariable"></stringProp>
                    <stringProp name="variableNames">result_count</stringProp>
                  </JDBCSampler>
                  <hashTree>
                    <RegexExtractor guiclass="RegexExtractorGui" testclass="RegexExtractor" testname="正则表达式提取器" enabled="true">
                      <stringProp name="RegexExtractor.useHeaders">false</stringProp>
                      <stringProp name="RegexExtractor.refname">vars</stringProp>
                      <stringProp name="RegexExtractor.regex">@(.+?)\n(.*)</stringProp>
                      <stringProp name="RegexExtractor.template">$1$$2$</stringProp>
                      <stringProp name="RegexExtractor.default"></stringProp>
                      <stringProp name="RegexExtractor.match_number">-1</stringProp>
                    </RegexExtractor>
                    <hashTree/>
                    <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="JSR223 后置处理程序" enabled="true">
                      <stringProp name="scriptLanguage">groovy</stringProp>
                      <stringProp name="parameters"></stringProp>
                      <stringProp name="filename"></stringProp>
                      <stringProp name="cacheKey">false</stringProp>
                      <stringProp name="script">import java.util.regex.*
String response_data = prev.getResponseDataAsString();
String  mysql_result=response_data.replace(&quot;count(1)&quot;,&quot;&quot;).replace(&quot;Output variables by position:&quot;,&quot;&quot;).replaceAll(&quot;(.*updates.)+&quot;,&quot;&quot;).replace(&quot;\n&quot;,&quot;&quot;).replaceAll(&quot;@.*&quot;,&quot;&quot;).trim();
vars.put(&quot;mysql_result&quot;,mysql_result);
for(int i=1;i&lt;=1;i++){ 
	vars.putObject(vars.get(&quot;vars_${i}_g1&quot;),vars.get(&quot;vars_${i}_g2&quot;));
}</stringProp>
                    </JSR223PostProcessor>
                    <hashTree/>
                  </hashTree>
                </hashTree>
                <IfController guiclass="IfControllerPanel" testclass="IfController" testname="10.1.61.11metadata接口测试" enabled="true">
                  <stringProp name="IfController.condition">&quot;${mysqlIp}&quot; == &quot;10.1.61.11&quot; &amp;&amp;&quot;${caseName}&quot;.contains(&quot;metadata&quot;)</stringProp>
                  <boolProp name="IfController.evaluateAll">false</boolProp>
                </IfController>
                <hashTree>
                  <JDBCSampler guiclass="TestBeanGUI" testclass="JDBCSampler" testname="mysql断言" enabled="true">
                    <stringProp name="dataSource">mysql_databankmetadata_6111</stringProp>
                    <stringProp name="query">${mysql_result_command}</stringProp>
                    <stringProp name="queryArguments"></stringProp>
                    <stringProp name="queryArgumentsTypes"></stringProp>
                    <stringProp name="queryTimeout"></stringProp>
                    <stringProp name="queryType">Callable Statement</stringProp>
                    <stringProp name="resultSetHandler">Store as String</stringProp>
                    <stringProp name="resultVariable"></stringProp>
                    <stringProp name="variableNames">result_count</stringProp>
                  </JDBCSampler>
                  <hashTree>
                    <RegexExtractor guiclass="RegexExtractorGui" testclass="RegexExtractor" testname="正则表达式提取器" enabled="true">
                      <stringProp name="RegexExtractor.useHeaders">false</stringProp>
                      <stringProp name="RegexExtractor.refname">vars</stringProp>
                      <stringProp name="RegexExtractor.regex">@(.+?)\n(.*)</stringProp>
                      <stringProp name="RegexExtractor.template">$1$$2$</stringProp>
                      <stringProp name="RegexExtractor.default"></stringProp>
                      <stringProp name="RegexExtractor.match_number">-1</stringProp>
                    </RegexExtractor>
                    <hashTree/>
                    <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="JSR223 后置处理程序" enabled="true">
                      <stringProp name="scriptLanguage">groovy</stringProp>
                      <stringProp name="parameters"></stringProp>
                      <stringProp name="filename"></stringProp>
                      <stringProp name="cacheKey">false</stringProp>
                      <stringProp name="script">import java.util.regex.*
String response_data = prev.getResponseDataAsString();
String  mysql_result=response_data.replace(&quot;count(1)&quot;,&quot;&quot;).replace(&quot;Output variables by position:&quot;,&quot;&quot;).replaceAll(&quot;(.*updates.)+&quot;,&quot;&quot;).replace(&quot;\n&quot;,&quot;&quot;).replaceAll(&quot;@.*&quot;,&quot;&quot;).trim();
vars.put(&quot;mysql_result&quot;,mysql_result);
for(int i=1;i&lt;=1;i++){ 
	vars.putObject(vars.get(&quot;vars_${i}_g1&quot;),vars.get(&quot;vars_${i}_g2&quot;));
}</stringProp>
                    </JSR223PostProcessor>
                    <hashTree/>
                  </hashTree>
                </hashTree>
                <IfController guiclass="IfControllerPanel" testclass="IfController" testname="10.1.56.159databank-datamap测试" enabled="true">
                  <stringProp name="IfController.condition">&quot;${mysqlIp}&quot; == &quot;10.1.56.159&quot; &amp;&amp;&quot;${caseName}&quot;.contains(&quot;datamap&quot;)</stringProp>
                  <boolProp name="IfController.evaluateAll">false</boolProp>
                </IfController>
                <hashTree>
                  <JDBCSampler guiclass="TestBeanGUI" testclass="JDBCSampler" testname="mysql断言" enabled="true">
                    <stringProp name="dataSource">mysql_databankdatamap_56.159</stringProp>
                    <stringProp name="query">${mysql_result_command}</stringProp>
                    <stringProp name="queryArguments"></stringProp>
                    <stringProp name="queryArgumentsTypes"></stringProp>
                    <stringProp name="queryTimeout"></stringProp>
                    <stringProp name="queryType">Callable Statement</stringProp>
                    <stringProp name="resultSetHandler">Store as String</stringProp>
                    <stringProp name="resultVariable"></stringProp>
                    <stringProp name="variableNames">result_count</stringProp>
                  </JDBCSampler>
                  <hashTree>
                    <RegexExtractor guiclass="RegexExtractorGui" testclass="RegexExtractor" testname="正则表达式提取器" enabled="true">
                      <stringProp name="RegexExtractor.useHeaders">false</stringProp>
                      <stringProp name="RegexExtractor.refname">vars</stringProp>
                      <stringProp name="RegexExtractor.regex">@(.+?)\n(.*)</stringProp>
                      <stringProp name="RegexExtractor.template">$1$$2$</stringProp>
                      <stringProp name="RegexExtractor.default"></stringProp>
                      <stringProp name="RegexExtractor.match_number">-1</stringProp>
                    </RegexExtractor>
                    <hashTree/>
                    <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="JSR223 后置处理程序" enabled="true">
                      <stringProp name="scriptLanguage">groovy</stringProp>
                      <stringProp name="parameters"></stringProp>
                      <stringProp name="filename"></stringProp>
                      <stringProp name="cacheKey">false</stringProp>
                      <stringProp name="script">import java.util.regex.*
String response_data = prev.getResponseDataAsString();
String  mysql_result=response_data.replace(&quot;count(1)&quot;,&quot;&quot;).replace(&quot;Output variables by position:&quot;,&quot;&quot;).replaceAll(&quot;(.*updates.)+&quot;,&quot;&quot;).replace(&quot;\n&quot;,&quot;&quot;).replaceAll(&quot;@.*&quot;,&quot;&quot;).trim();
vars.put(&quot;mysql_result&quot;,mysql_result);

for(int i=1;i&lt;=1;i++){ 
	vars.putObject(vars.get(&quot;vars_${i}_g1&quot;),vars.get(&quot;vars_${i}_g2&quot;));
}</stringProp>
                    </JSR223PostProcessor>
                    <hashTree/>
                  </hashTree>
                </hashTree>
                <IfController guiclass="IfControllerPanel" testclass="IfController" testname="10.1.56.159metadata接口测试" enabled="true">
                  <stringProp name="IfController.condition">&quot;${mysqlIp}&quot; == &quot;10.1.56.159&quot; &amp;&amp;&quot;${caseName}&quot;.contains(&quot;metadata&quot;)</stringProp>
                  <boolProp name="IfController.evaluateAll">false</boolProp>
                </IfController>
                <hashTree>
                  <JDBCSampler guiclass="TestBeanGUI" testclass="JDBCSampler" testname="mysql断言" enabled="true">
                    <stringProp name="dataSource">mysql_databankmetadata_56.159</stringProp>
                    <stringProp name="query">${mysql_result_command}</stringProp>
                    <stringProp name="queryArguments"></stringProp>
                    <stringProp name="queryArgumentsTypes"></stringProp>
                    <stringProp name="queryTimeout"></stringProp>
                    <stringProp name="queryType">Callable Statement</stringProp>
                    <stringProp name="resultSetHandler">Count Records</stringProp>
                    <stringProp name="resultVariable"></stringProp>
                    <stringProp name="variableNames">result_count</stringProp>
                  </JDBCSampler>
                  <hashTree>
                    <RegexExtractor guiclass="RegexExtractorGui" testclass="RegexExtractor" testname="正则表达式提取器" enabled="true">
                      <stringProp name="RegexExtractor.useHeaders">false</stringProp>
                      <stringProp name="RegexExtractor.refname">vars</stringProp>
                      <stringProp name="RegexExtractor.regex">@(.+?)\n(.*)</stringProp>
                      <stringProp name="RegexExtractor.template">$1$$2$</stringProp>
                      <stringProp name="RegexExtractor.default"></stringProp>
                      <stringProp name="RegexExtractor.match_number">-1</stringProp>
                    </RegexExtractor>
                    <hashTree/>
                    <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="JSR223 后置处理程序" enabled="true">
                      <stringProp name="scriptLanguage">groovy</stringProp>
                      <stringProp name="parameters"></stringProp>
                      <stringProp name="filename"></stringProp>
                      <stringProp name="cacheKey">false</stringProp>
                      <stringProp name="script">import java.util.regex.*
String response_data = prev.getResponseDataAsString();
String  mysql_result=response_data.replace(&quot;count(1)&quot;,&quot;&quot;).replace(&quot;Output variables by position:&quot;,&quot;&quot;).replaceAll(&quot;(.*updates.)+&quot;,&quot;&quot;).replace(&quot;\n&quot;,&quot;&quot;).replaceAll(&quot;@.*&quot;,&quot;&quot;).trim();
vars.put(&quot;mysql_result&quot;,mysql_result);
for(int i=1;i&lt;=1;i++){ 
	vars.putObject(vars.get(&quot;vars_${i}_g1&quot;),vars.get(&quot;vars_${i}_g2&quot;));
}</stringProp>
                    </JSR223PostProcessor>
                    <hashTree/>
                  </hashTree>
                </hashTree>
                <IfController guiclass="IfControllerPanel" testclass="IfController" testname="10.1.40.81databank-datamap测试" enabled="true">
                  <stringProp name="IfController.condition">&quot;${mysqlIp}&quot; == &quot;10.1.40.81&quot; &amp;&amp; (&quot;${caseName}&quot;.contains(&quot;datamap&quot;) ||&quot;${caseName}&quot;.contains(&quot;openapi&quot;))</stringProp>
                  <boolProp name="IfController.evaluateAll">false</boolProp>
                </IfController>
                <hashTree>
                  <JDBCSampler guiclass="TestBeanGUI" testclass="JDBCSampler" testname="mysql断言" enabled="true">
                    <stringProp name="dataSource">mysql_databankdatamap_4081</stringProp>
                    <stringProp name="query">${mysql_result_command}</stringProp>
                    <stringProp name="queryArguments"></stringProp>
                    <stringProp name="queryArgumentsTypes"></stringProp>
                    <stringProp name="queryTimeout"></stringProp>
                    <stringProp name="queryType">Callable Statement</stringProp>
                    <stringProp name="resultSetHandler">Store as String</stringProp>
                    <stringProp name="resultVariable"></stringProp>
                    <stringProp name="variableNames">result_count</stringProp>
                  </JDBCSampler>
                  <hashTree>
                    <RegexExtractor guiclass="RegexExtractorGui" testclass="RegexExtractor" testname="正则表达式提取器" enabled="true">
                      <stringProp name="RegexExtractor.useHeaders">false</stringProp>
                      <stringProp name="RegexExtractor.refname">vars</stringProp>
                      <stringProp name="RegexExtractor.regex">@(.+?)\n(.*)</stringProp>
                      <stringProp name="RegexExtractor.template">$1$$2$</stringProp>
                      <stringProp name="RegexExtractor.default"></stringProp>
                      <stringProp name="RegexExtractor.match_number">-1</stringProp>
                    </RegexExtractor>
                    <hashTree/>
                    <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="JSR223 后置处理程序" enabled="true">
                      <stringProp name="scriptLanguage">groovy</stringProp>
                      <stringProp name="parameters"></stringProp>
                      <stringProp name="filename"></stringProp>
                      <stringProp name="cacheKey">false</stringProp>
                      <stringProp name="script">import java.util.regex.*
String response_data = prev.getResponseDataAsString();
String  mysql_result=response_data.replace(&quot;count(1)&quot;,&quot;&quot;).replace(&quot;Output variables by position:&quot;,&quot;&quot;).replaceAll(&quot;(.*updates.)+&quot;,&quot;&quot;).replace(&quot;\n&quot;,&quot;&quot;).replaceAll(&quot;@.*&quot;,&quot;&quot;).trim();
vars.put(&quot;mysql_result&quot;,mysql_result);

for(int i=1;i&lt;=1;i++){ 
	vars.putObject(vars.get(&quot;vars_${i}_g1&quot;),vars.get(&quot;vars_${i}_g2&quot;));
}</stringProp>
                    </JSR223PostProcessor>
                    <hashTree/>
                  </hashTree>
                </hashTree>
                <IfController guiclass="IfControllerPanel" testclass="IfController" testname="10.1.40.81metadata接口测试" enabled="true">
                  <stringProp name="IfController.condition">&quot;${mysqlIp}&quot; == &quot;10.1.40.81&quot; &amp;&amp;&quot;${caseName}&quot;.contains(&quot;metadata&quot;)</stringProp>
                  <boolProp name="IfController.evaluateAll">false</boolProp>
                </IfController>
                <hashTree>
                  <JDBCSampler guiclass="TestBeanGUI" testclass="JDBCSampler" testname="mysql断言" enabled="true">
                    <stringProp name="dataSource">mysql_databankmetadata_4081</stringProp>
                    <stringProp name="query">${mysql_result_command}</stringProp>
                    <stringProp name="queryArguments"></stringProp>
                    <stringProp name="queryArgumentsTypes"></stringProp>
                    <stringProp name="queryTimeout"></stringProp>
                    <stringProp name="queryType">Callable Statement</stringProp>
                    <stringProp name="resultSetHandler">Count Records</stringProp>
                    <stringProp name="resultVariable"></stringProp>
                    <stringProp name="variableNames">result_count</stringProp>
                  </JDBCSampler>
                  <hashTree>
                    <RegexExtractor guiclass="RegexExtractorGui" testclass="RegexExtractor" testname="正则表达式提取器" enabled="true">
                      <stringProp name="RegexExtractor.useHeaders">false</stringProp>
                      <stringProp name="RegexExtractor.refname">vars</stringProp>
                      <stringProp name="RegexExtractor.regex">@(.+?)\n(.*)</stringProp>
                      <stringProp name="RegexExtractor.template">$1$$2$</stringProp>
                      <stringProp name="RegexExtractor.default"></stringProp>
                      <stringProp name="RegexExtractor.match_number">-1</stringProp>
                    </RegexExtractor>
                    <hashTree/>
                    <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="JSR223 后置处理程序" enabled="true">
                      <stringProp name="scriptLanguage">groovy</stringProp>
                      <stringProp name="parameters"></stringProp>
                      <stringProp name="filename"></stringProp>
                      <stringProp name="cacheKey">false</stringProp>
                      <stringProp name="script">import java.util.regex.*
String response_data = prev.getResponseDataAsString();
String  mysql_result=response_data.replace(&quot;count(1)&quot;,&quot;&quot;).replace(&quot;Output variables by position:&quot;,&quot;&quot;).replaceAll(&quot;(.*updates.)+&quot;,&quot;&quot;).replace(&quot;\n&quot;,&quot;&quot;).replaceAll(&quot;@.*&quot;,&quot;&quot;).trim();
vars.put(&quot;mysql_result&quot;,mysql_result);
for(int i=1;i&lt;=1;i++){ 
	vars.putObject(vars.get(&quot;vars_${i}_g1&quot;),vars.get(&quot;vars_${i}_g2&quot;));
}</stringProp>
                    </JSR223PostProcessor>
                    <hashTree/>
                  </hashTree>
                </hashTree>
              </hashTree>
              <IfController guiclass="IfControllerPanel" testclass="IfController" testname="mongodb断言" enabled="true">
                <stringProp name="IfController.condition">${__jexl3(vars.get(&quot;mongodb_expect_result&quot;) != &quot;null&quot; )}</stringProp>
                <boolProp name="IfController.evaluateAll">false</boolProp>
                <boolProp name="IfController.useExpression">true</boolProp>
              </IfController>
              <hashTree>
                <JSR223Sampler guiclass="TestBeanGUI" testclass="JSR223Sampler" testname="mongodb断言" enabled="true">
                  <stringProp name="scriptLanguage">groovy</stringProp>
                  <stringProp name="parameters"></stringProp>
                  <stringProp name="filename"></stringProp>
                  <stringProp name="cacheKey">false</stringProp>
                  <stringProp name="script">import com.mongodb.client.MongoClients;
import com.mongodb.client.MongoClient;
import com.mongodb.client.MongoCollection;
import com.mongodb.client.MongoDatabase;
import static com.mongodb.client.model.Filters.*;
import org.bson.Document;
import java.util.Arrays;
import com.mongodb.client.FindIterable;
import com.mongodb.client.MongoCursor;
${mongodb_result_command}</stringProp>
                </JSR223Sampler>
                <hashTree>
                  <BeanShellPostProcessor guiclass="TestBeanGUI" testclass="BeanShellPostProcessor" testname="BeanShell 后置处理程序" enabled="true">
                    <boolProp name="resetInterpreter">false</boolProp>
                    <stringProp name="parameters"></stringProp>
                    <stringProp name="filename"></stringProp>
                    <stringProp name="script">String response_data = prev.getResponseDataAsString();
vars.putObject(&quot;mongodb_result&quot;,response_data);</stringProp>
                  </BeanShellPostProcessor>
                  <hashTree/>
                </hashTree>
              </hashTree>
              <IfController guiclass="IfControllerPanel" testclass="IfController" testname="redis断言" enabled="true">
                <stringProp name="IfController.condition">${__jexl3(vars.get(&quot;redis_expect_result&quot;) != &quot;null&quot; )}</stringProp>
                <boolProp name="IfController.evaluateAll">false</boolProp>
                <boolProp name="IfController.useExpression">true</boolProp>
              </IfController>
              <hashTree>
                <JSR223Sampler guiclass="TestBeanGUI" testclass="JSR223Sampler" testname="redis断言" enabled="true">
                  <stringProp name="scriptLanguage">groovy</stringProp>
                  <stringProp name="parameters"></stringProp>
                  <stringProp name="filename"></stringProp>
                  <stringProp name="cacheKey">false</stringProp>
                  <stringProp name="script">${redis_result_command}</stringProp>
                </JSR223Sampler>
                <hashTree>
                  <BeanShellPostProcessor guiclass="TestBeanGUI" testclass="BeanShellPostProcessor" testname="BeanShell 后置处理程序" enabled="true">
                    <boolProp name="resetInterpreter">false</boolProp>
                    <stringProp name="parameters"></stringProp>
                    <stringProp name="filename"></stringProp>
                    <stringProp name="script">String response_data = prev.getResponseDataAsString();
vars.putObject(&quot;redis_result&quot;,response_data);</stringProp>
                  </BeanShellPostProcessor>
                  <hashTree/>
                </hashTree>
              </hashTree>
              <IfController guiclass="IfControllerPanel" testclass="IfController" testname="response断言" enabled="true">
                <stringProp name="IfController.condition">${__jexl3(vars.get(&quot;response_expect_result&quot;) != null &amp;&amp; vars.get(&quot;response_expect_result&quot;) != &quot;null&quot; )}</stringProp>
                <boolProp name="IfController.evaluateAll">false</boolProp>
                <boolProp name="IfController.useExpression">true</boolProp>
              </IfController>
              <hashTree>
                <JSR223Sampler guiclass="TestBeanGUI" testclass="JSR223Sampler" testname="response断言" enabled="true">
                  <stringProp name="scriptLanguage">groovy</stringProp>
                  <stringProp name="parameters"></stringProp>
                  <stringProp name="filename"></stringProp>
                  <stringProp name="cacheKey">false</stringProp>
                  <stringProp name="script">import java.util.List;
import java.util.Map;
import java.util.regex.*;
import org.apache.commons.lang3.StringUtils;
String count=&quot;&quot;;
String response_result= vars.get(&quot;response_result&quot;);
response_result=response_result.replaceAll(&quot;\\s+&quot;,&quot;&quot;);
if(vars.get(&quot;response_field&quot;)!=&quot;null&quot;){
	String response_field=vars.get(&quot;response_field&quot;);
	String[] field_arr=response_field.split(&quot;,&quot;)
	for(int i=0;i&lt;field_arr.length;i++){
		response_field=field_arr[i];
		count+=sumCount(response_result,response_field)+&quot;,&quot;;
	}
	count=count.substring(0,count.length()-1);
	vars.put(&quot;response_result&quot;,count);
}else{
	vars.put(&quot;response_result&quot;,response_result);
}
public String sumCount(String response_result,String response_field) {
        int num = 0;
        while (response_result.contains(response_field)) {
            response_result = response_result.substring(response_result.indexOf(response_field) + response_field.length());
            num ++;
        }
        return num+&quot;&quot;;
    }

</stringProp>
                </JSR223Sampler>
                <hashTree/>
              </hashTree>
              <IfController guiclass="IfControllerPanel" testclass="IfController" testname="request断言" enabled="true">
                <stringProp name="IfController.condition">${__jexl3(vars.get(&quot;request_expect_result&quot;) != &quot;null&quot; )}</stringProp>
                <boolProp name="IfController.evaluateAll">false</boolProp>
                <boolProp name="IfController.useExpression">true</boolProp>
              </IfController>
              <hashTree>
                <IfController guiclass="IfControllerPanel" testclass="IfController" testname="GET请求" enabled="true">
                  <stringProp name="IfController.condition">&quot;${request_method}&quot; == &quot;GET&quot;</stringProp>
                  <boolProp name="IfController.evaluateAll">false</boolProp>
                </IfController>
                <hashTree>
                  <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="request断言" enabled="true">
                    <elementProp name="HTTPsampler.Arguments" elementType="Arguments" guiclass="HTTPArgumentsPanel" testclass="Arguments" testname="用户定义的变量" enabled="true">
                      <collectionProp name="Arguments.arguments"/>
                    </elementProp>
                    <stringProp name="HTTPSampler.domain">${request_ip}</stringProp>
                    <stringProp name="HTTPSampler.port">${request_port}</stringProp>
                    <stringProp name="HTTPSampler.protocol">${request_protocol}</stringProp>
                    <stringProp name="HTTPSampler.contentEncoding">UTF-8</stringProp>
                    <stringProp name="HTTPSampler.path">${request_url}</stringProp>
                    <stringProp name="HTTPSampler.method">${request_method}</stringProp>
                    <boolProp name="HTTPSampler.follow_redirects">false</boolProp>
                    <boolProp name="HTTPSampler.auto_redirects">false</boolProp>
                    <boolProp name="HTTPSampler.use_keepalive">false</boolProp>
                    <boolProp name="HTTPSampler.DO_MULTIPART_POST">false</boolProp>
                    <stringProp name="HTTPSampler.embedded_url_re"></stringProp>
                    <stringProp name="HTTPSampler.connect_timeout"></stringProp>
                    <stringProp name="HTTPSampler.response_timeout"></stringProp>
                  </HTTPSamplerProxy>
                  <hashTree>
                    <JSR223PreProcessor guiclass="TestBeanGUI" testclass="JSR223PreProcessor" testname="JSR223 预处理程序" enabled="true">
                      <stringProp name="scriptLanguage">groovy</stringProp>
                      <stringProp name="parameters"></stringProp>
                      <stringProp name="filename"></stringProp>
                      <stringProp name="cacheKey">true</stringProp>
                      <stringProp name="script">import java.util.regex.*
import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONObject;
import com.alibaba.fastjson.serializer.SerializerFeature;
String command=vars.get(&quot;request_result_command&quot;);
JSONObject request_resultobject = JSON.parseObject(command);
String request_protocol=request_resultobject.get(&quot;request_protocol&quot;);
String request_ip=request_resultobject.get(&quot;request_ip&quot;);
String request_port=request_resultobject.get(&quot;request_port&quot;);
String request_method=request_resultobject.get(&quot;request_method&quot;);
String request_url=request_resultobject.get(&quot;request_url&quot;);
String request_body=request_resultobject.get(&quot;request_body&quot;);
vars.put(&quot;request_protocol&quot;,request_protocol);
vars.put(&quot;request_ip&quot;,request_ip);
vars.put(&quot;request_port&quot;,request_port);
vars.put(&quot;request_url&quot;,request_url);
vars.put(&quot;request_body&quot;,request_body);
sleep(120000);

</stringProp>
                    </JSR223PreProcessor>
                    <hashTree/>
                    <JSR223PostProcessor guiclass="TestBeanGUI" testclass="JSR223PostProcessor" testname="提取返回结果" enabled="true">
                      <stringProp name="cacheKey">true</stringProp>
                      <stringProp name="filename"></stringProp>
                      <stringProp name="parameters"></stringProp>
                      <stringProp name="script">String request_result = prev.getResponseDataAsString();
vars.put(&quot;request_result&quot;,request_result);</stringProp>
                      <stringProp name="scriptLanguage">groovy</stringProp>
                    </JSR223PostProcessor>
                    <hashTree/>
                  </hashTree>
                </hashTree>
              </hashTree>
              <BeanShellAssertion guiclass="BeanShellAssertionGui" testclass="BeanShellAssertion" testname="BeanShell断言" enabled="true">
                <stringProp name="BeanShellAssertion.query">String ES_expect_result=vars.get(&quot;ES_expect_result&quot;);
String mysql_expect_result=vars.get(&quot;mysql_expect_result&quot;);
String mongodb_expect_result=vars.get(&quot;mongodb_expect_result&quot;);
String redis_expect_result=vars.get(&quot;redis_expect_result&quot;);
String response_expect_result=vars.get(&quot;response_expect_result&quot;);
String request_expect_result=vars.get(&quot;request_expect_result&quot;);

String ES_result=vars.get(&quot;ES_result&quot;);
String mongodb_result=vars.get(&quot;mongodb_result&quot;);
String mysql_result=vars.get(&quot;mysql_result&quot;);
String redis_result=vars.get(&quot;redis_result&quot;);
String response_result=vars.get(&quot;response_result&quot;);
String request_result=vars.get(&quot;request_result&quot;);

if(!ES_expect_result.equals(&quot;null&quot;)&amp;&amp;!ES_expect_result.equals(&quot;测试完成&quot;)){
	vars.put(&quot;ES_expect_result&quot;,&quot;测试完成&quot;);
	if(ES_result.contains(ES_expect_result)){
		Failure = false;
		FailureMessage  = &quot;测试通过&quot;;
		return;
	}else{
		Failure = true;
		FailureMessage = &quot;测试失败，返回结果为：&quot;+ES_result+&quot;预期结果为&quot;+ES_expect_result;
		return;
	}
}else if(!mongodb_expect_result.equals(&quot;null&quot;)&amp;&amp;!mongodb_expect_result.equals(&quot;测试完成&quot;)){
	vars.put(&quot;mongodb_expect_result&quot;,&quot;测试完成&quot;);
	if(mongodb_result.contains(mongodb_expect_result)){
		Failure = false;
		FailureMessage  = &quot;测试通过&quot;;
		return;
	}else{
		Failure = true;
		FailureMessage = &quot;测试失败，返回结果为：&quot;+mongodb_result+&quot;预期结果为&quot;+mongodb_expect_result;
		return;
	}
}
else if(!mysql_expect_result.equals(&quot;null&quot;)&amp;&amp;!mysql_expect_result.equals(&quot;测试完成&quot;)){
	vars.put(&quot;mysql_expect_result&quot;,&quot;测试完成&quot;);
	log.error(mysql_result);
	log.error(mysql_expect_result);
	if(mysql_result.contains(mysql_expect_result)){
		Failure = false;
		FailureMessage  = &quot;测试通过&quot;;
		return;
	}else{
		Failure = true;
		FailureMessage = &quot;测试失败，返回结果为：&quot;+mysql_result+&quot;预期结果为&quot;+mysql_expect_result;
		return;
	}
}
else if(!redis_expect_result.equals(&quot;null&quot;)&amp;&amp;!redis_expect_result.equals(&quot;测试完成&quot;)){
	vars.put(&quot;redis_expect_result&quot;,&quot;测试完成&quot;);
	if(redis_result.contains(redis_expect_result)){
		Failure = false;
		FailureMessage  = &quot;测试通过&quot;;
		return;
	}else{
		Failure = true;
		FailureMessage = &quot;测试失败，返回结果为：&quot;+redis_result+&quot;预期结果为&quot;+redis_expect_result;
		return;
	}
}
else if(!response_expect_result.equals(&quot;null&quot;)&amp;&amp;!response_expect_result.equals(&quot;测试完成&quot;)){
	vars.put(&quot;response_expect_result&quot;,&quot;测试完成&quot;);
	if(response_result.replaceAll(&quot;\\s+&quot;,&quot;&quot;).contains(response_expect_result.replaceAll(&quot;\\s+&quot;,&quot;&quot;))){
		Failure = false;
		FailureMessage  = &quot;测试通过&quot;;
		return;
	}else{
		Failure = true;
		FailureMessage = &quot;测试失败，返回结果为：&quot;+response_result+&quot;预期结果为&quot;+response_expect_result;
		return;
	}
}
else if(!request_expect_result.equals(&quot;null&quot;)&amp;&amp;!request_expect_result.equals(&quot;测试完成&quot;)){
	vars.put(&quot;request_expect_result&quot;,&quot;测试完成&quot;);
	if(request_result.contains(request_expect_result)){
		Failure = false;
		FailureMessage  = &quot;测试通过&quot;;
		return;
	}else{
		Failure = true;
		FailureMessage = &quot;测试失败，返回结果为：&quot;+request_result+&quot;预期结果为&quot;+request_expect_result;
		return;
	}
}</stringProp>
                <stringProp name="BeanShellAssertion.filename"></stringProp>
                <stringProp name="BeanShellAssertion.parameters"></stringProp>
                <boolProp name="BeanShellAssertion.resetInterpreter">true</boolProp>
              </BeanShellAssertion>
              <hashTree/>
            </hashTree>
            <JSR223Sampler guiclass="TestBeanGUI" testclass="JSR223Sampler" testname="后置清空变量" enabled="true">
              <stringProp name="scriptLanguage">groovy</stringProp>
              <stringProp name="parameters"></stringProp>
              <stringProp name="filename"></stringProp>
              <stringProp name="cacheKey">false</stringProp>
              <stringProp name="script">vars.put(&quot;mysql_command&quot;,null);
vars.put(&quot;ES_command&quot;,null);
vars.put(&quot;mongodb_command&quot;,null);
vars.put(&quot;kafka_command&quot;,null);
vars.put(&quot;topic&quot;,null);
vars.put(&quot;kafka_count&quot;,null);
vars.put(&quot;redis_delname&quot;,null);
vars.put(&quot;index&quot;,null);
vars.put(&quot;pre_request_command&quot;,null);
vars.put(&quot;response_field&quot;,null);
vars.put(&quot;response_result&quot;,null);</stringProp>
            </JSR223Sampler>
            <hashTree/>
          </hashTree>
        </hashTree>
        <DebugSampler guiclass="TestBeanGUI" testclass="DebugSampler" testname="调试取样器" enabled="true">
          <boolProp name="displayJMeterProperties">false</boolProp>
          <boolProp name="displayJMeterVariables">true</boolProp>
          <boolProp name="displaySystemProperties">false</boolProp>
        </DebugSampler>
        <hashTree/>
      </hashTree>
      <ResultCollector guiclass="ViewResultsFullVisualizer" testclass="ResultCollector" testname="察看结果树" enabled="true">
        <boolProp name="ResultCollector.error_logging">false</boolProp>
        <objProp>
          <name>saveConfig</name>
          <value class="SampleSaveConfiguration">
            <time>true</time>
            <latency>true</latency>
            <timestamp>true</timestamp>
            <success>true</success>
            <label>true</label>
            <code>true</code>
            <message>true</message>
            <threadName>true</threadName>
            <dataType>true</dataType>
            <encoding>true</encoding>
            <assertions>true</assertions>
            <subresults>true</subresults>
            <responseData>true</responseData>
            <samplerData>true</samplerData>
            <xml>true</xml>
            <fieldNames>true</fieldNames>
            <responseHeaders>true</responseHeaders>
            <requestHeaders>true</requestHeaders>
            <responseDataOnError>true</responseDataOnError>
            <saveAssertionResultsFailureMessage>true</saveAssertionResultsFailureMessage>
            <assertionsResultsToSave>0</assertionsResultsToSave>
            <bytes>true</bytes>
            <sentBytes>true</sentBytes>
            <url>true</url>
            <fileName>true</fileName>
            <hostname>true</hostname>
            <threadCounts>true</threadCounts>
            <sampleCount>true</sampleCount>
            <idleTime>true</idleTime>
            <connectTime>true</connectTime>
          </value>
        </objProp>
        <stringProp name="filename"></stringProp>
      </ResultCollector>
      <hashTree/>
    </hashTree>
  </hashTree>
</jmeterTestPlan>
